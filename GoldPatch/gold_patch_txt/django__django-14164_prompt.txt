# 修复代码生成提示词（实例ID：django__django-14164）
## 代码仓库
django/django

## 原始问题描述
to_locale should be idempotent
Description
	
In summary:
>>> from django.utils.translation import to_locale
>>> to_locale('en-us')
'en_US' # <- Fine
>>> to_locale(to_locale('en-us'))
'en_us' # <- Bad
Typically, this breaks using e.g. django.utils.translation.override with a locale code like pt_BR or zh_Hans. of course, we could document that override takes a language code, not a locale code, but if we can support both without much effort, this would be a lot better.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/i18n/tests.py b/tests/i18n/tests.py
--- a/tests/i18n/tests.py
+++ b/tests/i18n/tests.py
@@ -313,9 +313,16 @@ def test_to_locale(self):
             ('EN', 'en'),
             ('en-us', 'en_US'),
             ('EN-US', 'en_US'),
+            ('en_US', 'en_US'),
             # With > 2 characters after the dash.
             ('sr-latn', 'sr_Latn'),
             ('sr-LATN', 'sr_Latn'),
+            ('sr_Latn', 'sr_Latn'),
+            # 3-char language codes.
+            ('ber-MA', 'ber_MA'),
+            ('BER-MA', 'ber_MA'),
+            ('BER_MA', 'ber_MA'),
+            ('ber_MA', 'ber_MA'),
             # With private use subtag (x-informal).
             ('nl-nl-x-informal', 'nl_NL-x-informal'),
             ('NL-NL-X-INFORMAL', 'nl_NL-x-informal'),