# 修复代码生成提示词（实例ID：django__django-15087）
## 代码仓库
django/django

## 原始问题描述
SQLite schema introspection should use PRAGMA instead of parsing to retrieve foreign keys
Description
	
The SQLite backend's DatabaseIntrospection.get_relations uses a complex combination of regexes to extract foreign key constraints from DDL while ​PRAGMA foreign_key_list works just fine as ​_get_foreign_key_constraints.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/introspection/tests.py b/tests/introspection/tests.py
--- a/tests/introspection/tests.py
+++ b/tests/introspection/tests.py
@@ -1,5 +1,3 @@
-from unittest import mock, skipUnless
-
 from django.db import DatabaseError, connection
 from django.db.models import Index
 from django.test import TransactionTestCase, skipUnlessDBFeature
@@ -152,22 +150,6 @@ def test_get_relations(self):
             editor.add_field(Article, body)
         self.assertEqual(relations, expected_relations)
 
-    @skipUnless(connection.vendor == 'sqlite', "This is an sqlite-specific issue")
-    def test_get_relations_alt_format(self):
-        """
-        With SQLite, foreign keys can be added with different syntaxes and
-        formatting.
-        """
-        create_table_statements = [
-            "CREATE TABLE track(id, art_id INTEGER, FOREIGN KEY(art_id) REFERENCES {}(id));",
-            "CREATE TABLE track(id, art_id INTEGER, FOREIGN KEY (art_id) REFERENCES {}(id));"
-        ]
-        for statement in create_table_statements:
-            with connection.cursor() as cursor:
-                cursor.fetchone = mock.Mock(return_value=[statement.format(Article._meta.db_table), 'table'])
-                relations = connection.introspection.get_relations(cursor, 'mocked_table')
-            self.assertEqual(relations, {'art_id': ('id', Article._meta.db_table)})
-
     def test_get_primary_key_column(self):
         with connection.cursor() as cursor:
             primary_key_column = connection.introspection.get_primary_key_column(cursor, Article._meta.db_table)
diff --git a/tests/schema/tests.py b/tests/schema/tests.py
--- a/tests/schema/tests.py
+++ b/tests/schema/tests.py
@@ -119,9 +119,6 @@ def column_classes(self, model):
         for name, (type, desc) in columns.items():
             if isinstance(type, tuple):
                 columns[name] = (type[0], desc)
-        # SQLite also doesn't error properly
-        if not columns:
-            raise DatabaseError("Table does not exist (empty pragma)")
         return columns
 
     def get_primary_key(self, table):