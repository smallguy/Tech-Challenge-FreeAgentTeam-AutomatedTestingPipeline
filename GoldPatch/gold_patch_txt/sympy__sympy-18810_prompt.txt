# 修复代码生成提示词（实例ID：sympy__sympy-18810）
## 代码仓库
sympy/sympy

## 原始问题描述
generate_derangements mishandles unsorted perm
The following is incorrect:
```python
>>> list('TRUMP') in generate_derangements('TRUMP')
True
```
The routine is assuming that the `perm` is sorted (though this is not a requirement):
```python
>>> list('MPRTU') in generate_derangements('MPRTU')
False
```


## 参考黄金补丁（正确的修复方案）
diff --git a/sympy/utilities/tests/test_iterables.py b/sympy/utilities/tests/test_iterables.py
--- a/sympy/utilities/tests/test_iterables.py
+++ b/sympy/utilities/tests/test_iterables.py
@@ -543,6 +543,7 @@ def test_derangements():
         [2, 3, 0, 1], [2, 3, 1, 0], [3, 0, 1, 2], [3, 2, 0, 1], [3, 2, 1, 0]]
     assert list(generate_derangements([0, 1, 2, 2])) == [
         [2, 2, 0, 1], [2, 2, 1, 0]]
+    assert list(generate_derangements('ba')) == [list('ab')]
 
 
 def test_necklaces():