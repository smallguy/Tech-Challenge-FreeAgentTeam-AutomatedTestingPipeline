# 修复代码生成提示词（实例ID：django__django-14935）
## 代码仓库
django/django

## 原始问题描述
Add makemigrations warning for unique fields with callable defaults
Description
	
Callables on properties for ModelFields are used for various reasons. One use case is to autocreate random file names or user passwords if not present.
The migration seems to call them only once because after the migration every "Buchung" has the same wlan_password.
My Model:
def random_wlan_key():
	return ''.join(random.SystemRandom().choice("1234567890abcdefghkmnpqrstuvwxyz") for i in range(9))
class Buchung(models.Model):
	[...]
	wlan_passwort = models.CharField(max_length=10, default=random_wlan_key)
The generated migration:
# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from django.db import models, migrations
import main.models
class Migration(migrations.Migration):
	dependencies = [
		('main', '0001_initial'),
	]
	operations = [
		migrations.AddField(
			model_name='buchung',
			name='wlan_passwort',
			field=models.CharField(default=main.models.random_wlan_key, max_length=10),
			preserve_default=True,
		),
	]


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/migrations/test_commands.py b/tests/migrations/test_commands.py
--- a/tests/migrations/test_commands.py
+++ b/tests/migrations/test_commands.py
@@ -17,6 +17,8 @@
 from django.db.migrations.recorder import MigrationRecorder
 from django.test import TestCase, override_settings, skipUnlessDBFeature
 from django.test.utils import captured_stdout
+from django.utils import timezone
+from django.utils.version import get_docs_version
 
 from .models import UnicodeModel, UnserializableModel
 from .routers import TestRouter
@@ -1870,6 +1872,57 @@ class Meta:
                 with self.assertRaises(SystemExit):
                     call_command('makemigrations', 'migrations', interactive=True)
 
+    def test_makemigrations_interactive_unique_callable_default_addition(self):
+        """
+        makemigrations prompts the user when adding a unique field with
+        a callable default.
+        """
+        class Book(models.Model):
+            created = models.DateTimeField(unique=True, default=timezone.now)
+
+            class Meta:
+                app_label = 'migrations'
+
+        version = get_docs_version()
+        input_msg = (
+            f'Callable default on unique field book.created will not generate '
+            f'unique values upon migrating.\n'
+            f'Please choose how to proceed:\n\n'
+            f' 1) Continue making this migration as the first step in writing '
+            f'a manual migration to generate unique values described here: '
+            f'https://docs.djangoproject.com/en/{version}/howto/'
+            f'writing-migrations/#migrations-that-add-unique-fields.\n'
+            f' 2) Quit and edit field options in models.py.\n'
+        )
+        with self.temporary_migration_module(module='migrations.test_migrations'):
+            # 2 - quit.
+            with mock.patch('builtins.input', return_value='2'):
+                with captured_stdout() as out, self.assertRaises(SystemExit):
+                    call_command('makemigrations', 'migrations', interactive=True)
+            out_value = out.getvalue()
+            self.assertIn(input_msg, out_value)
+            self.assertNotIn('Add field created to book', out_value)
+            # 1 - continue.
+            with mock.patch('builtins.input', return_value='1'):
+                with captured_stdout() as out:
+                    call_command('makemigrations', 'migrations', interactive=True)
+            out_value = out.getvalue()
+            self.assertIn(input_msg, out_value)
+            self.assertIn('Add field created to book', out_value)
+
+    def test_makemigrations_non_interactive_unique_callable_default_addition(self):
+        class Book(models.Model):
+            created = models.DateTimeField(unique=True, default=timezone.now)
+
+            class Meta:
+                app_label = 'migrations'
+
+        with self.temporary_migration_module(module='migrations.test_migrations'):
+            with captured_stdout() as out:
+                call_command('makemigrations', 'migrations', interactive=False)
+            out_value = out.getvalue()
+            self.assertIn('Add field created to book', out_value)
+
 
 class SquashMigrationsTests(MigrationTestBase):
     """