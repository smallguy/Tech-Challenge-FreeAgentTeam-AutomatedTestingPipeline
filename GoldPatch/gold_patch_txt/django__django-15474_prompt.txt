# 修复代码生成提示词（实例ID：django__django-15474）
## 代码仓库
django/django

## 原始问题描述
Unapplying ContentType migration 0002 does not populate legacy name field on non-default database
Description
	
Given a database with the alias other that has all contenttypes migrations applied, roll the state back to initial:
$ manage.py migrate --database=other contenttypes 0001
All ContentType rows in the other database will be null instead of their intended value.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/contenttypes_tests/test_migrations.py b/tests/contenttypes_tests/test_migrations.py
new file mode 100644
--- /dev/null
+++ b/tests/contenttypes_tests/test_migrations.py
@@ -0,0 +1,31 @@
+from importlib import import_module
+
+from django.apps import apps
+from django.contrib.auth.models import Permission
+from django.contrib.contenttypes.models import ContentType
+from django.db import DEFAULT_DB_ALIAS, connections
+from django.test import TransactionTestCase
+
+remove_content_type_name = import_module(
+    "django.contrib.contenttypes.migrations.0002_remove_content_type_name"
+)
+
+
+class MultiDBRemoveContentTypeNameTests(TransactionTestCase):
+    databases = {"default", "other"}
+    available_apps = ["django.contrib.auth", "django.contrib.contenttypes"]
+
+    def test_add_legacy_name_other_database(self):
+        # add_legacy_name() should update ContentType objects in the specified
+        # database. Remove ContentTypes from the default database to distinct
+        # from which database they are fetched.
+        Permission.objects.all().delete()
+        ContentType.objects.all().delete()
+        # ContentType.name in the current version is a property and cannot be
+        # set, so an AttributeError is raised with the other database.
+        with self.assertRaises(AttributeError):
+            with connections["other"].schema_editor() as editor:
+                remove_content_type_name.add_legacy_name(apps, editor)
+        # ContentType were removed from the default database.
+        with connections[DEFAULT_DB_ALIAS].schema_editor() as editor:
+            remove_content_type_name.add_legacy_name(apps, editor)