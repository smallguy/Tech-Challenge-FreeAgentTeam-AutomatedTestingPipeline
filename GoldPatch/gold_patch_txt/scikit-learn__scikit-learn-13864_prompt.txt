# 修复代码生成提示词（实例ID：scikit-learn__scikit-learn-13864）
## 代码仓库
scikit-learn/scikit-learn

## 原始问题描述
AttributeError thrown when calling metrics.pairwise_distances with binary metrics and Y is None
#### Description

`AttributeError` thrown when calling `metrics.pairwise_distances` with binary metrics if `Y` is `None`.

#### Steps/Code to Reproduce

```python
import numpy as np
import sklearn
binary_data = np.array((0, 0, 0, 0, 0, 1, 
                        1, 0, 0, 1, 1, 0),
                       dtype = "bool").reshape((2, 6))
sklearn.metrics.pairwise_distances(binary_data, metric="jaccard")
```

#### Expected Results
No error. Should return a `numpy.ndarray` of shape `(2, 2)` containing the pairwise distances.

#### Actual Results

```
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-21-fa618e0f7808> in <module>
----> 1 sklearn.metrics.pairwise_distances(binary_data, metric="jaccard")

e:\dev\python\anaconda\envs\umap\lib\site-packages\sklearn\metrics\pairwise.py in pairwise_distances(X, Y, metric, n_jobs, **kwds)
   1562         dtype = bool if metric in PAIRWISE_BOOLEAN_FUNCTIONS else None
   1563 
-> 1564         if dtype == bool and (X.dtype != bool or Y.dtype != bool):
   1565             msg = "Data was converted to boolean for metric %s" % metric
   1566             warnings.warn(msg, DataConversionWarning)

AttributeError: 'NoneType' object has no attribute 'dtype'
```

#### Versions

```
machine: Windows-10-10.0.17134-SP0
python: 3.7.3 (default, Apr 24 2019, 15:29:51) [MSC v.1915 64 bit (AMD64)]
sklearn: 0.21.0
numpy: 1.16.3
scipy: 1.2.1
```

This worked correctly in sklearn version 0.20.3. I think the problem was introduced in https://github.com/scikit-learn/scikit-learn/commit/4b9e12e73b52382937029d29759976c3ef4aee3c#diff-dd76b3805500714227411a6460b149a8: there is now a code path where `Y` has its `dtype` checked without any prior check as to whether `Y` is `None`.


## 参考黄金补丁（正确的修复方案）
diff --git a/sklearn/metrics/tests/test_pairwise.py b/sklearn/metrics/tests/test_pairwise.py
--- a/sklearn/metrics/tests/test_pairwise.py
+++ b/sklearn/metrics/tests/test_pairwise.py
@@ -173,6 +173,15 @@ def test_pairwise_boolean_distance(metric):
     with pytest.warns(DataConversionWarning, match=msg):
         pairwise_distances(X, metric=metric)
 
+    # Check that the warning is raised if X is boolean by Y is not boolean:
+    with pytest.warns(DataConversionWarning, match=msg):
+        pairwise_distances(X.astype(bool), Y=Y, metric=metric)
+
+    # Check that no warning is raised if X is already boolean and Y is None:
+    with pytest.warns(None) as records:
+        pairwise_distances(X.astype(bool), metric=metric)
+    assert len(records) == 0
+
 
 def test_no_data_conversion_warning():
     # No warnings issued if metric is not a boolean distance function