# 修复代码生成提示词（实例ID：matplotlib__matplotlib-25334）
## 代码仓库
matplotlib/matplotlib

## 原始问题描述
plt.contour with all NaNs fails assertion in _contour.cpp
### Bug report

**Bug summary**

Passing an array with all NaN values into `pyplot.contour()` causes the following assertion to fail in `QuadContourGenerator::init_cache_levels`:
https://github.com/matplotlib/matplotlib/blob/v3.0.3/src/_contour.cpp#L1317-L1318

This is actually triggered by a test-case in the xarray test suite, but I imagine it hasn't been noticed (yet) because release builds of matplotlib typically disable assertion checks.

**Code for reproduction**

```python
import matplotlib.pyplot as plt
import numpy as np

x = np.array([[np.nan, np.nan], [np.nan, np.nan]])
plt.contour(x)
```

**Actual outcome**

Failed assertion (see referenced line above, tracked down with `gdb`)

**Expected outcome**

I would expect to see the empty plot (and long lists of warnings) that are currently shown if assertions are disabled:
![image](https://user-images.githubusercontent.com/1217238/57171429-2221b800-6dc9-11e9-9bc2-dccf317a1646.png)

**Matplotlib version**

  * Operating system: Linux
  * Matplotlib version: 3.0.3
  * Matplotlib backend (`print(matplotlib.get_backend())`): agg
  * Python version: 3.6

Python, matplotlib, etc are installed from source


## 参考黄金补丁（正确的修复方案）
diff --git a/lib/matplotlib/tests/test_contour.py b/lib/matplotlib/tests/test_contour.py
--- a/lib/matplotlib/tests/test_contour.py
+++ b/lib/matplotlib/tests/test_contour.py
@@ -715,3 +715,10 @@ def test_bool_autolevel():
     assert plt.tricontour(x, y, z).levels.tolist() == [.5]
     assert plt.tricontourf(x, y, z.tolist()).levels.tolist() == [0, .5, 1]
     assert plt.tricontourf(x, y, z).levels.tolist() == [0, .5, 1]
+
+
+def test_all_nan():
+    x = np.array([[np.nan, np.nan], [np.nan, np.nan]])
+    assert_array_almost_equal(plt.contour(x).levels,
+                              [-1e-13, -7.5e-14, -5e-14, -2.4e-14, 0.0,
+                                2.4e-14, 5e-14, 7.5e-14, 1e-13])