# 修复代码生成提示词（实例ID：django__django-10989）
## 代码仓库
django/django

## 原始问题描述
Ellipses in output strings cause crashes on Windows
Description
	 
		(last modified by Dan Davis)
	 
By default, Windows terminals start with code page 437, which is roughly equivalent to ASCII. While working on #30178, I discovered that this causes the following traceback:
(mplusmon) λ manage.py runserver
Watchman unavailable: pywatchman not installed.
Watching for file changes with StatReloader
Exception in thread Thread-1:
Traceback (most recent call last):
 File "c:\tools\python\3.5\Lib\threading.py", line 914, in _bootstrap_inner
	self.run()
 File "c:\tools\python\3.5\Lib\threading.py", line 862, in run
	self._target(*self._args, **self._kwargs)
 File "C:\Users\davisda4\PythonEnvs\mplusmon\lib\site-packages\django\utils\autoreload.py", line 54, in wrapper
	fn(*args, **kwargs)
 File "C:\Users\davisda4\PythonEnvs\mplusmon\lib\site-packages\django\core\management\commands\runserver.py", line 116, in inner_run
	self.stdout.write("Performing system checks\u2026\n\n")
 File "C:\Users\davisda4\PythonEnvs\mplusmon\lib\site-packages\django\core\management\base.py", line 145, in write
	self._out.write(style_func(msg))
 File "C:\Users\davisda4\PythonEnvs\mplusmon\lib\encodings\cp437.py", line 19, in encode
	return codecs.charmap_encode(input,self.errors,encoding_map)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2026' in position 24: character maps to <undefined>
A workaround is to change the code page to UTF-8, as follows:
chcp 65001
This appears to be a new issue relative to Django 2.1.7, because the problem did not occur there.	I'll track down wherever someone entered the horizontal elipsis character rather than "..." into the code, because this ought to be easy enough to fix. Whomever did this was probably not even aware of it and it has worked well enough since almost all Django developers will use MacOS or Linux.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/migrations/test_commands.py b/tests/migrations/test_commands.py
--- a/tests/migrations/test_commands.py
+++ b/tests/migrations/test_commands.py
@@ -41,7 +41,7 @@ def test_migrate(self):
         call_command('migrate', 'migrations', '0001', verbosity=1, stdout=stdout, no_color=True)
         stdout = stdout.getvalue()
         self.assertIn('Target specific migration: 0001_initial, from migrations', stdout)
-        self.assertIn('Applying migrations.0001_initial… OK', stdout)
+        self.assertIn('Applying migrations.0001_initial... OK', stdout)
         # The correct tables exist
         self.assertTableExists("migrations_author")
         self.assertTableExists("migrations_tribble")
@@ -57,7 +57,7 @@ def test_migrate(self):
         call_command('migrate', 'migrations', 'zero', verbosity=1, stdout=stdout, no_color=True)
         stdout = stdout.getvalue()
         self.assertIn('Unapply all migrations: migrations', stdout)
-        self.assertIn('Unapplying migrations.0002_second… OK', stdout)
+        self.assertIn('Unapplying migrations.0002_second... OK', stdout)
         # Tables are gone
         self.assertTableNotExists("migrations_author")
         self.assertTableNotExists("migrations_tribble")
@@ -157,7 +157,7 @@ def test_migrate_fake_initial(self):
             call_command("migrate", "migrations", "0001", fake_initial=True, stdout=out, verbosity=1)
             call_command("migrate", "migrations", "0001", fake_initial=True, verbosity=0, database="other")
         self.assertIn(
-            "migrations.0001_initial… faked",
+            "migrations.0001_initial... faked",
             out.getvalue().lower()
         )
         # Run migrations all the way
@@ -208,8 +208,8 @@ def test_migrate_fake_split_initial(self):
         with mock.patch('django.core.management.color.supports_color', lambda *args: False):
             call_command("migrate", "migrations", "0002", fake_initial=True, stdout=out, verbosity=1)
         value = out.getvalue().lower()
-        self.assertIn("migrations.0001_initial… faked", value)
-        self.assertIn("migrations.0002_second… faked", value)
+        self.assertIn("migrations.0001_initial... faked", value)
+        self.assertIn("migrations.0002_second... faked", value)
         # Fake an apply
         call_command("migrate", "migrations", fake=True, verbosity=0)
         # Unmigrate everything
@@ -271,8 +271,8 @@ def test_showmigrations_plan(self):
         call_command("showmigrations", format='plan', stdout=out, verbosity=2)
         self.assertEqual(
             "[ ]  migrations.0001_initial\n"
-            "[ ]  migrations.0003_third … (migrations.0001_initial)\n"
-            "[ ]  migrations.0002_second … (migrations.0001_initial, migrations.0003_third)\n",
+            "[ ]  migrations.0003_third ... (migrations.0001_initial)\n"
+            "[ ]  migrations.0002_second ... (migrations.0001_initial, migrations.0003_third)\n",
             out.getvalue().lower()
         )
         call_command("migrate", "migrations", "0003", verbosity=0)
@@ -290,8 +290,8 @@ def test_showmigrations_plan(self):
         call_command("showmigrations", format='plan', stdout=out, verbosity=2)
         self.assertEqual(
             "[x]  migrations.0001_initial\n"
-            "[x]  migrations.0003_third … (migrations.0001_initial)\n"
-            "[ ]  migrations.0002_second … (migrations.0001_initial, migrations.0003_third)\n",
+            "[x]  migrations.0003_third ... (migrations.0001_initial)\n"
+            "[ ]  migrations.0002_second ... (migrations.0001_initial, migrations.0003_third)\n",
             out.getvalue().lower()
         )
 
@@ -410,10 +410,10 @@ def test_showmigrations_plan_squashed(self):
         call_command("showmigrations", format='plan', stdout=out, verbosity=2)
         self.assertEqual(
             "[ ]  migrations.1_auto\n"
-            "[ ]  migrations.2_auto … (migrations.1_auto)\n"
-            "[ ]  migrations.3_squashed_5 … (migrations.2_auto)\n"
-            "[ ]  migrations.6_auto … (migrations.3_squashed_5)\n"
-            "[ ]  migrations.7_auto … (migrations.6_auto)\n",
+            "[ ]  migrations.2_auto ... (migrations.1_auto)\n"
+            "[ ]  migrations.3_squashed_5 ... (migrations.2_auto)\n"
+            "[ ]  migrations.6_auto ... (migrations.3_squashed_5)\n"
+            "[ ]  migrations.7_auto ... (migrations.6_auto)\n",
             out.getvalue().lower()
         )
 
@@ -434,10 +434,10 @@ def test_showmigrations_plan_squashed(self):
         call_command("showmigrations", format='plan', stdout=out, verbosity=2)
         self.assertEqual(
             "[x]  migrations.1_auto\n"
-            "[x]  migrations.2_auto … (migrations.1_auto)\n"
-            "[x]  migrations.3_squashed_5 … (migrations.2_auto)\n"
-            "[ ]  migrations.6_auto … (migrations.3_squashed_5)\n"
-            "[ ]  migrations.7_auto … (migrations.6_auto)\n",
+            "[x]  migrations.2_auto ... (migrations.1_auto)\n"
+            "[x]  migrations.3_squashed_5 ... (migrations.2_auto)\n"
+            "[ ]  migrations.6_auto ... (migrations.3_squashed_5)\n"
+            "[ ]  migrations.7_auto ... (migrations.6_auto)\n",
             out.getvalue().lower()
         )
 
@@ -659,7 +659,7 @@ def test_migrate_syncdb_deferred_sql_executed_with_schemaeditor(self):
             self.assertGreater(len(execute.mock_calls), 2)
         stdout = stdout.getvalue()
         self.assertIn('Synchronize unmigrated apps: unmigrated_app_syncdb', stdout)
-        self.assertIn('Creating tables…', stdout)
+        self.assertIn('Creating tables...', stdout)
         table_name = truncate_name('unmigrated_app_syncdb_classroom', connection.ops.max_name_length())
         self.assertIn('Creating table %s' % table_name, stdout)