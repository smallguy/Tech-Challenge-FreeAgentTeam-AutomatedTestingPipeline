# 修复代码生成提示词（实例ID：sympy__sympy-17010）
## 代码仓库
sympy/sympy

## 原始问题描述
Some uses of could_extract_minus_sign can lead to infinite recursion
The issue coming from https://github.com/sympy/sympy/issues/13102 was fixed, but there is another issue has come up in my pull request https://github.com/sympy/sympy/pull/13059. Several places in sympy/functions/special/polynomials.py use could_extract_minus_sign() in a way that can lead to infinite recursion. For example, in [`chebyshevu`](https://github.com/sympy/sympy/blob/dceb708ca035c568c816d9457af1b7ca9e57c0a5/sympy/functions/special/polynomials.py#L605-L609):

```py
            if n.could_extract_minus_sign():
                if n == S.NegativeOne:
                    return S.Zero
                else:
                    return -chebyshevu(-n - 2, x)
```

The problem is that both `n.could_extract_minus_sign()` and `(-n - 2).could_extract_minus_sign()` could be True, leading to infinite recursion. This happens in my branch for `chebyshevu(n - 1, x)`, but probably an example could be found for master too. 

We need a more robust way to canonicalize this. Ideally we'd want to remove the minus sign from the highest order term. Is there a fast way to do that? 


## 参考黄金补丁（正确的修复方案）
diff --git a/sympy/functions/special/tests/test_spec_polynomials.py b/sympy/functions/special/tests/test_spec_polynomials.py
--- a/sympy/functions/special/tests/test_spec_polynomials.py
+++ b/sympy/functions/special/tests/test_spec_polynomials.py
@@ -8,7 +8,8 @@
 from sympy.core.compatibility import range
 from sympy.core.expr import unchanged
 from sympy.core.function import ArgumentIndexError
-from sympy.utilities.pytest import raises, skip
+from sympy.utilities.pytest import raises
+
 
 x = Symbol('x')
 
@@ -154,12 +155,14 @@ def test_legendre():
 
     X = legendre(n, x)
     assert isinstance(X, legendre)
+    assert unchanged(legendre, n, x)
 
     assert legendre(n, 0) == sqrt(pi)/(gamma(S(1)/2 - n/2)*gamma(n/2 + 1))
     assert legendre(n, 1) == 1
     assert legendre(n, oo) == oo
     assert legendre(-n, x) == legendre(n - 1, x)
     assert legendre(n, -x) == (-1)**n*legendre(n, x)
+    assert unchanged(legendre, -n + k, x)
 
     assert conjugate(legendre(n, x)) == legendre(n, conjugate(x))
 
@@ -244,6 +247,7 @@ def test_chebyshev():
     n = Symbol("n")
     X = chebyshevt(n, x)
     assert isinstance(X, chebyshevt)
+    assert unchanged(chebyshevt, n, x)
     assert chebyshevt(n, -x) == (-1)**n*chebyshevt(n, x)
     assert chebyshevt(-n, x) == chebyshevt(n, x)
 
@@ -258,8 +262,10 @@ def test_chebyshev():
     X = chebyshevu(n, x)
     assert isinstance(X, chebyshevu)
 
+    y = Symbol('y')
     assert chebyshevu(n, -x) == (-1)**n*chebyshevu(n, x)
     assert chebyshevu(-n, x) == -chebyshevu(n - 2, x)
+    assert unchanged(chebyshevu, -n + y, x)
 
     assert chebyshevu(n, 0) == cos(pi*n/2)
     assert chebyshevu(n, 1) == n + 1
@@ -312,15 +318,14 @@ def test_hermite():
 
 def test_laguerre():
     n = Symbol("n")
+    m = Symbol("m", negative=True)
 
     # Laguerre polynomials:
     assert laguerre(0, x) == 1
     assert laguerre(1, x) == -x + 1
     assert laguerre(2, x) == x**2/2 - 2*x + 1
     assert laguerre(3, x) == -x**3/6 + 3*x**2/2 - 3*x + 1
-
-    X = laguerre(Rational(5,2), x)
-    assert isinstance(X, laguerre)
+    assert laguerre(-2, x) == (x + 1)*exp(x)
 
     X = laguerre(n, x)
     assert isinstance(X, laguerre)
@@ -335,21 +340,23 @@ def test_laguerre():
 
     assert laguerre(n, x).rewrite("polynomial").dummy_eq(
         Sum(x**_k*RisingFactorial(-n, _k)/factorial(_k)**2, (_k, 0, n)))
+    assert laguerre(m, x).rewrite("polynomial").dummy_eq(
+        exp(x)*Sum((-x)**_k*RisingFactorial(m + 1, _k)/factorial(_k)**2,
+            (_k, 0, -m - 1)))
 
     assert diff(laguerre(n, x), x) == -assoc_laguerre(n - 1, 1, x)
 
+    k = Symbol('k')
+    assert laguerre(-n, x) == exp(x)*laguerre(n - 1, -x)
+    assert laguerre(-3, x) == exp(x)*laguerre(2, -x)
+    assert unchanged(laguerre, -n + k, x)
+
     raises(ValueError, lambda: laguerre(-2.1, x))
+    raises(ValueError, lambda: laguerre(Rational(5, 2), x))
     raises(ArgumentIndexError, lambda: laguerre(n, x).fdiff(1))
     raises(ArgumentIndexError, lambda: laguerre(n, x).fdiff(3))
 
 
-def test_legendre_fail():
-    skip("Infinite recursion kills Travis")
-    n = Symbol("n")
-    assert laguerre(-n, x) == exp(x)*laguerre(n-1, -x)
-    assert laguerre(-3, x) == exp(x)*laguerre(2, -x)
-
-
 def test_assoc_laguerre():
     n = Symbol("n")
     m = Symbol("m")