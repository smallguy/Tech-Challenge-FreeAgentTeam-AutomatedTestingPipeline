# 修复代码生成提示词（实例ID：django__django-11185）
## 代码仓库
django/django

## 原始问题描述
Model.delete(keep_parents=True) does not preserve all parent reverse relationships
Description
	 
		(last modified by Stephen Brown)
	 
There was a partial fix for this in #27407, but it doesn't cater for relationships toward parents of parents, and so on.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/delete/models.py b/tests/delete/models.py
--- a/tests/delete/models.py
+++ b/tests/delete/models.py
@@ -28,6 +28,10 @@ class RChild(R):
     pass
 
 
+class RChildChild(RChild):
+    pass
+
+
 class A(models.Model):
     name = models.CharField(max_length=30)
 
diff --git a/tests/delete/tests.py b/tests/delete/tests.py
--- a/tests/delete/tests.py
+++ b/tests/delete/tests.py
@@ -7,8 +7,8 @@
 
 from .models import (
     MR, A, Avatar, Base, Child, HiddenUser, HiddenUserProfile, M, M2MFrom,
-    M2MTo, MRNull, Origin, Parent, R, RChild, Referrer, S, T, User, create_a,
-    get_default_r,
+    M2MTo, MRNull, Origin, Parent, R, RChild, RChildChild, Referrer, S, T,
+    User, create_a, get_default_r,
 )
 
 
@@ -371,6 +371,16 @@ def test_delete_with_keeping_parents_relationships(self):
         self.assertTrue(R.objects.filter(id=parent_id).exists())
         self.assertTrue(S.objects.filter(pk=parent_referent_id).exists())
 
+        childchild = RChildChild.objects.create()
+        parent_id = childchild.rchild_ptr.r_ptr_id
+        child_id = childchild.rchild_ptr_id
+        parent_referent_id = S.objects.create(r=childchild.rchild_ptr.r_ptr).pk
+        childchild.delete(keep_parents=True)
+        self.assertFalse(RChildChild.objects.filter(id=childchild.id).exists())
+        self.assertTrue(RChild.objects.filter(id=child_id).exists())
+        self.assertTrue(R.objects.filter(id=parent_id).exists())
+        self.assertTrue(S.objects.filter(pk=parent_referent_id).exists())
+
     def test_queryset_delete_returns_num_rows(self):
         """
         QuerySet.delete() should return the number of deleted rows and a