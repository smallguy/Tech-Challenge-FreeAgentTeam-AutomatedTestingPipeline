# 修复代码生成提示词（实例ID：matplotlib__matplotlib-25551）
## 代码仓库
matplotlib/matplotlib

## 原始问题描述
handling of zeros in log-scale changes irreversibly after user zoom
matplotlib 2.0b1 (but also present before that)
Call e.g.

```
plt.plot(np.arange(10), np.arange(10)[::-1])
```

and type "k" and "l" to switch both axes to log scale.  The points at the two ends, where one of the coordinate is zero, are cropped out.  This has been the behavior for a long time and seems reasonable.
Now come back to linear scale ("k", "l") and zoom in with the zoom tool to one of the ends of the segment, e.g. xlims=(-0.1, 0.4), ylims=(8.6, 9.1) or something similar.  Switching again to log scale now leads to a badly scaled plot, because the `x` axis now goes all the way to `10**-301` (float epsilon).
Even this is not unreasonable: the user effectively set his own axes limits, rather than the autocomputed ones, and these limits are invalid in log scale.
The problem comes when you go back to the original limits (either "back" or "h" ("home")): even then, log-scale is broken (both axes to to `10**-301` instead of cropping the extremities); in fact, it seems impossible to restore the original behavior of autocomputed axes limits.



## 参考黄金补丁（正确的修复方案）
diff --git a/lib/matplotlib/tests/test_backend_bases.py b/lib/matplotlib/tests/test_backend_bases.py
--- a/lib/matplotlib/tests/test_backend_bases.py
+++ b/lib/matplotlib/tests/test_backend_bases.py
@@ -280,6 +280,36 @@ def test_toolbar_zoompan():
     assert ax.get_navigate_mode() == "PAN"
 
 
+def test_toolbar_home_restores_autoscale():
+    fig, ax = plt.subplots()
+    ax.plot(range(11), range(11))
+
+    tb = NavigationToolbar2(fig.canvas)
+    tb.zoom()
+
+    # Switch to log.
+    KeyEvent("key_press_event", fig.canvas, "k", 100, 100)._process()
+    KeyEvent("key_press_event", fig.canvas, "l", 100, 100)._process()
+    assert ax.get_xlim() == ax.get_ylim() == (1, 10)  # Autolimits excluding 0.
+    # Switch back to linear.
+    KeyEvent("key_press_event", fig.canvas, "k", 100, 100)._process()
+    KeyEvent("key_press_event", fig.canvas, "l", 100, 100)._process()
+    assert ax.get_xlim() == ax.get_ylim() == (0, 10)  # Autolimits.
+
+    # Zoom in from (x, y) = (2, 2) to (5, 5).
+    start, stop = ax.transData.transform([(2, 2), (5, 5)])
+    MouseEvent("button_press_event", fig.canvas, *start, MouseButton.LEFT)._process()
+    MouseEvent("button_release_event", fig.canvas, *stop, MouseButton.LEFT)._process()
+    # Go back to home.
+    KeyEvent("key_press_event", fig.canvas, "h")._process()
+
+    assert ax.get_xlim() == ax.get_ylim() == (0, 10)
+    # Switch to log.
+    KeyEvent("key_press_event", fig.canvas, "k", 100, 100)._process()
+    KeyEvent("key_press_event", fig.canvas, "l", 100, 100)._process()
+    assert ax.get_xlim() == ax.get_ylim() == (1, 10)  # Autolimits excluding 0.
+
+
 @pytest.mark.parametrize(
     "backend", ['svg', 'ps', 'pdf',
                 pytest.param('pgf', marks=needs_pgf_xelatex)]