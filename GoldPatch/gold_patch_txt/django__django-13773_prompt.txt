# 修复代码生成提示词（实例ID：django__django-13773）
## 代码仓库
django/django

## 原始问题描述
squashmigrations optimizer crashes when fields' names are swapped using a temporary name
Description
	
If you rename fields using a pattern like a->c; b->a; c->b (such as if previously DateTimeFields using auto_now and auto_now_add had been mixed-up) and then attempt to squashmigrations with an optimization barrier between the CreateModel and RenameFields, the migration optimizer will attempt to create a CreateModel operation object with two fields using the same name and fail. I'll attach a migration file that triggers the failure.
I believe the root cause of this issue is that django.db.migrations.operations.fields.RenameField allows itself to optimize through (i.e be moved to the right of, I may have gotten this terminology wrong) other RenameField operations that reference old_name.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/migrations/test_optimizer.py b/tests/migrations/test_optimizer.py
--- a/tests/migrations/test_optimizer.py
+++ b/tests/migrations/test_optimizer.py
@@ -572,6 +572,23 @@ def test_alter_field_rename_field(self):
             ],
         )
 
+    def test_swapping_fields_names(self):
+        self.assertDoesNotOptimize(
+            [
+                migrations.CreateModel(
+                    'MyModel',
+                    [
+                        ('field_a', models.IntegerField()),
+                        ('field_b', models.IntegerField()),
+                    ],
+                ),
+                migrations.RunPython(migrations.RunPython.noop),
+                migrations.RenameField('MyModel', 'field_a', 'field_c'),
+                migrations.RenameField('MyModel', 'field_b', 'field_a'),
+                migrations.RenameField('MyModel', 'field_c', 'field_b'),
+            ],
+        )
+
     def test_create_model_remove_field(self):
         """
         RemoveField should optimize into CreateModel.