# 修复代码生成提示词（实例ID：django__django-14056）
## 代码仓库
django/django

## 原始问题描述
Make `collectstatic` warn (rather than blow up) on missing directories
Description
	
At present if the STATICFILES_DIRS setting contains references to directories which do not exist then the whole command will die with an OSError.
A situation I've seen bite a few newcomers to Django is that they will have an empty static directory which (being empty) won't get tracked by git. This means that collectstatic works when they run it locally, but blows up with a (to them) cryptic error when they try to deploy.
If we made collectstatic simply log a warning in the case of non-existent directories and continue processing then we could avoid this problem and remove one possible source of frustration for newcomers.
If this approach seems acceptable to others I am happy to submit an appropriate patch.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/staticfiles_tests/test_checks.py b/tests/staticfiles_tests/test_checks.py
--- a/tests/staticfiles_tests/test_checks.py
+++ b/tests/staticfiles_tests/test_checks.py
@@ -1,13 +1,18 @@
+from pathlib import Path
 from unittest import mock
 
 from django.conf import settings
 from django.contrib.staticfiles.checks import check_finders
-from django.contrib.staticfiles.finders import BaseFinder
-from django.core.checks import Error
-from django.test import SimpleTestCase, override_settings
+from django.contrib.staticfiles.finders import BaseFinder, get_finder
+from django.core.checks import Error, Warning
+from django.test import override_settings
 
+from .cases import CollectionTestCase
+from .settings import TEST_ROOT
 
-class FindersCheckTests(SimpleTestCase):
+
+class FindersCheckTests(CollectionTestCase):
+    run_collectstatic_in_setUp = False
 
     def test_base_finder_check_not_implemented(self):
         finder = BaseFinder()
@@ -56,32 +61,54 @@ def test_dirs_not_tuple_or_list(self):
             )
         ])
 
-    @override_settings(STATICFILES_DIRS=['/fake/path', settings.STATIC_ROOT])
     def test_dirs_contains_static_root(self):
-        self.assertEqual(check_finders(None), [
-            Error(
-                'The STATICFILES_DIRS setting should not contain the '
-                'STATIC_ROOT setting.',
-                id='staticfiles.E002',
-            )
-        ])
+        with self.settings(STATICFILES_DIRS=[settings.STATIC_ROOT]):
+            self.assertEqual(check_finders(None), [
+                Error(
+                    'The STATICFILES_DIRS setting should not contain the '
+                    'STATIC_ROOT setting.',
+                    id='staticfiles.E002',
+                )
+            ])
 
-    @override_settings(STATICFILES_DIRS=[('prefix', settings.STATIC_ROOT)])
     def test_dirs_contains_static_root_in_tuple(self):
-        self.assertEqual(check_finders(None), [
-            Error(
-                'The STATICFILES_DIRS setting should not contain the '
-                'STATIC_ROOT setting.',
-                id='staticfiles.E002',
-            )
-        ])
+        with self.settings(STATICFILES_DIRS=[('prefix', settings.STATIC_ROOT)]):
+            self.assertEqual(check_finders(None), [
+                Error(
+                    'The STATICFILES_DIRS setting should not contain the '
+                    'STATIC_ROOT setting.',
+                    id='staticfiles.E002',
+                )
+            ])
 
-    @override_settings(STATICFILES_DIRS=[('prefix/', '/fake/path')])
     def test_prefix_contains_trailing_slash(self):
-        self.assertEqual(check_finders(None), [
-            Error(
-                "The prefix 'prefix/' in the STATICFILES_DIRS setting must "
-                "not end with a slash.",
-                id='staticfiles.E003',
-            )
-        ])
+        static_dir = Path(TEST_ROOT) / 'project' / 'documents'
+        with self.settings(STATICFILES_DIRS=[('prefix/', static_dir)]):
+            self.assertEqual(check_finders(None), [
+                Error(
+                    "The prefix 'prefix/' in the STATICFILES_DIRS setting must "
+                    "not end with a slash.",
+                    id='staticfiles.E003',
+                ),
+            ])
+
+    def test_nonexistent_directories(self):
+        with self.settings(STATICFILES_DIRS=[
+            '/fake/path',
+            ('prefix', '/fake/prefixed/path'),
+        ]):
+            self.assertEqual(check_finders(None), [
+                Warning(
+                    "The directory '/fake/path' in the STATICFILES_DIRS "
+                    "setting does not exist.",
+                    id='staticfiles.W004',
+                ),
+                Warning(
+                    "The directory '/fake/prefixed/path' in the "
+                    "STATICFILES_DIRS setting does not exist.",
+                    id='staticfiles.W004',
+                ),
+            ])
+            # Nonexistent directories are skipped.
+            finder = get_finder('django.contrib.staticfiles.finders.FileSystemFinder')
+            self.assertEqual(list(finder.list(None)), [])