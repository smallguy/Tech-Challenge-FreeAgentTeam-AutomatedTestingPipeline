# 修复代码生成提示词（实例ID：sphinx-doc__sphinx-10067）
## 代码仓库
sphinx-doc/sphinx

## 原始问题描述
To improve accessibility, set language in conf.py using sphinx-quickstart
**Is your feature request related to a problem? Please describe.**
By default, Sphinx documentation does not include the language, for example in `docs/conf.py`
`language = 'en'`

result in built web pages:
`<html lang="en">`

This leads to the following accessibility issue identified by [Lighthouse](https://developers.google.com/web/tools/lighthouse/):

`<html> element does not have a [lang] attribute `
> If a page doesn't specify a lang attribute, a screen reader assumes that the page is in the default language that the user chose when setting up the screen reader. If the page isn't actually in the default language, then the screen reader might not announce the page's text correctly. [Learn more](https://web.dev/html-has-lang/?utm_source=lighthouse&utm_medium=lr).`

Also, Sphinx sites thus do not by default take advantage of the [features offered by setting the language](https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language).

This [accessibility issue is present in major sites including NumPy](https://googlechrome.github.io/lighthouse/viewer/?psiurl=https%3A%2F%2Fnumpy.org%2Fdoc%2Fstable%2F&strategy=mobile&category=performance&category=accessibility&category=best-practices&category=seo&category=pwa&utm_source=lh-chrome-ext).

**Describe the solution you'd like**
User already enters language when they run sphinx-quickstart:
```
For a list of supported codes, see
https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language.
> Project language [en]: 
```

so it should automatically set that `language` value in the generated `conf.py` file.

It would also be nice if there was some prompt to set the `language` of existing Sphinx installations, upon an update of Sphinx version, or build of the documentation, for example.

**Describe alternatives you've considered**
Status quo, which retains accessibility issue.

**Additional context**
Related issue: #10056.




## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_build_latex.py b/tests/test_build_latex.py
--- a/tests/test_build_latex.py
+++ b/tests/test_build_latex.py
@@ -528,7 +528,7 @@ def test_babel_with_no_language_settings(app, status, warning):
     assert '\\usepackage[Bjarne]{fncychap}' in result
     assert ('\\addto\\captionsenglish{\\renewcommand{\\contentsname}{Table of content}}\n'
             in result)
-    assert '\\shorthandoff' not in result
+    assert '\\shorthandoff{"}' in result
 
     # sphinxmessages.sty
     result = (app.outdir / 'sphinxmessages.sty').read_text()
diff --git a/tests/test_util_i18n.py b/tests/test_util_i18n.py
--- a/tests/test_util_i18n.py
+++ b/tests/test_util_i18n.py
@@ -98,15 +98,6 @@ def test_format_date():
 def test_get_filename_for_language(app):
     app.env.temp_data['docname'] = 'index'
 
-    # language is None
-    app.env.config.language = None
-    assert app.env.config.language is None
-    assert i18n.get_image_filename_for_language('foo.png', app.env) == 'foo.png'
-    assert i18n.get_image_filename_for_language('foo.bar.png', app.env) == 'foo.bar.png'
-    assert i18n.get_image_filename_for_language('subdir/foo.png', app.env) == 'subdir/foo.png'
-    assert i18n.get_image_filename_for_language('../foo.png', app.env) == '../foo.png'
-    assert i18n.get_image_filename_for_language('foo', app.env) == 'foo'
-
     # language is en
     app.env.config.language = 'en'
     assert i18n.get_image_filename_for_language('foo.png', app.env) == 'foo.en.png'
@@ -115,15 +106,6 @@ def test_get_filename_for_language(app):
     assert i18n.get_image_filename_for_language('../foo.png', app.env) == '../foo.en.png'
     assert i18n.get_image_filename_for_language('foo', app.env) == 'foo.en'
 
-    # modify figure_language_filename and language is None
-    app.env.config.language = None
-    app.env.config.figure_language_filename = 'images/{language}/{root}{ext}'
-    assert i18n.get_image_filename_for_language('foo.png', app.env) == 'foo.png'
-    assert i18n.get_image_filename_for_language('foo.bar.png', app.env) == 'foo.bar.png'
-    assert i18n.get_image_filename_for_language('subdir/foo.png', app.env) == 'subdir/foo.png'
-    assert i18n.get_image_filename_for_language('../foo.png', app.env) == '../foo.png'
-    assert i18n.get_image_filename_for_language('foo', app.env) == 'foo'
-
     # modify figure_language_filename and language is 'en'
     app.env.config.language = 'en'
     app.env.config.figure_language_filename = 'images/{language}/{root}{ext}'