# 修复代码生成提示词（实例ID：django__django-12591）
## 代码仓库
django/django

## 原始问题描述
Can't replace global admin actions with specialized ones per-admin
Description
	
f9ff1df1daac8ae1fc22b27f48735148cb5488dd landed in 2.2 (discussion in #29917), which makes it impossible to replace a generic site-wide action (such as the built-in delete_selected) with a new one. It fails with the admin.E130 system check error.
We're seeing this with the qsessions app, which has to delete its session objects in non-bulk mode in order to clear caches: ​https://github.com/QueraTeam/django-qsessions/blob/c21d602a50c4746da7f698a8d39317ef214e7d05/qsessions/admin.py#L41-L46
(For this particular use case, it seems a fix is to instead override modeladmin.delete_queryset within qsessions's SessionAdmin, as that's what the built-in delete_selected action does per ​https://github.com/django/django/blob/851d9eac23e08ff10a2d6fe5368b02798761663c/django/contrib/admin/actions.py#L40 .)


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/modeladmin/test_actions.py b/tests/modeladmin/test_actions.py
--- a/tests/modeladmin/test_actions.py
+++ b/tests/modeladmin/test_actions.py
@@ -76,3 +76,42 @@ class AdminB(AdminBase):
         ma2 = AdminB(Band, admin.AdminSite())
         action_names = [name for _, name, _ in ma2._get_base_actions()]
         self.assertEqual(action_names, ['delete_selected'])
+
+    def test_actions_replace_global_action(self):
+        def global_action_1(modeladmin, request, queryset):
+            pass
+
+        def global_action_2(modeladmin, request, queryset):
+            pass
+
+        global_action_1.short_description = 'Site-wide admin action 1.'
+        global_action_2.short_description = 'Site-wide admin action 2.'
+        admin.site.add_action(global_action_1, name='custom_action_1')
+        admin.site.add_action(global_action_2, name='custom_action_2')
+
+        def custom_action_1(modeladmin, request, queryset):
+            pass
+
+        custom_action_1.short_description = 'Local admin action 1.'
+
+        class BandAdmin(admin.ModelAdmin):
+            actions = [custom_action_1, 'custom_action_2']
+
+            def custom_action_2(self, request, queryset):
+                pass
+
+            custom_action_2.short_description = 'Local admin action 2.'
+
+        ma = BandAdmin(Band, admin.site)
+        self.assertEqual(ma.check(), [])
+        self.assertEqual(
+            [
+                desc
+                for _, name, desc in ma._get_base_actions()
+                if name.startswith('custom_action')
+            ],
+            [
+                'Local admin action 1.',
+                'Local admin action 2.',
+            ],
+        )