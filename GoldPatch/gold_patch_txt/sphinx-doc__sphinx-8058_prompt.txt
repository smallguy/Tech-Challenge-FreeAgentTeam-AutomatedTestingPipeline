# 修复代码生成提示词（实例ID：sphinx-doc__sphinx-8058）
## 代码仓库
sphinx-doc/sphinx

## 原始问题描述
Allow more compaction in gettext builder
The OKFN people manually merge all generated message catalogs into a single file for upload.  https://github.com/okfn/opendatamanual/blob/master/Makefile#L104

{{{gettext_compact}}} should support that use case too.

---
- Bitbucket: https://bitbucket.org/birkenfeld/sphinx/issue/784
- Originally reported by: Robert Lehmann
- Originally created at: 2011-10-11T16:43:20.007



## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_build_gettext.py b/tests/test_build_gettext.py
--- a/tests/test_build_gettext.py
+++ b/tests/test_build_gettext.py
@@ -174,3 +174,21 @@ def test_gettext_template_msgid_order_in_sphinxpot(app):
          'msgid "This is Template 2\\.".*'),
         result,
         flags=re.S)
+
+
+@pytest.mark.sphinx(
+    'gettext', srcdir='root-gettext',
+    confoverrides={'gettext_compact': 'documentation'})
+def test_build_single_pot(app):
+    app.builder.build_all()
+
+    assert (app.outdir / 'documentation.pot').isfile()
+
+    result = (app.outdir / 'documentation.pot').read_text()
+    assert re.search(
+        ('msgid "Todo".*'
+         'msgid "Like footnotes.".*'
+         'msgid "The minute.".*'
+         'msgid "Generated section".*'),
+        result,
+        flags=re.S)