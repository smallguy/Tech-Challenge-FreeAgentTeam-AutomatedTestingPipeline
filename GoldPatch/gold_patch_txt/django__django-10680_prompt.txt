# 修复代码生成提示词（实例ID：django__django-10680）
## 代码仓库
django/django

## 原始问题描述
Refactor AutoField logic into a mixin, implement checks and validators.
Description
	
Currently AutoField inherits from Field and BigAutoField from AutoField. In effect they largely redefine IntegerField and BigIntegerField respectively, but add in the auto field "behaviour". As a result they do not perform some of the system checks, e.g. max_length warning, nor the validation checks, e.g. range checks, that the integer fields do.
The proposal is to move all the auto field "behaviour" into a new AutoFieldMixin and fix AutoField and BigAutoField to inherit from this new mixin and IntegerField and BigIntegerField respectively.
Many attributes and methods would be nicely inherited from the correct parent field type without requiring redefinition:
description
empty_strings_allowed
default_error_messages
get_prep_value()
to_python()
AutoField and BigAutoField could also inherit the following checks from IntegerField:
IntegerField._check_max_length_warning()
AutoField and BigAutoField could also perform minimum and maximum value validation checks inherited from IntegerField.
This should be backwards compatible and potentially will make it easier to define new types of auto fields based on other fields in the future.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/invalid_models_tests/test_ordinary_fields.py b/tests/invalid_models_tests/test_ordinary_fields.py
--- a/tests/invalid_models_tests/test_ordinary_fields.py
+++ b/tests/invalid_models_tests/test_ordinary_fields.py
@@ -38,6 +38,21 @@ class Model(models.Model):
             ),
         ])
 
+    def test_max_length_warning(self):
+        class Model(models.Model):
+            auto = models.AutoField(primary_key=True, max_length=2)
+
+        field = Model._meta.get_field('auto')
+        self.assertEqual(field.check(), [
+            DjangoWarning(
+                "'max_length' is ignored when used with %s."
+                % field.__class__.__name__,
+                hint="Remove 'max_length' from field",
+                obj=field,
+                id='fields.W122',
+            ),
+        ])
+
 
 @isolate_apps('invalid_models_tests')
 class BinaryFieldTests(SimpleTestCase):
diff --git a/tests/model_fields/test_autofield.py b/tests/model_fields/test_autofield.py
--- a/tests/model_fields/test_autofield.py
+++ b/tests/model_fields/test_autofield.py
@@ -1,32 +1,32 @@
-from django.test import TestCase
+from django.db import models
+from django.test import SimpleTestCase
 
 from .models import AutoModel, BigAutoModel, SmallAutoModel
+from .test_integerfield import (
+    BigIntegerFieldTests, IntegerFieldTests, SmallIntegerFieldTests,
+)
 
 
-class AutoFieldTests(TestCase):
+class AutoFieldTests(IntegerFieldTests):
     model = AutoModel
 
-    def test_invalid_value(self):
-        tests = [
-            (TypeError, ()),
-            (TypeError, []),
-            (TypeError, {}),
-            (TypeError, set()),
-            (TypeError, object()),
-            (TypeError, complex()),
-            (ValueError, 'non-numeric string'),
-            (ValueError, b'non-numeric byte-string'),
-        ]
-        for exception, value in tests:
-            with self.subTest(value=value):
-                msg = "Field 'value' expected a number but got %r." % (value,)
-                with self.assertRaisesMessage(exception, msg):
-                    self.model.objects.create(value=value)
-
-
-class BigAutoFieldTests(AutoFieldTests):
+
+class BigAutoFieldTests(BigIntegerFieldTests):
     model = BigAutoModel
 
 
-class SmallAutoFieldTests(AutoFieldTests):
+class SmallAutoFieldTests(SmallIntegerFieldTests):
     model = SmallAutoModel
+
+
+class AutoFieldInheritanceTests(SimpleTestCase):
+
+    def test_isinstance_of_autofield(self):
+        for field in (models.BigAutoField, models.SmallAutoField):
+            with self.subTest(field.__name__):
+                self.assertIsInstance(field(), models.AutoField)
+
+    def test_issubclass_of_autofield(self):
+        for field in (models.BigAutoField, models.SmallAutoField):
+            with self.subTest(field.__name__):
+                self.assertTrue(issubclass(field, models.AutoField))
diff --git a/tests/model_fields/test_integerfield.py b/tests/model_fields/test_integerfield.py
--- a/tests/model_fields/test_integerfield.py
+++ b/tests/model_fields/test_integerfield.py
@@ -125,7 +125,7 @@ def test_redundant_backend_range_validators(self):
                         ranged_value_field.run_validators(max_backend_value + 1)
 
     def test_types(self):
-        instance = self.model(value=0)
+        instance = self.model(value=1)
         self.assertIsInstance(instance.value, int)
         instance.save()
         self.assertIsInstance(instance.value, int)
diff --git a/tests/validation/models.py b/tests/validation/models.py
--- a/tests/validation/models.py
+++ b/tests/validation/models.py
@@ -130,4 +130,7 @@ class MultipleAutoFields(models.Model):
         auto2 = models.AutoField(primary_key=True)
 except AssertionError as exc:
     assertion_error = exc
-assert str(assertion_error) == "Model validation.MultipleAutoFields can't have more than one AutoField."
+assert str(assertion_error) == (
+    "Model validation.MultipleAutoFields can't have more than one "
+    "auto-generated field."
+)