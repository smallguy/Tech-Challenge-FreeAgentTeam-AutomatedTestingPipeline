# 修复代码生成提示词（实例ID：django__django-15526）
## 代码仓库
django/django

## 原始问题描述
view_on_site redirect does not work for custom admin site.
Description
	
All reverse calls in contrib/admin/options.py have a current_app keyword argument, so they resolve with the current (possibly custom) admin site – except the reverse call in get_view_on_site_url. This lead to custom admin sites using the default admin to redirect via `view_on_site.
This is clearly a bug. When the default admin is handled with extra protections outside of Django (e.g. additional basic auth), users of the custom admin cannot use the "view on site" link because it routes through the default admin.
Patch is easy and already here: ​https://github.com/django/django/pull/15526
I'll try to provide a regression test as well.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/admin_views/tests.py b/tests/admin_views/tests.py
--- a/tests/admin_views/tests.py
+++ b/tests/admin_views/tests.py
@@ -7930,6 +7930,21 @@ def test_missing_get_absolute_url(self):
         model_admin = ModelAdmin(Worker, None)
         self.assertIsNone(model_admin.get_view_on_site_url(Worker()))
 
+    def test_custom_admin_site(self):
+        model_admin = ModelAdmin(City, customadmin.site)
+        content_type_pk = ContentType.objects.get_for_model(City).pk
+        redirect_url = model_admin.get_view_on_site_url(self.c1)
+        self.assertEqual(
+            redirect_url,
+            reverse(
+                f"{customadmin.site.name}:view_on_site",
+                kwargs={
+                    "content_type_id": content_type_pk,
+                    "object_id": self.c1.pk,
+                },
+            ),
+        )
+
 
 @override_settings(ROOT_URLCONF="admin_views.urls")
 class InlineAdminViewOnSiteTest(TestCase):