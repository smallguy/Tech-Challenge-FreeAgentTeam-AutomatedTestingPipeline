# 修复代码生成提示词（实例ID：django__django-13460）
## 代码仓库
django/django

## 原始问题描述
String formatting error when passing floats as values in {% blocktrans %} tags
Description
	
With the following template code:
{% blocktrans count counter=person.distance_in_miles|floatformat:0 %}{{ counter }} mile away{% plural %}{{ counter }} miles away{% endblocktrans %}
And a russian translation:
#, python-format
msgid "%(counter)s mile away"
msgid_plural "%(counter)s miles away"
msgstr[0] "На расстоянии %(counter)s мили"
msgstr[1] "На расстоянии %(counter)s миль"
msgstr[2] "На расстоянии %(counter)s миль"
Rendering the template fails with a String formatting error: "TypeError: not all arguments converted during string formatting".
This happens because gettext string formatting fails when a float is passed. Removing the floatformat and casting the value as int works fine.
This could be improved by either:
Swallow TypeError and throw a friendlier message saying the type might not be compatible with gettext's string formatting (not a fan of swallowing TypeError though, we need to make sure nothing else in do_translate throws such an exception)
Actively checking the type's compatibility with the string format


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/template_tests/syntax_tests/i18n/test_blocktranslate.py b/tests/template_tests/syntax_tests/i18n/test_blocktranslate.py
--- a/tests/template_tests/syntax_tests/i18n/test_blocktranslate.py
+++ b/tests/template_tests/syntax_tests/i18n/test_blocktranslate.py
@@ -298,6 +298,15 @@ def test_count(self, tag_name):
         with self.assertRaisesMessage(TemplateSyntaxError, msg):
             self.engine.render_to_string('template', {'a': [1, 2, 3]})
 
+    @setup({'template': (
+        '{% load i18n %}{% blocktranslate count counter=num %}{{ counter }}'
+        '{% plural %}{{ counter }}{% endblocktranslate %}'
+    )})
+    def test_count_not_number(self, tag_name):
+        msg = "'counter' argument to '{}' tag must be a number.".format(tag_name)
+        with self.assertRaisesMessage(TemplateSyntaxError, msg):
+            self.engine.render_to_string('template', {'num': '1'})
+
     @setup({'template': (
         '{% load i18n %}{% blocktranslate count count=var|length %}'
         'There is {{ count }} object. {% block a %} {% endblock %}'