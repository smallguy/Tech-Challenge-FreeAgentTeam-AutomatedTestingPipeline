# 修复代码生成提示词（实例ID：django__django-15491）
## 代码仓库
django/django

## 原始问题描述
Builtin csrf_failure() view uses wrong charset
Description
	
When Django detects wrong CSRF token, it shows an error using view django.views.csrf.csrf_failure. That file ends with
	return HttpResponseForbidden(t.render(c), content_type="text/html;")
When the template (CSRF_FAILURE_TEMPLATE_NAME) is written using UTF-8, it is rendered incorrectly. I suggest changing that line to
	return HttpResponseForbidden(t.render(c), content_type="text/html;"+
											 f" charset={settings.DEFAULT_CHARSET};")
or perhaps leaving out the content_type entirely.
Currently I'm using a workaround, by adding
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
to the template's HEAD, but it seems to me that the suggested fix is a better solution.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/csrf_tests/tests.py b/tests/csrf_tests/tests.py
--- a/tests/csrf_tests/tests.py
+++ b/tests/csrf_tests/tests.py
@@ -375,6 +375,7 @@ def _check_bad_or_missing_token(
         with self.assertLogs("django.security.csrf", "WARNING") as cm:
             resp = mw.process_view(req, post_form_view, (), {})
         self.assertEqual(403, resp.status_code)
+        self.assertEqual(resp["Content-Type"], "text/html; charset=utf-8")
         self.assertEqual(cm.records[0].getMessage(), "Forbidden (%s): " % expected)
 
     def test_csrf_cookie_bad_or_missing_token(self):
diff --git a/tests/httpwrappers/tests.py b/tests/httpwrappers/tests.py
--- a/tests/httpwrappers/tests.py
+++ b/tests/httpwrappers/tests.py
@@ -539,7 +539,6 @@ def test_redirect(self):
         response = HttpResponseRedirect(
             "/redirected/",
             content="The resource has temporarily moved",
-            content_type="text/html",
         )
         self.assertContains(
             response, "The resource has temporarily moved", status_code=302
@@ -592,7 +591,7 @@ def test_not_allowed(self):
         self.assertEqual(response.status_code, 405)
         # Standard HttpResponse init args can be used
         response = HttpResponseNotAllowed(
-            ["GET"], content="Only the GET method is allowed", content_type="text/html"
+            ["GET"], content="Only the GET method is allowed"
         )
         self.assertContains(response, "Only the GET method is allowed", status_code=405)
 
diff --git a/tests/responses/test_fileresponse.py b/tests/responses/test_fileresponse.py
--- a/tests/responses/test_fileresponse.py
+++ b/tests/responses/test_fileresponse.py
@@ -101,8 +101,10 @@ def test_content_type_buffer_explicit(self):
         self.assertEqual(response.headers["Content-Type"], "video/webm")
 
     def test_content_type_buffer_explicit_default(self):
-        response = FileResponse(io.BytesIO(b"binary content"), content_type="text/html")
-        self.assertEqual(response.headers["Content-Type"], "text/html")
+        response = FileResponse(
+            io.BytesIO(b"binary content"), content_type="text/html; charset=utf-8"
+        )
+        self.assertEqual(response.headers["Content-Type"], "text/html; charset=utf-8")
 
     def test_content_type_buffer_named(self):
         test_tuples = (