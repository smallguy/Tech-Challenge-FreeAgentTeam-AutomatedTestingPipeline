# 修复代码生成提示词（实例ID：django__django-11374）
## 代码仓库
django/django

## 原始问题描述
Unexpected behavior for django.utils.http.urlencode
Description
	
The function django.utils.http.urlencode has been changed to give unexpected result for tuple values (and other iterable objects) in the case when no iterations is expected:
>>> django.utils.http.urlencode(dict(a=('a','b')), doseq=False)
'a=%5B%27a%27%2C+%27b%27%5D'
One would expect the same as the standard library version (Note the first and last characters has been replaced by square brackets):
>>> urllib.parse.urlencode(dict(a=('a', 'b')), doseq=False)
'a=%28%27a%27%2C+%27b%27%29'
If the value is a list, the result if what one would expect:
>>> django.utils.http.urlencode(dict(a=['a','b']), doseq=False)
'a=%5B%27a%27%2C+%27b%27%5D'
>>> urllib.parse.urlencode(dict(a=['a', 'b']), doseq=False)
'a=%5B%27a%27%2C+%27b%27%5D'
Note: This is a problem when one has objects that has a __str__ method defined, returning the value one would want to be in the urlencode result, but the object by coincidence is also iterable.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/utils_tests/test_http.py b/tests/utils_tests/test_http.py
--- a/tests/utils_tests/test_http.py
+++ b/tests/utils_tests/test_http.py
@@ -34,7 +34,20 @@ def test_dict(self):
         ])
 
     def test_dict_containing_sequence_not_doseq(self):
-        self.assertEqual(urlencode({'a': [1, 2]}, doseq=False), 'a=%5B%271%27%2C+%272%27%5D')
+        self.assertEqual(urlencode({'a': [1, 2]}, doseq=False), 'a=%5B1%2C+2%5D')
+
+    def test_dict_containing_tuple_not_doseq(self):
+        self.assertEqual(urlencode({'a': (1, 2)}, doseq=False), 'a=%281%2C+2%29')
+
+    def test_custom_iterable_not_doseq(self):
+        class IterableWithStr:
+            def __str__(self):
+                return 'custom'
+
+            def __iter__(self):
+                yield from range(0, 3)
+
+        self.assertEqual(urlencode({'a': IterableWithStr()}, doseq=False), 'a=custom')
 
     def test_dict_containing_sequence_doseq(self):
         self.assertEqual(urlencode({'a': [1, 2]}, doseq=True), 'a=1&a=2')
@@ -61,14 +74,11 @@ def test_dict_with_sequence_of_bytes(self):
 
     def test_dict_with_bytearray(self):
         self.assertEqual(urlencode({'a': bytearray(range(2))}, doseq=True), 'a=0&a=1')
-        self.assertEqual(urlencode({'a': bytearray(range(2))}, doseq=False), 'a=%5B%270%27%2C+%271%27%5D')
+        self.assertEqual(urlencode({'a': bytearray(range(2))}, doseq=False), 'a=bytearray%28b%27%5Cx00%5Cx01%27%29')
 
     def test_generator(self):
-        def gen():
-            yield from range(2)
-
-        self.assertEqual(urlencode({'a': gen()}, doseq=True), 'a=0&a=1')
-        self.assertEqual(urlencode({'a': gen()}, doseq=False), 'a=%5B%270%27%2C+%271%27%5D')
+        self.assertEqual(urlencode({'a': range(2)}, doseq=True), 'a=0&a=1')
+        self.assertEqual(urlencode({'a': range(2)}, doseq=False), 'a=range%280%2C+2%29')
 
     def test_none(self):
         with self.assertRaisesMessage(TypeError, self.cannot_encode_none_msg):