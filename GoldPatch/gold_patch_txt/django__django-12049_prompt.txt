# 修复代码生成提示词（实例ID：django__django-12049）
## 代码仓库
django/django

## 原始问题描述
Applied migration detection may fail when using a case-insensitive collation
Description
	 
		(last modified by Tim Graham)
	 
Hello, 
I'm using this guide ​https://datascience.blog.wzb.eu/2017/03/21/using-django-with-an-existinglegacy-database for my studies with camelCasing together with Django (yes, I'm still trying to keep the naming convention we have inside our DB, also for the model's names)
Now, I'm really new to Django and I don't know if it's intended but this part of code inside django/db/migrations/executor.py' is doing case sensitive comparison to check if a column is already present in a database
column_names = [
	column.name for column in
	self.connection.introspection.get_table_description(self.connection.cursor(), table)
]
if field.column not in column_names:
	return False, project_state
so if my migration file contains something like this
		migrations.AddField(
			model_name='city',
			name='countrycode',
			field=models.ForeignKey(db_column='countryCode', on_delete=django.db.models.deletion.CASCADE, to='my_DB.country'),
and I run python3 manage.py migrate --database my_DB --fake-initial my_first_app
it fires an error saying that that table already exists 
django.db.utils.OperationalError: (1050, "Table 'city' already exists")
If I run python3 manage.py migrate --database my_DB --fake my_first_app it correctly fakes my_first_app
The my_DB collation is case insensitive, while MySql is running with the ' --lower-case-table-names=0' option


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/migrations/test_commands.py b/tests/migrations/test_commands.py
--- a/tests/migrations/test_commands.py
+++ b/tests/migrations/test_commands.py
@@ -14,7 +14,7 @@
 from django.db.backends.utils import truncate_name
 from django.db.migrations.exceptions import InconsistentMigrationHistory
 from django.db.migrations.recorder import MigrationRecorder
-from django.test import TestCase, override_settings
+from django.test import TestCase, override_settings, skipUnlessDBFeature
 
 from .models import UnicodeModel, UnserializableModel
 from .routers import TestRouter
@@ -197,6 +197,32 @@ def test_migrate_fake_initial(self):
             self.assertTableNotExists("migrations_tribble", using=db)
             self.assertTableNotExists("migrations_book", using=db)
 
+    @skipUnlessDBFeature('ignores_table_name_case')
+    def test_migrate_fake_initial_case_insensitive(self):
+        with override_settings(MIGRATION_MODULES={
+            'migrations': 'migrations.test_fake_initial_case_insensitive.initial',
+        }):
+            call_command('migrate', 'migrations', '0001', verbosity=0)
+            call_command('migrate', 'migrations', 'zero', fake=True, verbosity=0)
+
+        with override_settings(MIGRATION_MODULES={
+            'migrations': 'migrations.test_fake_initial_case_insensitive.fake_initial',
+        }):
+            out = io.StringIO()
+            call_command(
+                'migrate',
+                'migrations',
+                '0001',
+                fake_initial=True,
+                stdout=out,
+                verbosity=1,
+                no_color=True,
+            )
+            self.assertIn(
+                'migrations.0001_initial... faked',
+                out.getvalue().lower(),
+            )
+
     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations_fake_split_initial"})
     def test_migrate_fake_split_initial(self):
         """
diff --git a/tests/migrations/test_fake_initial_case_insensitive/fake_initial/0001_initial.py b/tests/migrations/test_fake_initial_case_insensitive/fake_initial/0001_initial.py
new file mode 100644
--- /dev/null
+++ b/tests/migrations/test_fake_initial_case_insensitive/fake_initial/0001_initial.py
@@ -0,0 +1,28 @@
+from django.db import migrations, models
+
+
+class Migration(migrations.Migration):
+    initial = True
+
+    operations = [
+        migrations.CreateModel(
+            'fakeinitialmodel',
+            [
+                ('id', models.AutoField(primary_key=True)),
+                ('field', models.CharField(max_length=20)),
+            ],
+            options={
+                'db_table': 'migrations_mIxEd_cAsE_iNiTiAl_mOdEl',
+            },
+        ),
+        migrations.AddField(
+            model_name='fakeinitialmodel',
+            name='field_mixed_case',
+            field=models.CharField(max_length=20, db_column='fIeLd_mIxEd_cAsE'),
+        ),
+        migrations.AddField(
+            model_name='fakeinitialmodel',
+            name='fake_initial_model',
+            field=models.ManyToManyField(to='migrations.fakeinitialmodel', db_table='m2m_mIxEd_cAsE'),
+        ),
+    ]
diff --git a/tests/migrations/test_fake_initial_case_insensitive/fake_initial/__init__.py b/tests/migrations/test_fake_initial_case_insensitive/fake_initial/__init__.py
new file mode 100644
diff --git a/tests/migrations/test_fake_initial_case_insensitive/initial/0001_initial.py b/tests/migrations/test_fake_initial_case_insensitive/initial/0001_initial.py
new file mode 100644
--- /dev/null
+++ b/tests/migrations/test_fake_initial_case_insensitive/initial/0001_initial.py
@@ -0,0 +1,23 @@
+from django.db import migrations, models
+
+
+class Migration(migrations.Migration):
+    initial = True
+
+    operations = [
+        migrations.CreateModel(
+            name='fakeinitialmodel',
+            fields=[
+                ('id', models.AutoField(primary_key=True)),
+                ('field', models.CharField(max_length=20)),
+                ('field_mixed_case', models.CharField(max_length=20, db_column='FiEld_MiXeD_CaSe')),
+                (
+                    'fake_initial_mode',
+                    models.ManyToManyField('migrations.FakeInitialModel', db_table='m2m_MiXeD_CaSe'),
+                ),
+            ],
+            options={
+                'db_table': 'migrations_MiXeD_CaSe_InItIaL_MoDel',
+            },
+        ),
+    ]
diff --git a/tests/migrations/test_fake_initial_case_insensitive/initial/__init__.py b/tests/migrations/test_fake_initial_case_insensitive/initial/__init__.py
new file mode 100644