# ä¿®å¤ä»£ç ç”Ÿæˆæç¤ºè¯ï¼ˆå®žä¾‹IDï¼špytest-dev__pytest-7231ï¼‰
## ä»£ç ä»“åº“
pytest-dev/pytest

## åŽŸå§‹é—®é¢˜æè¿°
warn when logging fails
```python
def func():
    logging.error("%s" , "a", "b")

def test_func():
    func()
```

Now an expectation will be thrown and written on the output... but no warning is thrown... so the test run can't be marked as failed. ðŸ¤” 


## å‚è€ƒé»„é‡‘è¡¥ä¸ï¼ˆæ­£ç¡®çš„ä¿®å¤æ–¹æ¡ˆï¼‰
diff --git a/testing/logging/test_reporting.py b/testing/logging/test_reporting.py
--- a/testing/logging/test_reporting.py
+++ b/testing/logging/test_reporting.py
@@ -3,6 +3,7 @@
 import re
 
 import pytest
+from _pytest.pytester import Testdir
 
 
 def test_nothing_logged(testdir):
@@ -1101,3 +1102,48 @@ def test_foo(caplog):
     )
     result = testdir.runpytest("--log-level=INFO", "--color=yes")
     assert result.ret == 0
+
+
+def test_logging_emit_error(testdir: Testdir) -> None:
+    """
+    An exception raised during emit() should fail the test.
+
+    The default behavior of logging is to print "Logging error"
+    to stderr with the call stack and some extra details.
+
+    pytest overrides this behavior to propagate the exception.
+    """
+    testdir.makepyfile(
+        """
+        import logging
+
+        def test_bad_log():
+            logging.warning('oops', 'first', 2)
+        """
+    )
+    result = testdir.runpytest()
+    result.assert_outcomes(failed=1)
+    result.stdout.fnmatch_lines(
+        [
+            "====* FAILURES *====",
+            "*not all arguments converted during string formatting*",
+        ]
+    )
+
+
+def test_logging_emit_error_supressed(testdir: Testdir) -> None:
+    """
+    If logging is configured to silently ignore errors, pytest
+    doesn't propagate errors either.
+    """
+    testdir.makepyfile(
+        """
+        import logging
+
+        def test_bad_log(monkeypatch):
+            monkeypatch.setattr(logging, 'raiseExceptions', False)
+            logging.warning('oops', 'first', 2)
+        """
+    )
+    result = testdir.runpytest()
+    result.assert_outcomes(passed=1)