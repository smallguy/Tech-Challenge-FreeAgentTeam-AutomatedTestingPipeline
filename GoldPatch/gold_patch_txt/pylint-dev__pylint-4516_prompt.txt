# 修复代码生成提示词（实例ID：pylint-dev__pylint-4516）
## 代码仓库
pylint-dev/pylint

## 原始问题描述
Ignore clause not ignoring directories
This is a different issue to [issues/908](https://github.com/PyCQA/pylint/issues/908).

### Steps to reproduce
1. Create a directory `test` and within that a directory `stuff`.
2. Create files `test/a.py` and `test/stuff/b.py`. Put syntax errors in both.
3. From `test`, run `pylint *.py **/*.py --ignore stuff`.

### Current behavior
Pylint does not ignore `stuff/b.py`, producing the message
```************* Module a
a.py:1:0: E0001: invalid syntax (<unknown>, line 1) (syntax-error)
************* Module b
stuff/b.py:1:0: E0001: invalid syntax (<unknown>, line 1) (syntax-error)
```

### Expected behavior
Pylint ignores the file `stuff/b.py`.

### pylint --version output
```pylint 2.2.2
astroid 2.1.0
Python 3.7.1 (default, Dec 14 2018, 19:28:38) 
[GCC 7.3.0]```

ignore-patterns does not skip non-top-level directories.
<!--
  Hi there! Thank you for discovering and submitting an issue.

  Before you submit this, make sure that the issue doesn't already exist
  or if it is not closed.

  Is your issue fixed on the preview release?: pip install pylint astroid --pre -U

-->

### Steps to reproduce
1.  create a a/b/c.py (where c.py will generate a pylint message, so that we get output) (along with the appropriate \_\_init\_\_.py files)
2.  Run pylint: pylint --ignore-patterns=b
3.  Run pylint: pylint --ignore-patterns=a

### Current behavior
c.py is skipped for ignore-patterns=a, but not for ignore-patterns=b

### Expected behavior
c.py should be skipped for both

### pylint --version output
pylint 2.1.1
astroid 2.1.0-dev
Python 3.6.3 (v3.6.3:2c5fed8, Oct  3 2017, 17:26:49) [MSC v.1900 32 bit (Intel)]



## 参考黄金补丁（正确的修复方案）
diff --git a/tests/lint/unittest_expand_modules.py b/tests/lint/unittest_expand_modules.py
--- a/tests/lint/unittest_expand_modules.py
+++ b/tests/lint/unittest_expand_modules.py
@@ -7,19 +7,29 @@
 
 import pytest
 
-from pylint.lint.expand_modules import _basename_in_ignore_list_re, expand_modules
+from pylint.lint.expand_modules import _is_in_ignore_list_re, expand_modules
 
 
-def test__basename_in_ignore_list_re_match():
-    patterns = [re.compile(".*enchilada.*"), re.compile("unittest_.*")]
-    assert _basename_in_ignore_list_re("unittest_utils.py", patterns)
-    assert _basename_in_ignore_list_re("cheese_enchiladas.xml", patterns)
+def test__is_in_ignore_list_re_match():
+    patterns = [
+        re.compile(".*enchilada.*"),
+        re.compile("unittest_.*"),
+        re.compile(".*tests/.*"),
+    ]
+    assert _is_in_ignore_list_re("unittest_utils.py", patterns)
+    assert _is_in_ignore_list_re("cheese_enchiladas.xml", patterns)
+    assert _is_in_ignore_list_re("src/tests/whatever.xml", patterns)
 
 
-def test__basename_in_ignore_list_re_nomatch():
-    patterns = [re.compile(".*enchilada.*"), re.compile("unittest_.*")]
-    assert not _basename_in_ignore_list_re("test_utils.py", patterns)
-    assert not _basename_in_ignore_list_re("enchilad.py", patterns)
+def test__is_in_ignore_list_re_nomatch():
+    patterns = [
+        re.compile(".*enchilada.*"),
+        re.compile("unittest_.*"),
+        re.compile(".*tests/.*"),
+    ]
+    assert not _is_in_ignore_list_re("test_utils.py", patterns)
+    assert not _is_in_ignore_list_re("enchilad.py", patterns)
+    assert not _is_in_ignore_list_re("src/tests.py", patterns)
 
 
 TEST_DIRECTORY = Path(__file__).parent.parent
@@ -70,8 +80,10 @@ def test__basename_in_ignore_list_re_nomatch():
     ],
 )
 def test_expand_modules(files_or_modules, expected):
-    ignore_list, ignore_list_re = [], []
-    modules, errors = expand_modules(files_or_modules, ignore_list, ignore_list_re)
+    ignore_list, ignore_list_re, ignore_list_paths_re = [], [], []
+    modules, errors = expand_modules(
+        files_or_modules, ignore_list, ignore_list_re, ignore_list_paths_re
+    )
     modules.sort(key=lambda d: d["name"])
     assert modules == expected
     assert not errors