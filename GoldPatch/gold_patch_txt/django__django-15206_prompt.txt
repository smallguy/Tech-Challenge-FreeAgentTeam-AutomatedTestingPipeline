# 修复代码生成提示词（实例ID：django__django-15206）
## 代码仓库
django/django

## 原始问题描述
never_cache()/cache_control() decorators raise error on duck-typed requests.
Description
	
The cache decorators cache_control, never_cache and sensitive_post_parameters no longer work with Django REST framework because they strictly check for an HttpRequest instance.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/decorators/tests.py b/tests/decorators/tests.py
--- a/tests/decorators/tests.py
+++ b/tests/decorators/tests.py
@@ -493,6 +493,15 @@ def a_view(request):
         self.assertIsNone(r.get('X-Frame-Options', None))
 
 
+class HttpRequestProxy:
+    def __init__(self, request):
+        self._request = request
+
+    def __getattr__(self, attr):
+        """Proxy to the underlying HttpRequest object."""
+        return getattr(self._request, attr)
+
+
 class NeverCacheDecoratorTest(SimpleTestCase):
 
     @mock.patch('time.time')
@@ -525,12 +534,27 @@ class MyClass:
             @never_cache
             def a_view(self, request):
                 return HttpResponse()
+
+        request = HttpRequest()
         msg = (
             "never_cache didn't receive an HttpRequest. If you are decorating "
             "a classmethod, be sure to use @method_decorator."
         )
         with self.assertRaisesMessage(TypeError, msg):
-            MyClass().a_view(HttpRequest())
+            MyClass().a_view(request)
+        with self.assertRaisesMessage(TypeError, msg):
+            MyClass().a_view(HttpRequestProxy(request))
+
+    def test_never_cache_decorator_http_request_proxy(self):
+        class MyClass:
+            @method_decorator(never_cache)
+            def a_view(self, request):
+                return HttpResponse()
+
+        request = HttpRequest()
+        response = MyClass().a_view(HttpRequestProxy(request))
+        self.assertIn('Cache-Control', response.headers)
+        self.assertIn('Expires', response.headers)
 
 
 class CacheControlDecoratorTest(SimpleTestCase):
@@ -544,5 +568,18 @@ def a_view(self, request):
             "cache_control didn't receive an HttpRequest. If you are "
             "decorating a classmethod, be sure to use @method_decorator."
         )
+        request = HttpRequest()
         with self.assertRaisesMessage(TypeError, msg):
-            MyClass().a_view(HttpRequest())
+            MyClass().a_view(request)
+        with self.assertRaisesMessage(TypeError, msg):
+            MyClass().a_view(HttpRequestProxy(request))
+
+    def test_cache_control_decorator_http_request_proxy(self):
+        class MyClass:
+            @method_decorator(cache_control(a='b'))
+            def a_view(self, request):
+                return HttpResponse()
+
+        request = HttpRequest()
+        response = MyClass().a_view(HttpRequestProxy(request))
+        self.assertEqual(response.headers['Cache-Control'], 'a=b')