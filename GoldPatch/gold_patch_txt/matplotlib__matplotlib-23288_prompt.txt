# 修复代码生成提示词（实例ID：matplotlib__matplotlib-23288）
## 代码仓库
matplotlib/matplotlib

## 原始问题描述
[Bug]: URL-area not rotated in PDFs
### Bug summary

The URL-sensitive area is not rotated in the PDF output

### Code for reproduction

```python
import matplotlib.pyplot as plt

plt.text(0.5, 0.5, "Long text with link", rotation=45, url="https://matplotlib.org")
plt.savefig("link.pdf")
```


### Actual outcome

Note that the link area is still the horizontal part as if the text was not rotated (this makes sense from reading the code).

### Expected outcome

Clicking on the text, not where the non-rotated text would have been would activate the URL.

### Additional information

In https://opensource.adobe.com/dc-acrobat-sdk-docs/pdfstandards/PDF32000_2008.pdf this is described in 12.5.6.5

From PDF version 1.6 it is possible to specify a "QuadPoints", i.e. a "rectangle" with four corners rather than just x, y, height, width as the current Rect has.

However it says:

> If this entry is not present or the conforming reader does not recognize
it, the region specified by the Rect entry should be used. QuadPoints
shall be ignored if any coordinate in the array lies outside the region
specified by Rect.

So one would also need to provide a larger Rect, which, for viewers not supporting QuadPoints will lead to that the total rectangle outlined by the rotated text will be clickable.

This also holds for mathtexts.

### Operating system

_No response_

### Matplotlib Version

main

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

git checkout


## 参考黄金补丁（正确的修复方案）
diff --git a/lib/matplotlib/tests/test_backend_pdf.py b/lib/matplotlib/tests/test_backend_pdf.py
--- a/lib/matplotlib/tests/test_backend_pdf.py
+++ b/lib/matplotlib/tests/test_backend_pdf.py
@@ -243,10 +243,37 @@ def test_text_urls():
                     (a for a in annots if a.A.URI == f'{test_url}{fragment}'),
                     None)
                 assert annot is not None
+                assert getattr(annot, 'QuadPoints', None) is None
                 # Positions in points (72 per inch.)
                 assert annot.Rect[1] == decimal.Decimal(y) * 72
 
 
+def test_text_rotated_urls():
+    pikepdf = pytest.importorskip('pikepdf')
+
+    test_url = 'https://test_text_urls.matplotlib.org/'
+
+    fig = plt.figure(figsize=(1, 1))
+    fig.text(0.1, 0.1, 'N', rotation=45, url=f'{test_url}')
+
+    with io.BytesIO() as fd:
+        fig.savefig(fd, format='pdf')
+
+        with pikepdf.Pdf.open(fd) as pdf:
+            annots = pdf.pages[0].Annots
+
+            # Iteration over Annots must occur within the context manager,
+            # otherwise it may fail depending on the pdf structure.
+            annot = next(
+                (a for a in annots if a.A.URI == f'{test_url}'),
+                None)
+            assert annot is not None
+            assert getattr(annot, 'QuadPoints', None) is not None
+            # Positions in points (72 per inch)
+            assert annot.Rect[0] == \
+               annot.QuadPoints[6] - decimal.Decimal('0.00001')
+
+
 @needs_usetex
 def test_text_urls_tex():
     pikepdf = pytest.importorskip('pikepdf')