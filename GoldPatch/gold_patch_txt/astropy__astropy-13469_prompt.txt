# 修复代码生成提示词（实例ID：astropy__astropy-13469）
## 代码仓库
astropy/astropy

## 原始问题描述
Can't convert a list of Astropy tables to a NumPy array of tables
I recently stumbled upon [a StackOverflow question](https://stackoverflow.com/questions/69414829/convert-a-list-of-astropy-table-in-a-numpy-array-of-astropy-table) where someone likes to convert a list of Tables to a NumPy array.
By default, NumPy will convert the Table along the way, resulting in the wrong data structure. 
Using a specific `dtype=object`, however, fails with 
```
ValueError: Datatype coercion is not allowed
```

This error leads directly to the source of `table.__array__()`, which explicitly checks for any `dtype` to be not `None`, which will raise the error.
The reasoning behind that is clear, as given in the comments below. 

But I wonder if an exception is reasonable for `dtype=object` here, and let that pass through. For a single Table, this may be odd, but not necessarily incorrect. And for a list of Tables, to be converted to an array, this may be helpful.


## 参考黄金补丁（正确的修复方案）
diff --git a/astropy/table/tests/test_table.py b/astropy/table/tests/test_table.py
--- a/astropy/table/tests/test_table.py
+++ b/astropy/table/tests/test_table.py
@@ -28,6 +28,7 @@
 from .conftest import MaskedTable, MIXIN_COLS
 
 from astropy.utils.compat.optional_deps import HAS_PANDAS  # noqa
+from astropy.utils.compat.numpycompat import NUMPY_LT_1_20
 
 
 @pytest.fixture
@@ -1405,6 +1406,22 @@ def test_byteswap_fits_array(self, table_types):
                 assert (data[colname].dtype.byteorder
                         == arr2[colname].dtype.byteorder)
 
+    def test_convert_numpy_object_array(self, table_types):
+        d = table_types.Table([[1, 2], [3, 4]], names=('a', 'b'))
+
+        # Single table
+        np_d = np.array(d, dtype=object)
+        assert isinstance(np_d, np.ndarray)
+        assert np_d[()] is d
+
+    @pytest.mark.xfail(NUMPY_LT_1_20, reason="numpy array introspection changed")
+    def test_convert_list_numpy_object_array(self, table_types):
+        d = table_types.Table([[1, 2], [3, 4]], names=('a', 'b'))
+        ds = [d, d, d]
+        np_ds = np.array(ds, dtype=object)
+        assert all([isinstance(t, table_types.Table) for t in np_ds])
+        assert all([np.array_equal(t, d) for t in np_ds])
+
 
 def _assert_copies(t, t2, deep=True):
     assert t.colnames == t2.colnames