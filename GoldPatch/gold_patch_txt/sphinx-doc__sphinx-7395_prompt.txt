# 修复代码生成提示词（实例ID：sphinx-doc__sphinx-7395）
## 代码仓库
sphinx-doc/sphinx

## 原始问题描述
The index directive with "builtin" type generates different index entry than the function directive
```
.. index::
   builtin: max
```
and
```
.. function:: max(iterable, *[, key, default])
```
generate similar but different index entries.

The former generates:
```
max
    built-in function
```
The latter generates:
```
max() (built-in function)
```
Differences:

1. Parenthesis are added or not after the name of the function.
2. Parenthesis are added or not around "built-in function".
3. It takes one or two lines.
4. "max" is a link or not.

Link: https://docs.python.org/3/genindex-M.html

This issue was reported on the Python bug tracker: https://bugs.python.org/issue21352.

Would be nice to unify and merge index entries generated by "function" and "index".


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_domain_py.py b/tests/test_domain_py.py
--- a/tests/test_domain_py.py
+++ b/tests/test_domain_py.py
@@ -461,6 +461,7 @@ def test_pydata(app):
 
 def test_pyfunction(app):
     text = (".. py:function:: func1\n"
+            ".. py:module:: example\n"
             ".. py:function:: func2\n"
             "   :async:\n")
     domain = app.env.get_domain('py')
@@ -469,15 +470,25 @@ def test_pyfunction(app):
                           [desc, ([desc_signature, ([desc_name, "func1"],
                                                     [desc_parameterlist, ()])],
                                   [desc_content, ()])],
+                          nodes.target,
+                          addnodes.index,
                           addnodes.index,
                           [desc, ([desc_signature, ([desc_annotation, "async "],
+                                                    [desc_addname, "example."],
                                                     [desc_name, "func2"],
                                                     [desc_parameterlist, ()])],
                                   [desc_content, ()])]))
+    assert_node(doctree[0], addnodes.index,
+                entries=[('pair', 'built-in function; func1()', 'func1', '', None)])
+    assert_node(doctree[3], addnodes.index,
+                entries=[('pair', 'module; example', 'module-example', '', None)])
+    assert_node(doctree[4], addnodes.index,
+                entries=[('single', 'func2() (in module example)', 'example.func2', '', None)])
+
     assert 'func1' in domain.objects
     assert domain.objects['func1'] == ('index', 'func1', 'function')
-    assert 'func2' in domain.objects
-    assert domain.objects['func2'] == ('index', 'func2', 'function')
+    assert 'example.func2' in domain.objects
+    assert domain.objects['example.func2'] == ('index', 'example.func2', 'function')
 
 
 def test_pymethod_options(app):