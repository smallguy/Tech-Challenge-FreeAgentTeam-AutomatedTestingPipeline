# 修复代码生成提示词（实例ID：astropy__astropy-14628）
## 代码仓库
astropy/astropy

## 原始问题描述
Make getting a topocentric ITRS position easier
### What is the problem this feature will solve?

Right now, it is not easy to create ITRS coordinates for sources relative to a given location (rather than geocentric), to the level that we have specific instructions on how to calculate relative `CartesianCoordinates` and then put these into an `ITRS`: https://docs.astropy.org/en/latest/coordinates/common_errors.html#altaz-calculations-for-earth-based-objects

This has led to numerous issues, the latest of which is #12678

### Describe the desired outcome

It would be nice if as part of `EarthLocation.get_itrs()` it would be possible to get a topocentric rather than a geocentric position. In #12678, @tomfelker and @mkbrewer [suggested](https://github.com/astropy/astropy/issues/12678#issuecomment-1463366166) (and below) to extend `.get_itrs()` to take not just an `obstime` but also a `location` argument, with an implementation along [the following lines](https://github.com/astropy/astropy/issues/12678#issuecomment-1464065862):

> the idea would be to simply add a `location` argument to `get_itrs()` that defaults to `None`. Then if a location is provided, `get_itrs()` would return a topocentric ITRS frame containing the difference between the object's position and that of the `location` argument. One could also use `EARTH_CENTER` as the default and always return the difference.

### Additional context

See #12768. Labeling this a good first issue since it is easy code wise. However, writing the tests and documentation will require understanding of how ITRS and the associated coordinate transformations work.


## 参考黄金补丁（正确的修复方案）
diff --git a/astropy/coordinates/tests/test_intermediate_transformations.py b/astropy/coordinates/tests/test_intermediate_transformations.py
--- a/astropy/coordinates/tests/test_intermediate_transformations.py
+++ b/astropy/coordinates/tests/test_intermediate_transformations.py
@@ -1036,24 +1036,12 @@ def test_itrs_straight_overhead():
     obj = EarthLocation(-1 * u.deg, 52 * u.deg, height=10.0 * u.km)
     home = EarthLocation(-1 * u.deg, 52 * u.deg, height=0.0 * u.km)
 
-    # An object that appears straight overhead - FOR A GEOCENTRIC OBSERVER.
-    itrs_geo = obj.get_itrs(t).cartesian
-
-    # now get the Geocentric ITRS position of observatory
-    obsrepr = home.get_itrs(t).cartesian
-
-    # topocentric ITRS position of a straight overhead object
-    itrs_repr = itrs_geo - obsrepr
-
-    # create a ITRS object that appears straight overhead for a TOPOCENTRIC OBSERVER
-    itrs_topo = ITRS(itrs_repr, obstime=t, location=home)
-
     # Check AltAz (though Azimuth can be anything so is not tested).
-    aa = itrs_topo.transform_to(AltAz(obstime=t, location=home))
+    aa = obj.get_itrs(t, location=home).transform_to(AltAz(obstime=t, location=home))
     assert_allclose(aa.alt, 90 * u.deg, atol=1 * u.uas, rtol=0)
 
     # Check HADec.
-    hd = itrs_topo.transform_to(HADec(obstime=t, location=home))
+    hd = obj.get_itrs(t, location=home).transform_to(HADec(obstime=t, location=home))
     assert_allclose(hd.ha, 0 * u.hourangle, atol=1 * u.uas, rtol=0)
     assert_allclose(hd.dec, 52 * u.deg, atol=1 * u.uas, rtol=0)