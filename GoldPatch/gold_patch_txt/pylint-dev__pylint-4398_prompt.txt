# 修复代码生成提示词（实例ID：pylint-dev__pylint-4398）
## 代码仓库
pylint-dev/pylint

## 原始问题描述
Add --fail-on option to always return error code if specific issues (or issue types) are found
We're using pylint in CI with two primary goals:

1. Ensure there are no error-category issues - this can be achieved by looking at the exit code
2. Ensure the overall linting score doesn't deteriorate too much - this can be achieved by using `--fail-under=8`

However if `--fail-under` is used, and the score is above that, then it passes even if there are error-category issues detected. Essentially it's acting as a "only throw fail (non-zero) codes if under this", instead of a "fail if under this, otherwise change nothing".

Two possible solutions I can think of here are:

1. Have a configuration option to prevent `--fail-under` from consuming other exit statuses. I.e. a way to say "if score is under N, return error code X, regardless of all else, otherwise change nothing".
2. Add a new option like `--fail-on=E,unused-import` which means that if there are any `E*` code (error-category) issues, or any `unused-error` issues, then fail, otherwise change nothing.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_self.py b/tests/test_self.py
--- a/tests/test_self.py
+++ b/tests/test_self.py
@@ -741,6 +741,69 @@ def test_fail_under(self):
             code=22,
         )
 
+    @pytest.mark.parametrize(
+        "fu_score,fo_msgs,fname,out",
+        [
+            # Essentially same test cases as --fail-under, but run with/without a detected issue code
+            # missing-function-docstring (C0116) is issue in both files
+            # --fail-under should be irrelevant as missing-function-docstring is hit
+            (-10, "missing-function-docstring", "fail_under_plus7_5.py", 16),
+            (6, "missing-function-docstring", "fail_under_plus7_5.py", 16),
+            (7.5, "missing-function-docstring", "fail_under_plus7_5.py", 16),
+            (7.6, "missing-function-docstring", "fail_under_plus7_5.py", 16),
+            (-11, "missing-function-docstring", "fail_under_minus10.py", 22),
+            (-10, "missing-function-docstring", "fail_under_minus10.py", 22),
+            (-9, "missing-function-docstring", "fail_under_minus10.py", 22),
+            (-5, "missing-function-docstring", "fail_under_minus10.py", 22),
+            # --fail-under should guide whether error code as missing-function-docstring is not hit
+            (-10, "broad-except", "fail_under_plus7_5.py", 0),
+            (6, "broad-except", "fail_under_plus7_5.py", 0),
+            (7.5, "broad-except", "fail_under_plus7_5.py", 0),
+            (7.6, "broad-except", "fail_under_plus7_5.py", 16),
+            (-11, "broad-except", "fail_under_minus10.py", 0),
+            (-10, "broad-except", "fail_under_minus10.py", 0),
+            (-9, "broad-except", "fail_under_minus10.py", 22),
+            (-5, "broad-except", "fail_under_minus10.py", 22),
+            # Enable by message id
+            (-10, "C0116", "fail_under_plus7_5.py", 16),
+            # Enable by category
+            (-10, "C", "fail_under_plus7_5.py", 16),
+            (-10, "fake1,C,fake2", "fail_under_plus7_5.py", 16),
+            # Ensure entire category not enabled by any msg id
+            (-10, "C0115", "fail_under_plus7_5.py", 0),
+        ],
+    )
+    def test_fail_on(self, fu_score, fo_msgs, fname, out):
+        self._runtest(
+            [
+                "--fail-under",
+                f"{fu_score:f}",
+                f"--fail-on={fo_msgs}",
+                "--enable=all",
+                join(HERE, "regrtest_data", fname),
+            ],
+            code=out,
+        )
+
+    @pytest.mark.parametrize(
+        "opts,out",
+        [
+            # Special case to ensure that disabled items from category aren't enabled
+            (["--disable=C0116", "--fail-on=C"], 0),
+            # Ensure order does not matter
+            (["--fail-on=C", "--disable=C0116"], 0),
+            # Ensure --fail-on takes precedence over --disable
+            (["--disable=C0116", "--fail-on=C0116"], 16),
+            # Ensure order does not matter
+            (["--fail-on=C0116", "--disable=C0116"], 16),
+        ],
+    )
+    def test_fail_on_edge_case(self, opts, out):
+        self._runtest(
+            opts + [join(HERE, "regrtest_data", "fail_under_plus7_5.py")],
+            code=out,
+        )
+
     @staticmethod
     def test_modify_sys_path() -> None:
         @contextlib.contextmanager