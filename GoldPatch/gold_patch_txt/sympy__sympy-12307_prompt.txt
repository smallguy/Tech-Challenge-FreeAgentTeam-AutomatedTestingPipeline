# 修复代码生成提示词（实例ID：sympy__sympy-12307）
## 代码仓库
sympy/sympy

## 原始问题描述
Codegen: sign function in Fortran
The Fortran code generated by Sympy for the sign function is not a valid Fortran syntax.

With Sympy 1.0 and Python 3.6:
```python
In [1]: import sympy as sp

In [2]: from sympy.abc import x

In [3]: sp.fcode(sp.sign(x))
Out[3]: '      sign(x)'
```
(The same behavior is obtained with `sympy.utilities.codegen`.)

The syntax of the sign function in Fortran is given [here](https://gcc.gnu.org/onlinedocs/gfortran/SIGN.html).

I guess it would be preferable to generate something like `sign(1, x)` or `sign(1d0, x)` depending of the context. I'm not sure how to get the same behavior than Sympy for `x=0`, but at least it would be compilable.


## 参考黄金补丁（正确的修复方案）
diff --git a/sympy/printing/tests/test_fcode.py b/sympy/printing/tests/test_fcode.py
--- a/sympy/printing/tests/test_fcode.py
+++ b/sympy/printing/tests/test_fcode.py
@@ -1,6 +1,6 @@
 from sympy import (sin, cos, atan2, log, exp, gamma, conjugate, sqrt,
     factorial, Integral, Piecewise, Add, diff, symbols, S, Float, Dummy, Eq,
-    Range, Catalan, EulerGamma, E, GoldenRatio, I, pi, Function, Rational, Integer, Lambda)
+    Range, Catalan, EulerGamma, E, GoldenRatio, I, pi, Function, Rational, Integer, Lambda, sign)
 
 from sympy.codegen import For, Assignment
 from sympy.core.relational import Relational
@@ -20,6 +20,14 @@ class nint(Function):
         def _fcode(self, printer):
             return "nint(%s)" % printer._print(self.args[0])
     assert fcode(nint(x)) == "      nint(x)"
+#issue 12267
+def test_fcode_sign():
+    x=symbols('x')
+    y=symbols('y', integer=True)
+    z=symbols('z', complex=True)
+    assert fcode(sign(x), source_format='free') == "merge(0d0, dsign(1d0, x), x == 0d0)"
+    assert fcode(sign(y), source_format='free') == "merge(0, isign(1, y), y == 0)"
+    assert fcode(sign(z), source_format='free') == "merge(cmplx(0d0, 0d0), z/abs(z), abs(z) == 0d0)"
 
 
 def test_fcode_Pow():