# 修复代码生成提示词（实例ID：django__django-11170）
## 代码仓库
django/django

## 原始问题描述
UnicodeDecodeError when loading debug templates.
Description
	
While studying Django, I had an error where the technical_500.html page was not properly printed.
In the log window, UnicodeDecodeError was continuously printed, and in the template, the sentence 'A server error occured. Please contact the administrator' was printed
So when I checked the technical_500.html file of Django 2.2version, I found that the dotdotdot wrapped by the <span>tag on the 239th line was changed to ellipsis.
Apparently, the version of Django 2.1.8 was a dotdotdot.
So I took steps to change the 239th line's ellipsis to dotdotdot.
Or, when reading the technical_500.html file from inside the debug.py file, the encoding format was set to utf-8.
This enabled me to resolve the error.
Did you intentionally modify the technical_html file?


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/view_tests/tests/test_debug.py b/tests/view_tests/tests/test_debug.py
--- a/tests/view_tests/tests/test_debug.py
+++ b/tests/view_tests/tests/test_debug.py
@@ -7,6 +7,7 @@
 import threading
 from io import StringIO
 from pathlib import Path
+from unittest import mock
 
 from django.core import mail
 from django.core.files.uploadedfile import SimpleUploadedFile
@@ -20,7 +21,8 @@
 from django.utils.safestring import mark_safe
 from django.views.debug import (
     CLEANSED_SUBSTITUTE, CallableSettingWrapper, ExceptionReporter,
-    cleanse_setting, technical_500_response,
+    Path as DebugPath, cleanse_setting, default_urlconf,
+    technical_404_response, technical_500_response,
 )
 
 from ..views import (
@@ -222,6 +224,19 @@ def test_regression_21530(self):
             status_code=404
         )
 
+    def test_template_encoding(self):
+        """
+        The templates are loaded directly, not via a template loader, and
+        should be opened as utf-8 charset as is the default specified on
+        template engines.
+        """
+        with mock.patch.object(DebugPath, 'open') as m:
+            default_urlconf(None)
+            m.assert_called_once_with(encoding='utf-8')
+            m.reset_mock()
+            technical_404_response(mock.MagicMock(), mock.Mock())
+            m.assert_called_once_with(encoding='utf-8')
+
 
 class DebugViewQueriesAllowedTests(SimpleTestCase):
     # May need a query to initialize MySQL connection
@@ -648,6 +663,20 @@ def __str__(self):
         text = reporter.get_traceback_text()
         self.assertIn('USER: [unable to retrieve the current user]', text)
 
+    def test_template_encoding(self):
+        """
+        The templates are loaded directly, not via a template loader, and
+        should be opened as utf-8 charset as is the default specified on
+        template engines.
+        """
+        reporter = ExceptionReporter(None, None, None, None)
+        with mock.patch.object(DebugPath, 'open') as m:
+            reporter.get_traceback_html()
+            m.assert_called_once_with(encoding='utf-8')
+            m.reset_mock()
+            reporter.get_traceback_text()
+            m.assert_called_once_with(encoding='utf-8')
+
 
 class PlainTextReportTests(SimpleTestCase):
     rf = RequestFactory()