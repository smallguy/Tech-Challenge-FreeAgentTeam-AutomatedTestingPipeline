# 修复代码生成提示词（实例ID：django__django-12148）
## 代码仓库
django/django

## 原始问题描述
reverse() and get_absolute_url() may return different values for same FlatPage
Description
	 
		(last modified by Tim Graham)
	 
The FlatPage model implements get_absolute_url() without using reverse(). The comment suggests, that this handles SCRIPT_NAME issues, but the link in the admin interface does not work, if you are using a prefix for the flatpages urls. The templatetag for resolving a flatpage works just fine.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/flatpages_tests/absolute_urls.py b/tests/flatpages_tests/absolute_urls.py
new file mode 100644
--- /dev/null
+++ b/tests/flatpages_tests/absolute_urls.py
@@ -0,0 +1,6 @@
+from django.contrib.flatpages import views
+from django.urls import path
+
+urlpatterns = [
+    path('flatpage/', views.flatpage, {'url': '/hardcoded/'}),
+]
diff --git a/tests/flatpages_tests/no_slash_urls.py b/tests/flatpages_tests/no_slash_urls.py
new file mode 100644
--- /dev/null
+++ b/tests/flatpages_tests/no_slash_urls.py
@@ -0,0 +1,5 @@
+from django.urls import include, path
+
+urlpatterns = [
+    path('flatpage', include('django.contrib.flatpages.urls')),
+]
diff --git a/tests/flatpages_tests/test_models.py b/tests/flatpages_tests/test_models.py
--- a/tests/flatpages_tests/test_models.py
+++ b/tests/flatpages_tests/test_models.py
@@ -1,5 +1,5 @@
 from django.contrib.flatpages.models import FlatPage
-from django.test import SimpleTestCase
+from django.test import SimpleTestCase, override_settings
 from django.test.utils import override_script_prefix
 
 
@@ -17,3 +17,16 @@ def test_get_absolute_url_honors_script_prefix(self):
 
     def test_str(self):
         self.assertEqual(str(self.page), '/café/ -- Café!')
+
+    @override_settings(ROOT_URLCONF='flatpages_tests.urls')
+    def test_get_absolute_url_include(self):
+        self.assertEqual(self.page.get_absolute_url(), '/flatpage_root/caf%C3%A9/')
+
+    @override_settings(ROOT_URLCONF='flatpages_tests.no_slash_urls')
+    def test_get_absolute_url_include_no_slash(self):
+        self.assertEqual(self.page.get_absolute_url(), '/flatpagecaf%C3%A9/')
+
+    @override_settings(ROOT_URLCONF='flatpages_tests.absolute_urls')
+    def test_get_absolute_url_with_hardcoded_url(self):
+        fp = FlatPage(title='Test', url='/hardcoded/')
+        self.assertEqual(fp.get_absolute_url(), '/flatpage/')
diff --git a/tests/flatpages_tests/test_sitemaps.py b/tests/flatpages_tests/test_sitemaps.py
--- a/tests/flatpages_tests/test_sitemaps.py
+++ b/tests/flatpages_tests/test_sitemaps.py
@@ -31,5 +31,8 @@ def setUpTestData(cls):
 
     def test_flatpage_sitemap(self):
         response = self.client.get('/flatpages/sitemap.xml')
-        self.assertIn(b'<url><loc>http://example.com/foo/</loc></url>', response.getvalue())
-        self.assertNotIn(b'<url><loc>http://example.com/private-foo/</loc></url>', response.getvalue())
+        self.assertIn(b'<url><loc>http://example.com/flatpage_root/foo/</loc></url>', response.getvalue())
+        self.assertNotIn(
+            b'<url><loc>http://example.com/flatpage_root/private-foo/</loc></url>',
+            response.getvalue(),
+        )
diff --git a/tests/flatpages_tests/urls.py b/tests/flatpages_tests/urls.py
--- a/tests/flatpages_tests/urls.py
+++ b/tests/flatpages_tests/urls.py
@@ -8,6 +8,6 @@
         {'sitemaps': {'flatpages': FlatPageSitemap}},
         name='django.contrib.sitemaps.views.sitemap'),
 
-    path('flatpage_root', include('django.contrib.flatpages.urls')),
+    path('flatpage_root/', include('django.contrib.flatpages.urls')),
     path('accounts/', include('django.contrib.auth.urls')),
 ]