# 修复代码生成提示词（实例ID：scikit-learn__scikit-learn-14706）
## 代码仓库
scikit-learn/scikit-learn

## 原始问题描述
kernel_approximation.Nystroem does not support precomputed kernel
The documentation says that precomputed kernels are supported in Nystroem, but in reality it does not seem to be the case: https://scikit-learn.org/stable/modules/kernel_approximation.html

> By default Nystroem uses the rbf kernel, but it can use any kernel function or a precomputed kernel matrix.

Example code:
```python
from sklearn.kernel_approximation import Nystroem
nys = Nystroem(kernel='precomputed')
nys.fit_transform(K)
```
Leads to `KeyError: 'precomputed'`


## 参考黄金补丁（正确的修复方案）
diff --git a/sklearn/tests/test_kernel_approximation.py b/sklearn/tests/test_kernel_approximation.py
--- a/sklearn/tests/test_kernel_approximation.py
+++ b/sklearn/tests/test_kernel_approximation.py
@@ -254,3 +254,24 @@ def linear_kernel(X, Y):
         ny = Nystroem(kernel=linear_kernel, **param)
         with pytest.raises(ValueError, match=msg):
             ny.fit(X)
+
+
+def test_nystroem_precomputed_kernel():
+    # Non-regression: test Nystroem on precomputed kernel.
+    # PR - 14706
+    rnd = np.random.RandomState(12)
+    X = rnd.uniform(size=(10, 4))
+
+    K = polynomial_kernel(X, degree=2, coef0=.1)
+    nystroem = Nystroem(kernel='precomputed', n_components=X.shape[0])
+    X_transformed = nystroem.fit_transform(K)
+    assert_array_almost_equal(np.dot(X_transformed, X_transformed.T), K)
+
+    # if degree, gamma or coef0 is passed, we raise a ValueError
+    msg = "Don't pass gamma, coef0 or degree to Nystroem"
+    params = ({'gamma': 1}, {'coef0': 1}, {'degree': 2})
+    for param in params:
+        ny = Nystroem(kernel='precomputed', n_components=X.shape[0],
+                      **param)
+        with pytest.raises(ValueError, match=msg):
+            ny.fit(K)