# 修复代码生成提示词（实例ID：matplotlib__matplotlib-25499）
## 代码仓库
matplotlib/matplotlib

## 原始问题描述
[Bug]: Setting bbox_inches to a Bbox in fig.savefig resizes colorbar
### Bug summary

Setting bbox_inches in fig.savefig to a specified Bbox rather than "tight" resizes the colorbar relative to when bbox_inches is not set—the resulting colorbar is a lot larger than it should be. 

### Code for reproduction

```python
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt

x = np.linspace(0, 2*np.pi, 100)
y = np.linspace(0, 2*np.pi, 100)

X, Y = np.meshgrid(x,y)

fig, ax = plt.subplots(figsize=(4,4))

pc = ax.pcolormesh(x, y, np.sin(X)*np.sin(Y))
fig.colorbar(pc, ax=ax, aspect=40)

# Uncomment the first fig.savefig to get the correct output on the second call
# fig.savefig('nobbox_inches.png')
fig.savefig('bbox_inches.png', bbox_inches=mpl.transforms.Bbox([[0, 0], [4, 4]]))
```


### Actual outcome

![bbox_inches](https://user-images.githubusercontent.com/4522204/157296452-99015f35-6dfc-4a09-b447-7f524227582e.png)


### Expected outcome

![nobbox_inches](https://user-images.githubusercontent.com/4522204/157296483-0ac707a7-62e6-489b-9a06-f5a679ecf644.png)


### Additional information

Calling fig.savefig without bbox_inches set first and then calling it again with bbox_inches set produces expected outcome.
Calling plt.show() prior to savefig also works.

### Operating system

MacOS 12.2.1 (Monterey)

### Matplotlib Version

3.5.1

### Matplotlib Backend

inline (for interactive), png for plot, also a problem with pdf

### Python version

3.9.10

### Jupyter version

Jupyter lab 3.2.9

### Installation

conda


## 参考黄金补丁（正确的修复方案）
diff --git a/lib/matplotlib/tests/test_figure.py b/lib/matplotlib/tests/test_figure.py
--- a/lib/matplotlib/tests/test_figure.py
+++ b/lib/matplotlib/tests/test_figure.py
@@ -546,13 +546,24 @@ def test_savefig_pixel_ratio(backend):
     assert ratio1 == ratio2
 
 
-def test_savefig_preserve_layout_engine(tmp_path):
+def test_savefig_preserve_layout_engine():
     fig = plt.figure(layout='compressed')
-    fig.savefig(tmp_path / 'foo.png', bbox_inches='tight')
+    fig.savefig(io.BytesIO(), bbox_inches='tight')
 
     assert fig.get_layout_engine()._compress
 
 
+def test_savefig_locate_colorbar():
+    fig, ax = plt.subplots()
+    pc = ax.pcolormesh(np.random.randn(2, 2))
+    cbar = fig.colorbar(pc, aspect=40)
+    fig.savefig(io.BytesIO(), bbox_inches=mpl.transforms.Bbox([[0, 0], [4, 4]]))
+
+    # Check that an aspect ratio has been applied.
+    assert (cbar.ax.get_position(original=True).bounds !=
+            cbar.ax.get_position(original=False).bounds)
+
+
 @mpl.rc_context({"savefig.transparent": True})
 @check_figures_equal(extensions=["png"])
 def test_savefig_transparent(fig_test, fig_ref):