# 修复代码生成提示词（实例ID：sympy__sympy-21208）
## 代码仓库
sympy/sympy

## 原始问题描述
Results diverge when use `diff` on a matrix or its elemetns
create a one-element matrix A as below:
```python
>>> from sympy import *
>>> t = symbols('t')
>>> x = Function('x')(t)
>>> dx = x.diff(t)
>>> A = Matrix([cos(x) + cos(x) * dx])
```
when use `diff` on matrix A:
```python
>>> (A.diff(x))[0,0]
-sin(x(t))
```
when use `diff` on the single element of A: 
```python
>>> A[0,0].diff(x)
-sin(x(t))*Derivative(x(t), t) - sin(x(t))
```
but if use `applyfunc` method on A, the result is the same as above:
```python
>>> A.applyfunc(lambda ij: ij.diff(x))[0,0]
-sin(x(t))*Derivative(x(t), t) - sin(x(t))
```
is this a bug or supposed behavior of matrix calculus?


## 参考黄金补丁（正确的修复方案）
diff --git a/sympy/matrices/expressions/tests/test_matexpr.py b/sympy/matrices/expressions/tests/test_matexpr.py
--- a/sympy/matrices/expressions/tests/test_matexpr.py
+++ b/sympy/matrices/expressions/tests/test_matexpr.py
@@ -1,8 +1,9 @@
 from sympy import (KroneckerDelta, diff, Sum, Dummy, factor,
                    expand, zeros, gcd_terms, Eq, Symbol)
 
-from sympy.core import S, symbols, Add, Mul, SympifyError, Rational
-from sympy.functions import sin, cos, sqrt, cbrt, exp
+from sympy.core import (S, symbols, Add, Mul, SympifyError, Rational,
+                    Function)
+from sympy.functions import sin, cos, tan, sqrt, cbrt, exp
 from sympy.simplify import simplify
 from sympy.matrices import (ImmutableMatrix, Inverse, MatAdd, MatMul,
         MatPow, Matrix, MatrixExpr, MatrixSymbol, ShapeError,
@@ -340,6 +341,18 @@ def test_issue_7842():
     assert Eq(A, B) == True
 
 
+def test_issue_21195():
+    t = symbols('t')
+    x = Function('x')(t)
+    dx = x.diff(t)
+    exp1 = cos(x) + cos(x)*dx
+    exp2 = sin(x) + tan(x)*(dx.diff(t))
+    exp3 = sin(x)*sin(t)*(dx.diff(t)).diff(t)
+    A = Matrix([[exp1], [exp2], [exp3]])
+    B = Matrix([[exp1.diff(x)], [exp2.diff(x)], [exp3.diff(x)]])
+    assert A.diff(x) == B
+
+
 def test_MatMul_postprocessor():
     z = zeros(2)
     z1 = ZeroMatrix(2, 2)