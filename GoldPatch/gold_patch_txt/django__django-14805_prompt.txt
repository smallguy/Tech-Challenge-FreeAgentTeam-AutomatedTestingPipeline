# 修复代码生成提示词（实例ID：django__django-14805）
## 代码仓库
django/django

## 原始问题描述
Add output to makemigrations and migrate commands with --noinput
Description
	
The --noinput option to makemigrations seems to also mean "no output". It would be nice for scripting purposes if there could be some kind of output. When writing a script that helps manage migrations, it would be nice to be able to detect that the migrations needed input from the developer so that the script can fail gracefully and inform the developer that manual intervention is required. Right now the options seem to be to not use the --noinput options and have the prompt interrupt the script, or to use the option and have no idea when migrations failed because they required input.
I'm not very picky as far as how this functionality should be implemented goes. I would think that a little warning like
"No migrations run because input was required but --noinput option was specified."
would be sufficient. This could be output to stdout or stderr, either all the time or perhaps only if an additional option was set.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/migrations/test_commands.py b/tests/migrations/test_commands.py
--- a/tests/migrations/test_commands.py
+++ b/tests/migrations/test_commands.py
@@ -1361,7 +1361,14 @@ class Meta:
 
         with self.assertRaises(SystemExit):
             with self.temporary_migration_module(module="migrations.test_migrations_no_default"):
-                call_command("makemigrations", "migrations", interactive=False)
+                with captured_stdout() as out:
+                    call_command('makemigrations', 'migrations', interactive=False)
+        self.assertIn(
+            "Field 'silly_int' on model 'sillymodel' not migrated: it is "
+            "impossible to add a non-nullable field without specifying a "
+            "default.",
+            out.getvalue(),
+        )
 
     def test_makemigrations_interactive_not_null_addition(self):
         """
@@ -1417,10 +1424,15 @@ class Author(models.Model):
             class Meta:
                 app_label = "migrations"
 
-        out = io.StringIO()
         with self.temporary_migration_module(module="migrations.test_migrations"):
-            call_command("makemigrations", "migrations", interactive=False, stdout=out)
+            with captured_stdout() as out:
+                call_command('makemigrations', 'migrations', interactive=False)
         self.assertIn("Alter field slug on author", out.getvalue())
+        self.assertIn(
+            "Field 'slug' on model 'author' given a default of NOT PROVIDED "
+            "and must be corrected.",
+            out.getvalue(),
+        )
 
     def test_makemigrations_interactive_not_null_alteration(self):
         """
@@ -1872,6 +1884,27 @@ class Meta:
                 with self.assertRaises(SystemExit):
                     call_command('makemigrations', 'migrations', interactive=True)
 
+    def test_makemigrations_non_interactive_auto_now_add_addition(self):
+        """
+        Non-interactive makemigrations fails when a default is missing on a
+        new field when auto_now_add=True.
+        """
+        class Entry(models.Model):
+            creation_date = models.DateTimeField(auto_now_add=True)
+
+            class Meta:
+                app_label = 'migrations'
+
+        with self.temporary_migration_module(module='migrations.test_auto_now_add'):
+            with self.assertRaises(SystemExit), captured_stdout() as out:
+                call_command('makemigrations', 'migrations', interactive=False)
+        self.assertIn(
+            "Field 'creation_date' on model 'entry' not migrated: it is "
+            "impossible to add a field with 'auto_now_add=True' without "
+            "specifying a default.",
+            out.getvalue(),
+        )
+
     def test_makemigrations_interactive_unique_callable_default_addition(self):
         """
         makemigrations prompts the user when adding a unique field with