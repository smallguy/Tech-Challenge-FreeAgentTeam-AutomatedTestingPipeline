# 修复代码生成提示词（实例ID：django__django-11983）
## 代码仓库
django/django

## 原始问题描述
Admin's date_hierarchy excludes 31 october when using timezone with DST in northern hemisphere.
Description
	
https://code.djangoproject.com/ticket/28933 introduced a subtle bug where it accidentally excludes 31 october in the admin date_hierarchy filter after selecting october. The underlying reason is that the generated sql has < 2019-10-31 as opposed to < 2019-11-01 as it should be. This in turn is caused by applying the timezone for 2019-10-01 (with DST in countries in the northern hemisphere) to the date used for 2019-11-01. This causes the date conversion to actually operate on 2019-10-31 23:00 instead of 2019-11-01 00:00. It's a bit hard to explain in words, PR incoming that hopefully explains better in code.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/admin_changelist/test_date_hierarchy.py b/tests/admin_changelist/test_date_hierarchy.py
--- a/tests/admin_changelist/test_date_hierarchy.py
+++ b/tests/admin_changelist/test_date_hierarchy.py
@@ -46,6 +46,24 @@ def test_bounded_params_with_time_zone(self):
                 make_aware(datetime(2017, 3, 1)),
             )
 
+    def test_bounded_params_with_dst_time_zone(self):
+        tests = [
+            # Northern hemisphere.
+            ('Asia/Jerusalem', 3),
+            ('Asia/Jerusalem', 10),
+            # Southern hemisphere.
+            ('Pacific/Chatham', 4),
+            ('Pacific/Chatham', 9),
+        ]
+        for time_zone, month in tests:
+            with self.subTest(time_zone=time_zone, month=month):
+                with self.settings(USE_TZ=True, TIME_ZONE=time_zone):
+                    self.assertDateParams(
+                        {'year': 2019, 'month': month},
+                        make_aware(datetime(2019, month, 1)),
+                        make_aware(datetime(2019, month + 1, 1)),
+                    )
+
     def test_invalid_params(self):
         tests = (
             {'year': 'x'},