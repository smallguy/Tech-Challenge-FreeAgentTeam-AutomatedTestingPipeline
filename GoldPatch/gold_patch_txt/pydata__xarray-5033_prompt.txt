# 修复代码生成提示词（实例ID：pydata__xarray-5033）
## 代码仓库
pydata/xarray

## 原始问题描述
Simplify adding custom backends
<!-- Please do a quick search of existing issues to make sure that this has not been asked before. -->

**Is your feature request related to a problem? Please describe.**
I've been working on opening custom hdf formats in xarray, reading up on the apiv2 it is currently only possible to declare a new external plugin in setup.py but that doesn't seem easy or intuitive to me.

**Describe the solution you'd like**
Why can't we simply be allowed to add functions to the engine parameter? Example:
```python
from custom_backend import engine

ds = xr.load_dataset(filename, engine=engine)
```
This seems like a small function change to me from my initial _quick_ look because there's mainly a bunch of string checks in the normal case until we get to the registered backend functions, if we send in a function instead in the engine-parameter we can just bypass those checks.



## 参考黄金补丁（正确的修复方案）
diff --git a/xarray/tests/test_backends_api.py b/xarray/tests/test_backends_api.py
--- a/xarray/tests/test_backends_api.py
+++ b/xarray/tests/test_backends_api.py
@@ -1,6 +1,9 @@
+import numpy as np
+
+import xarray as xr
 from xarray.backends.api import _get_default_engine
 
-from . import requires_netCDF4, requires_scipy
+from . import assert_identical, requires_netCDF4, requires_scipy
 
 
 @requires_netCDF4
@@ -14,3 +17,20 @@ def test__get_default_engine():
 
     engine_default = _get_default_engine("/example")
     assert engine_default == "netcdf4"
+
+
+def test_custom_engine():
+    expected = xr.Dataset(
+        dict(a=2 * np.arange(5)), coords=dict(x=("x", np.arange(5), dict(units="s")))
+    )
+
+    class CustomBackend(xr.backends.BackendEntrypoint):
+        def open_dataset(
+            filename_or_obj,
+            drop_variables=None,
+            **kwargs,
+        ):
+            return expected.copy(deep=True)
+
+    actual = xr.open_dataset("fake_filename", engine=CustomBackend)
+    assert_identical(expected, actual)