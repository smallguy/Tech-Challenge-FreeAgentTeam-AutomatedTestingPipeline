# 修复代码生成提示词（实例ID：sphinx-doc__sphinx-10427）
## 代码仓库
sphinx-doc/sphinx

## 原始问题描述
`autodoc_preserve_defaults` doesn't work on class methods
### Describe the bug

Default values for class methods are rendered as their `__repr__`, even with `autodoc_preserve_defaults = True` in conf.py.

### How to Reproduce

Extract the [attached example](https://github.com/sphinx-doc/sphinx/files/8620112/classmethod_defaults_mre.zip) and run `make html`. Note that the default value for the argument of the regular and static methods render correctly as `SOME_DEFAULT`, but the default value for the class method renders as its __repr__.

[classmethod_defaults_mre.zip](https://github.com/sphinx-doc/sphinx/files/8620112/classmethod_defaults_mre.zip)



### Expected behavior

All three methods' argument's default values should render as `SOME_DEFAULT`

### Your project

https://github.com/sphinx-doc/sphinx/files/8620112/classmethod_defaults_mre.zip

### Screenshots

Screenshot of the rendered attached example demonstrating incorrect rendering:

![Screenshot of the rendered attached example demonstrating incorrect rendering](https://user-images.githubusercontent.com/28590748/166675055-49d499e2-1bcc-4c3b-b10f-3607fc5e9660.png)

### OS

Arch Linux

### Python version

3.10.0

### Sphinx version

Tested on 4.5 and current 5.x branch (commit 335bf513e) 

### Sphinx extensions

sphinx.ext.autodoc

### Extra tools

_No response_

### Additional context

_No response_


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/roots/test-ext-autodoc/target/preserve_defaults.py b/tests/roots/test-ext-autodoc/target/preserve_defaults.py
--- a/tests/roots/test-ext-autodoc/target/preserve_defaults.py
+++ b/tests/roots/test-ext-autodoc/target/preserve_defaults.py
@@ -22,3 +22,9 @@ def meth(self, name: str = CONSTANT, sentinel: Any = SENTINEL,
              now: datetime = datetime.now(), color: int = 0xFFFFFF,
              *, kwarg1, kwarg2 = 0xFFFFFF) -> None:
         """docstring"""
+
+    @classmethod
+    def clsmeth(cls, name: str = CONSTANT, sentinel: Any = SENTINEL,
+                now: datetime = datetime.now(), color: int = 0xFFFFFF,
+                *, kwarg1, kwarg2 = 0xFFFFFF) -> None:
+        """docstring"""
diff --git a/tests/test_ext_autodoc_preserve_defaults.py b/tests/test_ext_autodoc_preserve_defaults.py
--- a/tests/test_ext_autodoc_preserve_defaults.py
+++ b/tests/test_ext_autodoc_preserve_defaults.py
@@ -28,6 +28,15 @@ def test_preserve_defaults(app):
         '   docstring',
         '',
         '',
+        '   .. py:method:: Class.clsmeth(name: str = CONSTANT, sentinel: ~typing.Any = '
+        'SENTINEL, now: ~datetime.datetime = datetime.now(), color: int = %s, *, '
+        'kwarg1, kwarg2=%s) -> None' % (color, color),
+        '      :module: target.preserve_defaults',
+        '      :classmethod:',
+        '',
+        '      docstring',
+        '',
+        '',
         '   .. py:method:: Class.meth(name: str = CONSTANT, sentinel: ~typing.Any = '
         'SENTINEL, now: ~datetime.datetime = datetime.now(), color: int = %s, *, '
         'kwarg1, kwarg2=%s) -> None' % (color, color),