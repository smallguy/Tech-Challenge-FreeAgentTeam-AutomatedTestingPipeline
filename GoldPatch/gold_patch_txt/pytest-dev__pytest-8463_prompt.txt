# 修复代码生成提示词（实例ID：pytest-dev__pytest-8463）
## 代码仓库
pytest-dev/pytest

## 原始问题描述
resolve startpath/fspath parameter regressions
the introductin of various `startpath`/`fspath` hooks in the hookspecs

 as a non-optional and non-inmplied parameter is practically a api breaking change

back in 2018 i decoded to close the upstream issue in https://github.com/pytest-dev/pluggy/issues/15 as its pretty much insanely complex to alter the hooks where callers and callees are not under good control

the pr adding them is #8144

CC @bluetech 

i believe/fear the correct solution would be to deprecate the old hook names, introduce a new hook version and have invoking/implementing the old one trigger a deprecation warning
Wrong color formatting output with FAILED test.
**Context**
I'm using Pytest to test a Flask webapp, when I execute my tests there is one of them that FAILS at the middel of the sequence, so the format of the following text will be red instead of green when they PASS.

**Steps to reproduce**: 
1. Create a set of tests.
2. Place one test that will **fail** in order to be executed at the middle of the test execution.

**Expected behavior**
A clear and concise description of what you expected to happen.
Wheter the test fails the color will be red and if it's a pass, the color will be green.

**Screenshots**
[Here's a screenshot of the issue](https://imgur.com/oqGbbme.png)
[VS Code detailed information](https://imgur.com/FKBo6Yl.png)

**Environment:**
 - OS: Xubuntu 20.10
 - Python Version 3.8.6
 - Pytest version 6.2.2
 - Flask version 1.1.2

**Additional context**
I'm using a Terminal hosted by VS Code (v1.53.2)

PS: I would love to contribute as it's my first ever issue reported but I can't figure out at the source code where is this coded.


## 参考黄金补丁（正确的修复方案）
diff --git a/testing/deprecated_test.py b/testing/deprecated_test.py
--- a/testing/deprecated_test.py
+++ b/testing/deprecated_test.py
@@ -1,10 +1,13 @@
 import re
+import sys
 import warnings
 from unittest import mock
 
 import pytest
 from _pytest import deprecated
+from _pytest.compat import legacy_path
 from _pytest.pytester import Pytester
+from pytest import PytestDeprecationWarning
 
 
 @pytest.mark.parametrize("attribute", pytest.collect.__all__)  # type: ignore
@@ -153,3 +156,25 @@ def test_raising_unittest_skiptest_during_collection_is_deprecated(
             "*PytestDeprecationWarning: Raising unittest.SkipTest*",
         ]
     )
+
+
+@pytest.mark.parametrize("hooktype", ["hook", "ihook"])
+def test_hookproxy_warnings_for_fspath(tmp_path, hooktype, request):
+    path = legacy_path(tmp_path)
+
+    PATH_WARN_MATCH = r".*path: py\.path\.local\) argument is deprecated, please use \(fspath: pathlib\.Path.*"
+    if hooktype == "ihook":
+        hooks = request.node.ihook
+    else:
+        hooks = request.config.hook
+
+    with pytest.warns(PytestDeprecationWarning, match=PATH_WARN_MATCH) as r:
+        l1 = sys._getframe().f_lineno
+        hooks.pytest_ignore_collect(config=request.config, path=path, fspath=tmp_path)
+        l2 = sys._getframe().f_lineno
+
+    (record,) = r
+    assert record.filename == __file__
+    assert l1 < record.lineno < l2
+
+    hooks.pytest_ignore_collect(config=request.config, fspath=tmp_path)