# 修复代码生成提示词（实例ID：pydata__xarray-6882）
## 代码仓库
pydata/xarray

## 原始问题描述
Cannot open NetCDF file if dimension with time coordinate has length 0 (`ValueError` when decoding CF datetime)
If a data set has a zero-sized coordinate that is a time index, reading fails.  A `ValueError` is triggered when xarray tries to decode the array, as shown below:

```
$ cat mwe.py
#!/usr/bin/env python

import numpy
import xarray

ds = xarray.Dataset(
    {"a": ("x", [])},
    coords={"x": numpy.zeros(shape=0, dtype="M8[ns]")})

ds.to_netcdf("/tmp/test.nc")

xarray.open_dataset("/tmp/test.nc")
$ ./mwe.py
Traceback (most recent call last):
  File "./mwe.py", line 12, in <module>
    xarray.open_dataset("/tmp/test.nc")
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/backends/api.py", line 302, in open_dataset
    return maybe_decode_store(store, lock)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/backends/api.py", line 223, in maybe_decode_store
    drop_variables=drop_variables)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/conventions.py", line 952, in decode_cf
    ds = Dataset(vars, attrs=attrs)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/dataset.py", line 358, in __init__
    self._set_init_vars_and_dims(data_vars, coords, compat)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/dataset.py", line 373, in _set_init_vars_and_dims
    data_vars, coords, compat=compat)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/merge.py", line 365, in merge_data_and_coords
    return merge_core(objs, compat, join, explicit_coords=explicit_coords)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/merge.py", line 413, in merge_core
    expanded = expand_variable_dicts(aligned)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/merge.py", line 213, in expand_variable_dicts
    var = as_variable(var, name=name)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/variable.py", line 83, in as_variable
    obj = obj.to_index_variable()
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/variable.py", line 322, in to_index_variable
    encoding=self._encoding, fastpath=True)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/variable.py", line 1173, in __init__
    self._data = PandasIndexAdapter(self._data)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/indexing.py", line 497, in __init__
    self.array = utils.safe_cast_to_index(array)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/utils.py", line 57, in safe_cast_to_index
    index = pd.Index(np.asarray(array), **kwargs)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/numpy/core/numeric.py", line 531, in asarray
    return array(a, dtype, copy=False, order=order)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/core/indexing.py", line 373, in __array__
    return np.asarray(array[self.key], dtype=None)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/conventions.py", line 408, in __getitem__
    calendar=self.calendar)
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/xarray/conventions.py", line 151, in decode_cf_datetime
    pd.to_timedelta(flat_num_dates.min(), delta) + ref_date
  File "/dev/shm/gerrit/venv/stable-3.5/lib/python3.5/site-packages/numpy/core/_methods.py", line 29, in _amin
    return umr_minimum(a, axis, None, out, keepdims)
ValueError: zero-size array to reduction operation minimum which has no identity
$ ncdump /tmp/test.nc 
netcdf test {
dimensions:
        x = UNLIMITED ; // (0 currently)
variables:
        double a(x) ;
                a:_FillValue = NaN ;
        int64 x(x) ;
                x:units = "days since 1970-01-01 00:00:00" ;
                x:calendar = "proleptic_gregorian" ;

// global attributes:
                :_NCProperties = "version=1|netcdflibversion=4.4.1|hdf5libversion=1.8.18" ;
data:
}
```



## 参考黄金补丁（正确的修复方案）
diff --git a/xarray/tests/test_coding_times.py b/xarray/tests/test_coding_times.py
--- a/xarray/tests/test_coding_times.py
+++ b/xarray/tests/test_coding_times.py
@@ -1150,3 +1150,20 @@ def test_decode_cf_datetime_uint64_with_cftime_overflow_error():
     num_dates = np.uint64(1_000_000 * 86_400 * 360 * 500_000)
     with pytest.raises(OverflowError):
         decode_cf_datetime(num_dates, units, calendar)
+
+
+@pytest.mark.parametrize("use_cftime", [True, False])
+def test_decode_0size_datetime(use_cftime):
+    # GH1329
+    if use_cftime and not has_cftime:
+        pytest.skip()
+
+    dtype = object if use_cftime else "M8[ns]"
+    expected = np.array([], dtype=dtype)
+    actual = decode_cf_datetime(
+        np.zeros(shape=0, dtype=np.int64),
+        units="days since 1970-01-01 00:00:00",
+        calendar="proleptic_gregorian",
+        use_cftime=use_cftime,
+    )
+    np.testing.assert_equal(expected, actual)