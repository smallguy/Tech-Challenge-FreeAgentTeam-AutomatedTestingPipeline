# 修复代码生成提示词（实例ID：django__django-15018）
## 代码仓库
django/django

## 原始问题描述
call_command() fails when required mutually exclusive arguments use the same `dest`.
Description
	
I have a command which accepts two different ways to specify a time -- either as a timestamp or as a duration in the future:
pause (--for duration | --until time)
class Command(BaseCommand):
	def add_arguments(self, parser) -> None:
		group = parser.add_mutually_exclusive_group(required=True)
		group.add_argument('--for', dest='until', action='store', type=parse_duration_to_time)
		group.add_argument('--until', action='store', type=parse_time)
	def handle(self, until: datetime, **_):
		pass
This works fine on the command line, however there doesn't seem to be a way to make this work through call_command. Specifically there are two sides to the failure:
while I can provide an until value (as a string, which is processed by parse_time) there is no mechanism to pass a for value if that's how I want to spell the input
the for value is always required and attempts to parse the (string) until value passed, which then errors since the input formats are very different


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/user_commands/management/commands/mutually_exclusive_required_with_same_dest.py b/tests/user_commands/management/commands/mutually_exclusive_required_with_same_dest.py
new file mode 100644
--- /dev/null
+++ b/tests/user_commands/management/commands/mutually_exclusive_required_with_same_dest.py
@@ -0,0 +1,13 @@
+from django.core.management.base import BaseCommand
+
+
+class Command(BaseCommand):
+    def add_arguments(self, parser):
+        group = parser.add_mutually_exclusive_group(required=True)
+        group.add_argument('--for', dest='until', action='store')
+        group.add_argument('--until', action='store')
+
+    def handle(self, *args, **options):
+        for option, value in options.items():
+            if value is not None:
+                self.stdout.write('%s=%s' % (option, value))
diff --git a/tests/user_commands/tests.py b/tests/user_commands/tests.py
--- a/tests/user_commands/tests.py
+++ b/tests/user_commands/tests.py
@@ -274,6 +274,41 @@ def test_mutually_exclusive_group_required_const_options(self):
                 )
                 self.assertIn(expected_output, out.getvalue())
 
+    def test_mutually_exclusive_group_required_with_same_dest_options(self):
+        tests = [
+            {'until': '2'},
+            {'for': '1', 'until': '2'},
+        ]
+        msg = (
+            "Cannot pass the dest 'until' that matches multiple arguments via "
+            "**options."
+        )
+        for options in tests:
+            with self.subTest(options=options):
+                with self.assertRaisesMessage(TypeError, msg):
+                    management.call_command(
+                        'mutually_exclusive_required_with_same_dest',
+                        **options,
+                    )
+
+    def test_mutually_exclusive_group_required_with_same_dest_args(self):
+        tests = [
+            ('--until=1',),
+            ('--until', 1),
+            ('--for=1',),
+            ('--for', 1),
+        ]
+        for args in tests:
+            out = StringIO()
+            with self.subTest(options=args):
+                management.call_command(
+                    'mutually_exclusive_required_with_same_dest',
+                    *args,
+                    stdout=out,
+                )
+                output = out.getvalue()
+                self.assertIn('until=1', output)
+
     def test_required_list_option(self):
         tests = [
             (('--foo-list', [1, 2]), {}),