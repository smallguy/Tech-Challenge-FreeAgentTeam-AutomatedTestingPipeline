# 修复代码生成提示词（实例ID：django__django-12394）
## 代码仓库
django/django

## 原始问题描述
Raising error about protected related objects can crash.
Description
	 
		(last modified by Matthias Kestenholz)
	 
======================================================================
ERROR: test_protect_via (delete.tests.OnDeleteTests)
----------------------------------------------------------------------
Traceback (most recent call last):
 File "/usr/lib/python3.6/unittest/case.py", line 59, in testPartExecutor
	yield
 File "/usr/lib/python3.6/unittest/case.py", line 605, in run
	testMethod()
 File "/home/matthias/Projects/django/tests/delete/tests.py", line 99, in test_protect_via
	p.delete()
 File "/home/matthias/Projects/django/django/db/models/base.py", line 941, in delete
	collector.collect([self], keep_parents=keep_parents)
 File "/home/matthias/Projects/django/django/db/models/deletion.py", line 300, in collect
	error.protected_objects[0].__class__.__name__,
TypeError: 'itertools.chain' object is not subscriptable
Pull request follows.
(By the way, this came up while testing ​https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!msg/django-developers/WmgqJnQ6ioE/b52uACoPAgAJ / the JSONField GSoC pull request. Apart from this crash everything worked fine!)


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/delete/tests.py b/tests/delete/tests.py
--- a/tests/delete/tests.py
+++ b/tests/delete/tests.py
@@ -90,6 +90,17 @@ def test_protect_multiple(self):
         with self.assertRaisesMessage(ProtectedError, msg):
             a.protect.delete()
 
+    def test_protect_path(self):
+        a = create_a('protect')
+        a.protect.p = P.objects.create()
+        a.protect.save()
+        msg = (
+            "Cannot delete some instances of model 'P' because they are "
+            "referenced through protected foreign keys: 'R.p'."
+        )
+        with self.assertRaisesMessage(ProtectedError, msg):
+            a.protect.p.delete()
+
     def test_do_nothing(self):
         # Testing DO_NOTHING is a bit harder: It would raise IntegrityError for a normal model,
         # so we connect to pre_delete and set the fk to a known value.