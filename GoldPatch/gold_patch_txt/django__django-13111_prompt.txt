# 修复代码生成提示词（实例ID：django__django-13111）
## 代码仓库
django/django

## 原始问题描述
Support "%V" format in WeekArchiveView.
Description
	
#26217 (Docs for WeekArchiveView are misleading about %W) - closed 4 years ago mentioned support for %V week format.
Since python 3.6, %G, %u and %V ISO 8601 formatters were added to strptime.
WeekArchiveView should add %V to the list of accepted week formatters. This would require as well the special case to change the year format to %G, or simply ValueError in _date_from_string should mention the message passed from datetime.datetime.strptime:
ISO week directive '%V' is incompatible with the year directive '%Y'. Use the ISO year '%G'.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/generic_views/test_dates.py b/tests/generic_views/test_dates.py
--- a/tests/generic_views/test_dates.py
+++ b/tests/generic_views/test_dates.py
@@ -538,10 +538,29 @@ def test_week_start_Monday(self):
         self.assertEqual(res.status_code, 200)
         self.assertEqual(res.context['week'], datetime.date(2008, 9, 29))
 
+    def test_week_iso_format(self):
+        res = self.client.get('/dates/books/2008/week/40/iso_format/')
+        self.assertEqual(res.status_code, 200)
+        self.assertTemplateUsed(res, 'generic_views/book_archive_week.html')
+        self.assertEqual(
+            list(res.context['book_list']),
+            [Book.objects.get(pubdate=datetime.date(2008, 10, 1))],
+        )
+        self.assertEqual(res.context['week'], datetime.date(2008, 9, 29))
+
     def test_unknown_week_format(self):
-        with self.assertRaisesMessage(ValueError, "Unknown week format '%T'. Choices are: %U, %W"):
+        msg = "Unknown week format '%T'. Choices are: %U, %V, %W"
+        with self.assertRaisesMessage(ValueError, msg):
             self.client.get('/dates/books/2008/week/39/unknown_week_format/')
 
+    def test_incompatible_iso_week_format_view(self):
+        msg = (
+            "ISO week directive '%V' is incompatible with the year directive "
+            "'%Y'. Use the ISO year '%G' instead."
+        )
+        with self.assertRaisesMessage(ValueError, msg):
+            self.client.get('/dates/books/2008/week/40/invalid_iso_week_year_format/')
+
     def test_datetime_week_view(self):
         BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))
         res = self.client.get('/dates/booksignings/2008/week/13/')
diff --git a/tests/generic_views/urls.py b/tests/generic_views/urls.py
--- a/tests/generic_views/urls.py
+++ b/tests/generic_views/urls.py
@@ -190,6 +190,14 @@
         'dates/books/<int:year>/week/<int:week>/unknown_week_format/',
         views.BookWeekArchive.as_view(week_format='%T'),
     ),
+    path(
+        'dates/books/<int:year>/week/<int:week>/iso_format/',
+        views.BookWeekArchive.as_view(year_format='%G', week_format='%V'),
+    ),
+    path(
+        'dates/books/<int:year>/week/<int:week>/invalid_iso_week_year_format/',
+        views.BookWeekArchive.as_view(week_format='%V'),
+    ),
     path('dates/booksignings/<int:year>/week/<int:week>/', views.BookSigningWeekArchive.as_view()),
 
     # DayArchiveView