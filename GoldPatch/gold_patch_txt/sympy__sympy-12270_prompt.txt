# 修复代码生成提示词（实例ID：sympy__sympy-12270）
## 代码仓库
sympy/sympy

## 原始问题描述
cannot extract_multiplicatively(-2) from (-2*x - 2*y)
I think this might be a bug.
````
>>> (2+4*I).extract_multiplicatively(2)    # yes
1 + 2*I
>>> (-2-4*I).extract_multiplicatively(-1)   # yes
2 + 4*I
>>> (-2-4*I).extract_multiplicatively(-2)   # bug?
````
similarly:
````
>>> (2*x + 4*y + 8).extract_multiplicatively(2)   # yes
x + 2*y + 4
>>> (-2*x - 4*y - 8).extract_multiplicatively(2)    # yes
-x - 2*y - 4
>>> (-2*x - 4*y - 8).extract_multiplicatively(-1)    # yes
2*x + 4*y + 8
>>> (-2*x - 4*y - 8).extract_multiplicatively(-2)    # bug?
````

Assuming it is indeed a bug, here is why it happens:

Look in `core/expr.py` where:
````
>>> (-2*x - 4*y - 8).primitive()
(2, -x - 2*y - 4)
````
which is then made into a *non-evaluated* `Mul`, from which `-2` cannot be multiplicatively extracted; for example:
````
>>> Mul(2, -x).extract_multiplicatively(-2)
x
>>> Mul(2, -x, evaluate=False).extract_multiplicatively(-2)
````
@smichr do you think this is bug? (see your commit 8968b85310506c0a2b34f3d7aeb8e0d88f87885b: not clear whether we still need this special case anyway)


## 参考黄金补丁（正确的修复方案）
diff --git a/sympy/core/tests/test_expr.py b/sympy/core/tests/test_expr.py
--- a/sympy/core/tests/test_expr.py
+++ b/sympy/core/tests/test_expr.py
@@ -1012,6 +1012,12 @@ def test_extractions():
     assert (sqrt(x)).extract_multiplicatively(x) is None
     assert (sqrt(x)).extract_multiplicatively(1/x) is None
     assert x.extract_multiplicatively(-x) is None
+    assert (-2 - 4*I).extract_multiplicatively(-2) == 1 + 2*I
+    assert (-2 - 4*I).extract_multiplicatively(3) is None
+    assert (-2*x - 4*y - 8).extract_multiplicatively(-2) == x + 2*y + 4
+    assert (-2*x*y - 4*x**2*y).extract_multiplicatively(-2*y) == 2*x**2 + x
+    assert (2*x*y + 4*x**2*y).extract_multiplicatively(2*y) == 2*x**2 + x
+    assert (-4*y**2*x).extract_multiplicatively(-3*y) is None
 
     assert ((x*y)**3).extract_additively(1) is None
     assert (x + 1).extract_additively(x) == 1