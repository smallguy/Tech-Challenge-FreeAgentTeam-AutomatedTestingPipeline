# 修复代码生成提示词（实例ID：sphinx-doc__sphinx-9798）
## 代码仓库
sphinx-doc/sphinx

## 原始问题描述
Nitpick flags Literal annotation values as missing py:class (with type hints in description)
### Describe the bug

This is basically the same issue as #9576, which was fixed in #9602.  However, I still get this issue when using `autodoc_typehints = 'description'`.

### How to Reproduce

```
$ unzip attachment.zip
$ python3.9 -m venv .venv
$ . .venv/bin/activate
$ pip install sphinx
$ sphinx-build -b html -n -W docs docs/_build
Running Sphinx v4.2.0
making output directory... done
[autosummary] generating autosummary for: index.rst, rst/api.rst
[autosummary] generating autosummary for: <snip>/docs/rst/generated/dummy.foo.bar.rst
building [mo]: targets for 0 po files that are out of date
building [html]: targets for 2 source files that are out of date
updating environment: [new config] 3 added, 0 changed, 0 removed
reading sources... [100%] rst/generated/dummy.foo.bar                                                                                                                                                                                                     
looking for now-outdated files... none found
pickling environment... done
checking consistency... done
preparing documents... done
writing output... [100%] rst/generated/dummy.foo.bar                                                                                                                                                                                                      

Warning, treated as error:
<snip>/src/dummy/foo.py:docstring of dummy.foo.bar::py:class reference target not found: ''
```

Comment out the line `autodoc_typehints = 'description'` in docs/conf.py and it is successful, as shown below (and removing the build artifacts to start fresh).

```
$ sphinx-build -b html -n -W docs docs/_build
Running Sphinx v4.2.0
making output directory... done
[autosummary] generating autosummary for: index.rst, rst/api.rst
[autosummary] generating autosummary for: <snip>/docs/rst/generated/dummy.foo.bar.rst
building [mo]: targets for 0 po files that are out of date
building [html]: targets for 2 source files that are out of date
updating environment: [new config] 3 added, 0 changed, 0 removed
reading sources... [100%] rst/generated/dummy.foo.bar                                                                                                                                                                                                     
looking for now-outdated files... none found
pickling environment... done
checking consistency... done
preparing documents... done
writing output... [100%] rst/generated/dummy.foo.bar                                                                                                                                                                                                      
generating indices... genindex py-modindex done
writing additional pages... search done
copying static files... done
copying extra files... done
dumping search index in English (code: en)... done
dumping object inventory... done
build succeeded.

The HTML pages are in docs/_build.
```

[attachment.zip](https://github.com/sphinx-doc/sphinx/files/7416418/attachment.zip)


### Expected behavior

No error, the build should succeed.

### Your project

See attachment in "How to Reproduce" section

### Screenshots

N/A - output is shown in "How to Reproduce" section

### OS

Linux and Windows

### Python version

3.9

### Sphinx version

4.2.0

### Sphinx extensions

sphinx.ext.autodoc, sphinx.ext.autosummary

### Extra tools

N/A

### Additional context

This re-produces for me on both Linux and Windows.  I think the source of it issue is probably from [this line](https://github.com/sphinx-doc/sphinx/blob/2be9d6b092965a2f9354da66b645bf5ea76ce288/sphinx/ext/autodoc/typehints.py#L43) in `merge_typehints` since this function would otherwise be skipped if the type hints are left in the signature.  But I haven't yet been able to track it all the way down to the error.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_domain_py.py b/tests/test_domain_py.py
--- a/tests/test_domain_py.py
+++ b/tests/test_domain_py.py
@@ -1110,6 +1110,42 @@ def test_info_field_list_piped_type(app):
                 **{"py:module": "example", "py:class": "Class"})
 
 
+def test_info_field_list_Literal(app):
+    text = (".. py:module:: example\n"
+            ".. py:class:: Class\n"
+            "\n"
+            "   :param age: blah blah\n"
+            "   :type age: Literal['foo', 'bar', 'baz']\n")
+    doctree = restructuredtext.parse(app, text)
+
+    assert_node(doctree,
+                (nodes.target,
+                 addnodes.index,
+                 addnodes.index,
+                 [desc, ([desc_signature, ([desc_annotation, ("class", desc_sig_space)],
+                                           [desc_addname, "example."],
+                                           [desc_name, "Class"])],
+                         [desc_content, nodes.field_list, nodes.field, (nodes.field_name,
+                                                                        nodes.field_body)])]))
+    assert_node(doctree[3][1][0][0][1],
+                ([nodes.paragraph, ([addnodes.literal_strong, "age"],
+                                    " (",
+                                    [pending_xref, addnodes.literal_emphasis, "Literal"],
+                                    [addnodes.literal_emphasis, "["],
+                                    [addnodes.literal_emphasis, "'foo'"],
+                                    [addnodes.literal_emphasis, ", "],
+                                    [addnodes.literal_emphasis, "'bar'"],
+                                    [addnodes.literal_emphasis, ", "],
+                                    [addnodes.literal_emphasis, "'baz'"],
+                                    [addnodes.literal_emphasis, "]"],
+                                    ")",
+                                    " -- ",
+                                    "blah blah")],))
+    assert_node(doctree[3][1][0][0][1][0][2], pending_xref,
+                refdomain="py", reftype="class", reftarget="Literal",
+                **{"py:module": "example", "py:class": "Class"})
+
+
 def test_info_field_list_var(app):
     text = (".. py:class:: Class\n"
             "\n"