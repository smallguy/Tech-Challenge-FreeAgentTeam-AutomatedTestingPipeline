# 修复代码生成提示词（实例ID：sympy__sympy-21370）
## 代码仓库
sympy/sympy

## 原始问题描述
minpoly fails for complicated algebraic number
Given
```python
res = Add(Mul(Integer(-1), Integer(180561807339168676696180573852937120123827201075968945871075967679148461189459480842956689723484024031016208588658753107), Pow(Add(Mul(Integer(-1), Integer(59358007109636562851035004992802812513575019937126272896569856090962677491318275291141463850327474176000000), Pow(Integer(238368341569), Rational(1, 2)), Pow(Add(Rational(11918417078450, 63568729), Mul(Integer(-1), Rational(24411360, 63568729), Pow(Integer(238368341569), Rational(1, 2)))), Rational(1, 2))), Mul(Integer(28980348180319251787320809875930301310576055074938369007463004788921613896002936637780993064387310446267596800000), Pow(Add(Rational(11918417078450, 63568729), Mul(Integer(-1), Rational(24411360, 63568729), Pow(Integer(238368341569), Rational(1, 2)))), Rational(1, 2)))), Integer(-1))), Mul(Rational(4147945765885450789314388167435907949934483691690666864020285258508371044738450436444552927847213645745267670947, 113381606935163686700437734397823369297496007026370882733475391347475983700388396552567644615375415301921585126967898490840378862984673089105656831541248000000), Pow(Integer(238368341569), Rational(1, 2)), Pow(Add(Rational(11918417078450, 63568729), Mul(Integer(-1), Rational(24411360, 63568729), Pow(Integer(238368341569), Rational(1, 2)))), Rational(-1, 2)), Add(Mul(Rational(91717984946399096916006871140088538821154865311861505541341432860053575049000000, 65987423134383642610502609363902432363342791121), Pow(Add(Float('187488.67982636558', precision=53), Mul(Integer(-1), Rational(24411360, 63568729), Pow(Integer(238368341569), Rational(1, 2)))), Rational(1, 2))), Integer(65987423134383642610502609363902432363342791121))))
```
I get:
```
In [14]: minpoly(res)                                                                                                                          
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-14-a3b1550cf0cb> in <module>
----> 1 minpoly(res)

~/current/sympy/sympy/sympy/polys/numberfields.py in minimal_polynomial(ex, x, compose, polys, domain)
    670 
    671     if compose:
--> 672         result = _minpoly_compose(ex, x, domain)
    673         result = result.primitive()[1]
    674         c = result.coeff(x**degree(result, x))

~/current/sympy/sympy/sympy/polys/numberfields.py in _minpoly_compose(ex, x, dom)
    549 
    550     if ex.is_Add:
--> 551         res = _minpoly_add(x, dom, *ex.args)
    552     elif ex.is_Mul:
    553         f = Factors(ex).factors

~/current/sympy/sympy/sympy/polys/numberfields.py in _minpoly_add(x, dom, *a)
    361     returns ``minpoly(Add(*a), dom, x)``
    362     """
--> 363     mp = _minpoly_op_algebraic_element(Add, a[0], a[1], x, dom)
    364     p = a[0] + a[1]
    365     for px in a[2:]:

~/current/sympy/sympy/sympy/polys/numberfields.py in _minpoly_op_algebraic_element(op, ex1, ex2, x, dom, mp1, mp2)
    278     r = Poly(r, x, domain=dom)
    279     _, factors = r.factor_list()
--> 280     res = _choose_factor(factors, x, op(ex1, ex2), dom)
    281     return res.as_expr()
    282 

~/current/sympy/sympy/sympy/polys/numberfields.py in _choose_factor(factors, x, v, dom, prec, bound)
     79             prec1 *= 2
     80 
---> 81     raise NotImplementedError("multiple candidates for the minimal polynomial of %s" % v)
     82 
     83 

NotImplementedError: multiple candidates for the minimal polynomial of -180561807339168676696180573852937120123827201075968945871075967679148461189459480842956689723484024031016208588658753107/(-59358007109636562851035004992802812513575019937126272896569856090962677491318275291141463850327474176000000*sqrt(238368341569)*sqrt(11918417078450/63568729 - 24411360*sqrt(238368341569)/63568729) + 28980348180319251787320809875930301310576055074938369007463004788921613896002936637780993064387310446267596800000*sqrt(11918417078450/63568729 - 24411360*sqrt(238368341569)/63568729)) + 4147945765885450789314388167435907949934483691690666864020285258508371044738450436444552927847213645745267670947*sqrt(238368341569)/(1718230558939414944958212067529897587678479820358393800041489414608007783126133298212707321630403291250688000000*sqrt(11918417078450/63568729 - 24411360*sqrt(238368341569)/63568729))
> /Users/enojb/current/sympy/sympy/sympy/polys/numberfields.py(81)_choose_factor()
     79             prec1 *= 2
     80 
---> 81     raise NotImplementedError("multiple candidates for the minimal polynomial of %s" % v)
     82 
     83 
```


## 参考黄金补丁（正确的修复方案）
diff --git a/sympy/core/tests/test_exprtools.py b/sympy/core/tests/test_exprtools.py
--- a/sympy/core/tests/test_exprtools.py
+++ b/sympy/core/tests/test_exprtools.py
@@ -56,6 +56,8 @@ def test_Factors():
     assert Factors(-I)*I == Factors()
     assert Factors({S.NegativeOne: S(3)})*Factors({S.NegativeOne: S.One, I: S(5)}) == \
         Factors(I)
+    assert Factors(sqrt(I)*I) == Factors(I**(S(3)/2)) == Factors({I: S(3)/2})
+    assert Factors({I: S(3)/2}).as_expr() == I**(S(3)/2)
 
     assert Factors(S(2)**x).div(S(3)**x) == \
         (Factors({S(2): x}), Factors({S(3): x}))
diff --git a/sympy/polys/tests/test_numberfields.py b/sympy/polys/tests/test_numberfields.py
--- a/sympy/polys/tests/test_numberfields.py
+++ b/sympy/polys/tests/test_numberfields.py
@@ -16,6 +16,7 @@
     to_number_field,
     AlgebraicNumber,
     isolate, IntervalPrinter,
+    _choose_factor,
 )
 
 from sympy.polys.partfrac import apart
@@ -115,6 +116,13 @@ def test_minimal_polynomial():
         sqrt(15)*I/28800000)**(1/3)))''')
     assert minimal_polynomial(eq, x) == 8000*x**2 - 1
 
+    ex = (sqrt(5)*sqrt(I)/(5*sqrt(1 + 125*I))
+            + 25*sqrt(5)/(I**Q(5,2)*(1 + 125*I)**Q(3,2))
+            + 3125*sqrt(5)/(I**Q(11,2)*(1 + 125*I)**Q(3,2))
+            + 5*I*sqrt(1 - I/125))
+    mp = minimal_polynomial(ex, x)
+    assert mp == 25*x**4 + 5000*x**2 + 250016
+
     ex = 1 + sqrt(2) + sqrt(3)
     mp = minimal_polynomial(ex, x)
     assert mp == x**4 - 4*x**3 - 4*x**2 + 16*x - 8
@@ -167,6 +175,22 @@ def test_minimal_polynomial():
     minimal_polynomial(phi, x) == x**2 - x - 1
 
 
+def test_minimal_polynomial_issue_19732():
+    # https://github.com/sympy/sympy/issues/19732
+    expr = (-280898097948878450887044002323982963174671632174995451265117559518123750720061943079105185551006003416773064305074191140286225850817291393988597615/(-488144716373031204149459129212782509078221364279079444636386844223983756114492222145074506571622290776245390771587888364089507840000000*sqrt(238368341569)*sqrt(S(11918417078450)/63568729
+    - 24411360*sqrt(238368341569)/63568729) +
+    238326799225996604451373809274348704114327860564921529846705817404208077866956345381951726531296652901169111729944612727047670549086208000000*sqrt(S(11918417078450)/63568729
+        - 24411360*sqrt(238368341569)/63568729)) -
+    180561807339168676696180573852937120123827201075968945871075967679148461189459480842956689723484024031016208588658753107/(-59358007109636562851035004992802812513575019937126272896569856090962677491318275291141463850327474176000000*sqrt(238368341569)*sqrt(S(11918417078450)/63568729
+        - 24411360*sqrt(238368341569)/63568729) +
+        28980348180319251787320809875930301310576055074938369007463004788921613896002936637780993064387310446267596800000*sqrt(S(11918417078450)/63568729
+            - 24411360*sqrt(238368341569)/63568729)))
+    poly = (2151288870990266634727173620565483054187142169311153766675688628985237817262915166497766867289157986631135400926544697981091151416655364879773546003475813114962656742744975460025956167152918469472166170500512008351638710934022160294849059721218824490226159355197136265032810944357335461128949781377875451881300105989490353140886315677977149440000000000000000000000*x**4
+            - 5773274155644072033773937864114266313663195672820501581692669271302387257492905909558846459600429795784309388968498783843631580008547382703258503404023153694528041873101120067477617592651525155101107144042679962433039557235772239171616433004024998230222455940044709064078962397144550855715640331680262171410099614469231080995436488414164502751395405398078353242072696360734131090111239998110773292915337556205692674790561090109440000000000000*x**2
+            + 211295968822207088328287206509522887719741955693091053353263782924470627623790749534705683380138972642560898936171035770539616881000369889020398551821767092685775598633794696371561234818461806577723412581353857653829324364446419444210520602157621008010129702779407422072249192199762604318993590841636967747488049176548615614290254356975376588506729604345612047361483789518445332415765213187893207704958013682516462853001964919444736320672860140355089)
+    assert minimal_polynomial(expr, x) == poly
+
+
 def test_minimal_polynomial_hi_prec():
     p = 1/sqrt(1 - 9*sqrt(2) + 7*sqrt(3) + Rational(1, 10)**30)
     mp = minimal_polynomial(p, x)
@@ -278,6 +302,12 @@ def test_minpoly_issue_7574():
     assert minimal_polynomial(ex, x) == x + 1
 
 
+def test_choose_factor():
+    # Test that this does not enter an infinite loop:
+    bad_factors = [Poly(x-2, x), Poly(x+2, x)]
+    raises(NotImplementedError, lambda: _choose_factor(bad_factors, x, sqrt(3)))
+
+
 def test_primitive_element():
     assert primitive_element([sqrt(2)], x) == (x**2 - 2, [1])
     assert primitive_element(