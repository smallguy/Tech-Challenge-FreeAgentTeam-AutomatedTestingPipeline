# 修复代码生成提示词（实例ID：django__django-15744）
## 代码仓库
django/django

## 原始问题描述
Request body is closed prematurely by the ASGI handler
Description
	
The following PR ​https://github.com/django/django/pull/15675/ introduces I/O operation on closed file., due to closing the ASGI request body before getting the response, e.g. accessing request.body in a view.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/asgi/tests.py b/tests/asgi/tests.py
--- a/tests/asgi/tests.py
+++ b/tests/asgi/tests.py
@@ -163,6 +163,18 @@ async def test_headers(self):
         self.assertEqual(response_body["type"], "http.response.body")
         self.assertEqual(response_body["body"], b"From Scotland,Wales")
 
+    async def test_post_body(self):
+        application = get_asgi_application()
+        scope = self.async_request_factory._base_scope(method="POST", path="/post/")
+        communicator = ApplicationCommunicator(application, scope)
+        await communicator.send_input({"type": "http.request", "body": b"Echo!"})
+        response_start = await communicator.receive_output()
+        self.assertEqual(response_start["type"], "http.response.start")
+        self.assertEqual(response_start["status"], 200)
+        response_body = await communicator.receive_output()
+        self.assertEqual(response_body["type"], "http.response.body")
+        self.assertEqual(response_body["body"], b"Echo!")
+
     async def test_get_query_string(self):
         application = get_asgi_application()
         for query_string in (b"name=Andrew", "name=Andrew"):
diff --git a/tests/asgi/urls.py b/tests/asgi/urls.py
--- a/tests/asgi/urls.py
+++ b/tests/asgi/urls.py
@@ -2,6 +2,7 @@
 
 from django.http import FileResponse, HttpResponse
 from django.urls import path
+from django.views.decorators.csrf import csrf_exempt
 
 
 def hello(request):
@@ -23,6 +24,11 @@ def sync_waiter(request):
     return hello(request)
 
 
+@csrf_exempt
+def post_echo(request):
+    return HttpResponse(request.body)
+
+
 sync_waiter.active_threads = set()
 sync_waiter.lock = threading.Lock()
 sync_waiter.barrier = threading.Barrier(2)
@@ -35,5 +41,6 @@ def sync_waiter(request):
     path("", hello),
     path("file/", lambda x: FileResponse(open(test_filename, "rb"))),
     path("meta/", hello_meta),
+    path("post/", post_echo),
     path("wait/", sync_waiter),
 ]