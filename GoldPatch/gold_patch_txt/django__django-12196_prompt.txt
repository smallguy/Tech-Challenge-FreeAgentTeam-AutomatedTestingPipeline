# 修复代码生成提示词（实例ID：django__django-12196）
## 代码仓库
django/django

## 原始问题描述
Add a safeguard to debug decorators (sensitive_variables/sensitive_post_parameters) to prevent incorrect usage.
Description
	
While trying to reproduce ticket:26480#comment:5, I noticed that Django happily lets you write this kind of code:
@sensitive_variables # incorrect usage, should be @sensitive_variables()
def is_password_ok(password):
	return len(password) > 8
It's very easy to miss that you forgot the (). Most of the time it's not really dangerous because the decorated function will be unusable but in this case, the consequences are pretty nasty:
>>> bool(is_password_ok('asdf'))
True # you would expect False because len('asdf') < 8
I propose adding some code to both sensitive_variables() and sensitive_post_parameters() that catches this misuse to prevent users from decorating their functions incorrectly.
Because both decorators take either no arguments or only string arguments, it's not too hard to detect the error with something like this:
def sensitive_variables(*variables):
	if len(variables) == 1 and callable(variables[0]):
		raise TypeError(...)
	# ...
This should be fully backwards compatible and in most cases it will raise the error at import time which should make things easier to fix for those who've incorrectly used the decorator.
(I've confirmed with the security team that this does not need to be treated as a security issue)


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/view_tests/tests/test_debug.py b/tests/view_tests/tests/test_debug.py
--- a/tests/view_tests/tests/test_debug.py
+++ b/tests/view_tests/tests/test_debug.py
@@ -26,6 +26,9 @@
     Path as DebugPath, cleanse_setting, default_urlconf,
     technical_404_response, technical_500_response,
 )
+from django.views.decorators.debug import (
+    sensitive_post_parameters, sensitive_variables,
+)
 
 from ..views import (
     custom_exception_reporter_filter_view, index_page,
@@ -1272,3 +1275,26 @@ def test_cleanse_setting_recurses_in_dictionary(self):
         initial = {'login': 'cooper', 'password': 'secret'}
         expected = {'login': 'cooper', 'password': CLEANSED_SUBSTITUTE}
         self.assertEqual(cleanse_setting('SETTING_NAME', initial), expected)
+
+
+class DecoratorsTests(SimpleTestCase):
+    def test_sensitive_variables_not_called(self):
+        msg = (
+            'sensitive_variables() must be called to use it as a decorator, '
+            'e.g., use @sensitive_variables(), not @sensitive_variables.'
+        )
+        with self.assertRaisesMessage(TypeError, msg):
+            @sensitive_variables
+            def test_func(password):
+                pass
+
+    def test_sensitive_post_parameters_not_called(self):
+        msg = (
+            'sensitive_post_parameters() must be called to use it as a '
+            'decorator, e.g., use @sensitive_post_parameters(), not '
+            '@sensitive_post_parameters.'
+        )
+        with self.assertRaisesMessage(TypeError, msg):
+            @sensitive_post_parameters
+            def test_func(request):
+                return index_page(request)