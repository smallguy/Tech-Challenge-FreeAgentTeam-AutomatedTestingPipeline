# 修复代码生成提示词（实例ID：sphinx-doc__sphinx-9467）
## 代码仓库
sphinx-doc/sphinx

## 原始问题描述
github linkcheck anchor change in 4.1.0 break some usage
### Describe the bug

Given a link like:

```rst
.. _`OpenSSL's test vectors`: https://github.com/openssl/openssl/blob/97cf1f6c2854a3a955fd7dd3a1f113deba00c9ef/crypto/evp/evptests.txt#L232 
```

in a github doc, with release 4.1.0 this will fail with linkcheck, while previously it worked.

### How to Reproduce

```
$ git clone https://github.com/pyca/cryptography
$ cd cryptography
$ tox -e docs-linkcheck
```


### Expected behavior

It passes.

### Your project

https://github.com/pyca/cryptography

### Screenshots

_No response_

### OS

Linux

### Python version

3.9.5

### Sphinx version

4.1.0

### Sphinx extensions

_No response_

### Extra tools

_No response_

### Additional context

The relevant change happened in https://github.com/sphinx-doc/sphinx/commit/92335bd6e67dec9d8cadfdfb6d441a440e8dc87e

Failing test logs: https://github.com/pyca/cryptography/runs/3046691393


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/roots/test-linkcheck/links.txt b/tests/roots/test-linkcheck/links.txt
--- a/tests/roots/test-linkcheck/links.txt
+++ b/tests/roots/test-linkcheck/links.txt
@@ -13,8 +13,7 @@ Some additional anchors to exercise ignore code
 * `Complete nonsense <https://localhost:7777/doesnotexist>`_
 * `Example valid local file <conf.py>`_
 * `Example invalid local file <path/to/notfound>`_
-* https://github.com/sphinx-doc/sphinx#documentation
-* https://github.com/sphinx-doc/sphinx#user-content-testing
+* https://github.com/sphinx-doc/sphinx/blob/4.x/sphinx/__init__.py#L2
 
 .. image:: https://www.google.com/image.png
 .. figure:: https://www.google.com/image2.png
diff --git a/tests/test_build_linkcheck.py b/tests/test_build_linkcheck.py
--- a/tests/test_build_linkcheck.py
+++ b/tests/test_build_linkcheck.py
@@ -66,8 +66,8 @@ def test_defaults_json(app):
                  "info"]:
         assert attr in row
 
-    assert len(content.splitlines()) == 12
-    assert len(rows) == 12
+    assert len(content.splitlines()) == 11
+    assert len(rows) == 11
     # the output order of the rows is not stable
     # due to possible variance in network latency
     rowsby = {row["uri"]: row for row in rows}
@@ -88,7 +88,7 @@ def test_defaults_json(app):
     assert dnerow['uri'] == 'https://localhost:7777/doesnotexist'
     assert rowsby['https://www.google.com/image2.png'] == {
         'filename': 'links.txt',
-        'lineno': 20,
+        'lineno': 19,
         'status': 'broken',
         'code': 0,
         'uri': 'https://www.google.com/image2.png',
@@ -102,10 +102,6 @@ def test_defaults_json(app):
     # images should fail
     assert "Not Found for url: https://www.google.com/image.png" in \
         rowsby["https://www.google.com/image.png"]["info"]
-    # The anchor of the URI for github.com is automatically modified
-    assert 'https://github.com/sphinx-doc/sphinx#documentation' not in rowsby
-    assert 'https://github.com/sphinx-doc/sphinx#user-content-documentation' in rowsby
-    assert 'https://github.com/sphinx-doc/sphinx#user-content-testing' in rowsby
 
 
 @pytest.mark.sphinx(