# 修复代码生成提示词（实例ID：mwaskom__seaborn-2576）
## 代码仓库
mwaskom/seaborn

## 原始问题描述
 lmplot(sharey=False) not working
The following code behaves as if `sharey=True`.
(edit: actually, it does not behave the same, but it is still not rescaling the plots individually the way it should)

```
df=pd.DataFrame({'x':[1,2,3,1,2,3], 'y':[4,5,2,400,500,200], 't':[1,1,1,2,2,2]}) 
sns.lmplot(data=df, x='x', y='y', col='t', sharey=False);
```

If you do this, it suddenly works:
```
sns.lmplot(data=df, x='x', y='y', col='t', sharex=False, sharey=False);
```


Versions of seaborn and matplotlib:
```
sns.__version__ 
'0.11.1'

matplotlib.__version__
'3.3.1'
```

![image](https://user-images.githubusercontent.com/35338267/111419598-2525a900-86c0-11eb-9f22-8f0afb2f5007.png)


 lmplot(sharey=False) not working
The following code behaves as if `sharey=True`.
(edit: actually, it does not behave the same, but it is still not rescaling the plots individually the way it should)

```
df=pd.DataFrame({'x':[1,2,3,1,2,3], 'y':[4,5,2,400,500,200], 't':[1,1,1,2,2,2]}) 
sns.lmplot(data=df, x='x', y='y', col='t', sharey=False);
```

If you do this, it suddenly works:
```
sns.lmplot(data=df, x='x', y='y', col='t', sharex=False, sharey=False);
```


Versions of seaborn and matplotlib:
```
sns.__version__ 
'0.11.1'

matplotlib.__version__
'3.3.1'
```

![image](https://user-images.githubusercontent.com/35338267/111419598-2525a900-86c0-11eb-9f22-8f0afb2f5007.png)


Allow xlim as parameter for lmplot
Seaborn versions: latest dev version and 0.11.1

`lmplot` doesn't seem to accept the `xlim=` parameter, although FacetGrid does.

Use case: when `truncate=False`, the regression lines are extrapolated until they touch the current xlims.  If one afterwards want to extend these xlims, the regression lines are floating again.  A workaround is either to call FacetGrid and regplot separately, or to set very wide xmargins via the rcParams.

Example code.
```
import seaborn as sns
import matplotlib as mpl

tips = sns.load_dataset('tips')
# mpl.rcParams['axes.xmargin'] = 0.5  # set very wide margins: 50% of the actual range
g = sns.lmplot(x="total_bill", y="tip", col="smoker", data=tips, truncate=False, xlim=(0, 80))
# mpl.rcParams['axes.xmargin'] = 0.05 # set the margins back to the default
g.set(xlim=(0, 80))
```





## 参考黄金补丁（正确的修复方案）
diff --git a/seaborn/tests/test_regression.py b/seaborn/tests/test_regression.py
--- a/seaborn/tests/test_regression.py
+++ b/seaborn/tests/test_regression.py
@@ -1,3 +1,4 @@
+from distutils.version import LooseVersion
 import numpy as np
 import matplotlib as mpl
 import matplotlib.pyplot as plt
@@ -596,6 +597,44 @@ def test_lmplot_scatter_kws(self):
         npt.assert_array_equal(red, red_scatter.get_facecolors()[0, :3])
         npt.assert_array_equal(blue, blue_scatter.get_facecolors()[0, :3])
 
+    @pytest.mark.skipif(LooseVersion(mpl.__version__) < "3.4",
+                        reason="MPL bug #15967")
+    @pytest.mark.parametrize("sharex", [True, False])
+    def test_lmplot_facet_truncate(self, sharex):
+
+        g = lm.lmplot(
+            data=self.df, x="x", y="y", hue="g", col="h",
+            truncate=False, facet_kws=dict(sharex=sharex),
+        )
+
+        for ax in g.axes.flat:
+            for line in ax.lines:
+                xdata = line.get_xdata()
+                assert ax.get_xlim() == tuple(xdata[[0, -1]])
+
+    def test_lmplot_sharey(self):
+
+        df = pd.DataFrame(dict(
+            x=[0, 1, 2, 0, 1, 2],
+            y=[1, -1, 0, -100, 200, 0],
+            z=["a", "a", "a", "b", "b", "b"],
+        ))
+
+        with pytest.warns(UserWarning):
+            g = lm.lmplot(data=df, x="x", y="y", col="z", sharey=False)
+        ax1, ax2 = g.axes.flat
+        assert ax1.get_ylim()[0] > ax2.get_ylim()[0]
+        assert ax1.get_ylim()[1] < ax2.get_ylim()[1]
+
+    def test_lmplot_facet_kws(self):
+
+        xlim = -4, 20
+        g = lm.lmplot(
+            data=self.df, x="x", y="y", col="h", facet_kws={"xlim": xlim}
+        )
+        for ax in g.axes.flat:
+            assert ax.get_xlim() == xlim
+
     def test_residplot(self):
 
         x, y = self.df.x, self.df.y