# 修复代码生成提示词（实例ID：django__django-12821）
## 代码仓库
django/django

## 原始问题描述
Stop minifying only some admin static assets
Description
	
Here is a list of JavaScript files in the admin app and their size:
 20K django/contrib/admin/static/admin/js/admin/DateTimeShortcuts.js
 15K django/contrib/admin/static/admin/js/inlines.js
 13K django/contrib/admin/static/admin/js/SelectFilter2.js
 8.8K django/contrib/admin/static/admin/js/urlify.js
 7.6K django/contrib/admin/static/admin/js/calendar.js
 6.7K django/contrib/admin/static/admin/js/actions.js
 5.9K django/contrib/admin/static/admin/js/admin/RelatedObjectLookups.js
 5.4K django/contrib/admin/static/admin/js/core.js
 5.3K django/contrib/admin/static/admin/js/SelectBox.js
 5.2K django/contrib/admin/static/admin/js/inlines.min.js
 3.2K django/contrib/admin/static/admin/js/actions.min.js
 1.9K django/contrib/admin/static/admin/js/collapse.js
 1.5K django/contrib/admin/static/admin/js/prepopulate.js
 1.1K django/contrib/admin/static/admin/js/autocomplete.js
 911 django/contrib/admin/static/admin/js/collapse.min.js
 878 django/contrib/admin/static/admin/js/cancel.js
 674 django/contrib/admin/static/admin/js/change_form.js
 569 django/contrib/admin/static/admin/js/popup_response.js
 495 django/contrib/admin/static/admin/js/prepopulate_init.js
 379 django/contrib/admin/static/admin/js/prepopulate.min.js
 363 django/contrib/admin/static/admin/js/jquery.init.js
Some things to notice:
Only 4 out of 17 files are minified.
The largest file, DateTimeShortcuts.js, is only 20 KB.
The largest file is also not included in the list of minified files.
All uncompressed files are smaller than the size of the 3 font assets, each ~80 KB.
All uncompressed files are smaller than the minified jQuery, ~87 KB.
I'm not sure if there is a deliberate or historical reason that only a fraction of the static assets are minified, but it looks like it could be an oversight. The approach is inconsistent.
Minifying is step a contributor must manually do. The documentation for doing so is here:
​https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/javascript/#javascript-patches
This is a step that is easy to forget, myself included. Whether or not one remembers to compress static assets will also affect the outcome of tests.
I suggest we drop the minificaiton of admin files altogether. For such small files, it doesn't seem worth it to add a build step and inconsistently at that.
In a typical production scenarios, the static assets will be cached and possibly compressed. Compressing static assets largely removes the size gains of minification. Additionally, there are third party apps to fill the role of static asset optimization.
I think we should continue to distribute the vendored libraries minified, however as they are not manually handled during typical contributions.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/admin_inlines/tests.py b/tests/admin_inlines/tests.py
--- a/tests/admin_inlines/tests.py
+++ b/tests/admin_inlines/tests.py
@@ -510,7 +510,7 @@ def test_inline_media_only_inline(self):
                 'my_awesome_inline_scripts.js',
                 'custom_number.js',
                 'admin/js/jquery.init.js',
-                'admin/js/inlines.min.js',
+                'admin/js/inlines.js',
             ]
         )
         self.assertContains(response, 'my_awesome_inline_scripts.js')
diff --git a/tests/admin_views/tests.py b/tests/admin_views/tests.py
--- a/tests/admin_views/tests.py
+++ b/tests/admin_views/tests.py
@@ -1229,26 +1229,18 @@ def test_js_minified_only_if_debug_is_false(self):
             response = self.client.get(reverse('admin:admin_views_section_add'))
             self.assertNotContains(response, 'vendor/jquery/jquery.js')
             self.assertContains(response, 'vendor/jquery/jquery.min.js')
-            self.assertNotContains(response, 'prepopulate.js')
-            self.assertContains(response, 'prepopulate.min.js')
-            self.assertNotContains(response, 'actions.js')
-            self.assertContains(response, 'actions.min.js')
-            self.assertNotContains(response, 'collapse.js')
-            self.assertContains(response, 'collapse.min.js')
-            self.assertNotContains(response, 'inlines.js')
-            self.assertContains(response, 'inlines.min.js')
+            self.assertContains(response, 'prepopulate.js')
+            self.assertContains(response, 'actions.js')
+            self.assertContains(response, 'collapse.js')
+            self.assertContains(response, 'inlines.js')
         with override_settings(DEBUG=True):
             response = self.client.get(reverse('admin:admin_views_section_add'))
             self.assertContains(response, 'vendor/jquery/jquery.js')
             self.assertNotContains(response, 'vendor/jquery/jquery.min.js')
             self.assertContains(response, 'prepopulate.js')
-            self.assertNotContains(response, 'prepopulate.min.js')
             self.assertContains(response, 'actions.js')
-            self.assertNotContains(response, 'actions.min.js')
             self.assertContains(response, 'collapse.js')
-            self.assertNotContains(response, 'collapse.min.js')
             self.assertContains(response, 'inlines.js')
-            self.assertNotContains(response, 'inlines.min.js')
 
 
 @override_settings(ROOT_URLCONF='admin_views.urls')