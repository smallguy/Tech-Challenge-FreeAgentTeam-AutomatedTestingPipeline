# 修复代码生成提示词（实例ID：sphinx-doc__sphinx-8729）
## 代码仓库
sphinx-doc/sphinx

## 原始问题描述
sphinx-apidoc on namespaces with only subpackages/namespaces
**Describe the bug**
--implicit-namespaces allows us to use namespaces in our project tree. At the current deployed implementation (3.4.3) it makes a difference if i have a submodule in my module_path (root python namespace) or only subpackages/namespaces.

Running `sphinx-apidoc --implicit-namespaces module_path` with a submodule (some python file) it will choose the module_path as the one and only module otherwise, without a submodule, it will use the subpackages/namespaces as individual python modules. 

The difference in the output is, that the module.rst of the module_path is not created and modules.rst does contain all subpackages/namespaces as submodules and not only the root module.

I would recommend to introduce an option to not search recursively for modules, or disable the recursive search if implicit-namespaces are activated.

**To Reproduce**
Steps to reproduce the behavior:
```
Create a directory with name 'module' with subdirectories, add python files to the subdirectories.
Run: sphinx-apidoc --implicit-namespaces -o apidoc_out1 ./module
Now add a python file into 'module'.
Run: sphinx-apidoc --implicit-namespaces -o apidoc_out2 ./module
Compare the results.
```

**Expected behavior**
Expecting same result  in apidoc_out2, with only one added module inside module.rst. Instead module.rst is missing and modules.rst is different.

**Your project**
[sphinx-apidoc-bug.zip](https://github.com/sphinx-doc/sphinx/files/5854695/sphinx-apidoc-bug.zip)

**Environment info**
- OS: Win
- Python version: 3.8.0
- Sphinx version: 3.4.3




## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_ext_apidoc.py b/tests/test_ext_apidoc.py
--- a/tests/test_ext_apidoc.py
+++ b/tests/test_ext_apidoc.py
@@ -216,6 +216,8 @@ def test_trailing_underscore(make_app, apidoc):
 def test_excludes(apidoc):
     outdir = apidoc.outdir
     assert (outdir / 'conf.py').isfile()
+    assert (outdir / 'a.rst').isfile()
+    assert (outdir / 'a.b.rst').isfile()
     assert (outdir / 'a.b.c.rst').isfile()  # generated because not empty
     assert not (outdir / 'a.b.e.rst').isfile()  # skipped because of empty after excludes
     assert (outdir / 'a.b.x.rst').isfile()
@@ -231,6 +233,8 @@ def test_excludes_subpackage_should_be_skipped(apidoc):
     """Subpackage exclusion should work."""
     outdir = apidoc.outdir
     assert (outdir / 'conf.py').isfile()
+    assert (outdir / 'a.rst').isfile()
+    assert (outdir / 'a.b.rst').isfile()
     assert (outdir / 'a.b.c.rst').isfile()  # generated because not empty
     assert not (outdir / 'a.b.e.f.rst').isfile()  # skipped because 'b/e' subpackage is skipped
 
@@ -244,6 +248,8 @@ def test_excludes_module_should_be_skipped(apidoc):
     """Module exclusion should work."""
     outdir = apidoc.outdir
     assert (outdir / 'conf.py').isfile()
+    assert (outdir / 'a.rst').isfile()
+    assert (outdir / 'a.b.rst').isfile()
     assert (outdir / 'a.b.c.rst').isfile()  # generated because not empty
     assert not (outdir / 'a.b.e.f.rst').isfile()  # skipped because of empty after excludes
 
@@ -257,6 +263,8 @@ def test_excludes_module_should_not_be_skipped(apidoc):
     """Module should be included if no excludes are used."""
     outdir = apidoc.outdir
     assert (outdir / 'conf.py').isfile()
+    assert (outdir / 'a.rst').isfile()
+    assert (outdir / 'a.b.rst').isfile()
     assert (outdir / 'a.b.c.rst').isfile()  # generated because not empty
     assert (outdir / 'a.b.e.f.rst').isfile()  # skipped because of empty after excludes