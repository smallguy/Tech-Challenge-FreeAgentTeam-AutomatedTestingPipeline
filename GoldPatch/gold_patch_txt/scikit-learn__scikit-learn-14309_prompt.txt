# 修复代码生成提示词（实例ID：scikit-learn__scikit-learn-14309）
## 代码仓库
scikit-learn/scikit-learn

## 原始问题描述
 plot_partial_dependence() fails when used on DecisionTreeRegressor
<!--
If your issue is a usage question, submit it here instead:
- StackOverflow with the scikit-learn tag: https://stackoverflow.com/questions/tagged/scikit-learn
- Mailing List: https://mail.python.org/mailman/listinfo/scikit-learn
For more information, see User Questions: http://scikit-learn.org/stable/support.html#user-questions
-->

<!-- Instructions For Filing a Bug: https://github.com/scikit-learn/scikit-learn/blob/master/CONTRIBUTING.md#filing-bugs -->

#### Description
```sklearn.inspection.plot_partial_dependence()``` fails when using a ```sklearn.tree.DecisionTreeRegressor``` as the estimator. The problem appears to be related to the presence of a ```classes_``` attribute (with a value of ```None```) on the estimator, despite it being a regressor and not a classifier. Deleting the ```classes_``` attribute from the estimator allows ```plot_partial_dependence()``` to successfully run.

#### Steps/Code to Reproduce
```python

from sklearn.inspection import plot_partial_dependence
from sklearn.tree import DecisionTreeRegressor
import numpy as np
X = np.array([[1.0, 2.0], [3.0, 4.0]])
y = np.array([[3.0], [7.0]])
learn = DecisionTreeRegressor().fit(X, y)
assert getattr(learn, 'classes_') is None
delete_classes_attribute = False
if delete_classes_attribute:
    # Deleting the 'classes_' attribute will allow plot_partial_dependence() to run
    delattr(learn, 'classes_')
plot_partial_dependence(learn, X, features=[0])


```
<!--
Example:
```python
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.decomposition import LatentDirichletAllocation

docs = ["Help I have a bug" for i in range(1000)]

vectorizer = CountVectorizer(input=docs, analyzer='word')
lda_features = vectorizer.fit_transform(docs)

lda_model = LatentDirichletAllocation(
    n_topics=10,
    learning_method='online',
    evaluate_every=10,
    n_jobs=4,
)
model = lda_model.fit(lda_features)
```
If the code is too long, feel free to put it in a public gist and link
it in the issue: https://gist.github.com
-->

#### Expected Results
No error is thrown.
<!-- Example: No error is thrown. Please paste or describe the expected results.-->

#### Actual Results
<!-- Please paste or specifically describe the actual output or traceback. -->
A ```TypeError``` is thrown:
```Python traceback
Traceback (most recent call last):
  File "Partial Dependence Plot Bug Illustration.py", line 13, in <module>
    plot_partial_dependence(learn, X, features=[0])
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/sklearn/inspection/partial_dependence.py", line 561, in plot_partial_dependence
    for fxs in features)
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/joblib/parallel.py", line 921, in __call__
    if self.dispatch_one_batch(iterator):
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/joblib/parallel.py", line 759, in dispatch_one_batch
    self._dispatch(tasks)
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/joblib/parallel.py", line 716, in _dispatch
    job = self._backend.apply_async(batch, callback=cb)
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/joblib/_parallel_backends.py", line 182, in apply_async
    result = ImmediateResult(func)
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/joblib/_parallel_backends.py", line 549, in __init__
    self.results = batch()
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/joblib/parallel.py", line 225, in __call__
    for func, args, kwargs in self.items]
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/joblib/parallel.py", line 225, in <listcomp>
    for func, args, kwargs in self.items]
  File "/anaconda3/envs/newsklearn/lib/python3.7/site-packages/sklearn/inspection/partial_dependence.py", line 293, in partial_dependence
    isinstance(estimator.classes_[0], np.ndarray)):
TypeError: 'NoneType' object is not subscriptable
```
#### Versions
<!--
Please run the following snippet and paste the output below.
For scikit-learn >= 0.20:
import sklearn; sklearn.show_versions()
For scikit-learn < 0.20:
import platform; print(platform.platform())
import sys; print("Python", sys.version)
import numpy; print("NumPy", numpy.__version__)
import scipy; print("SciPy", scipy.__version__)
import sklearn; print("Scikit-Learn", sklearn.__version__)
-->
```
System:
    python: 3.7.3 (default, Mar 27 2019, 16:54:48)  [Clang 4.0.1 (tags/RELEASE_401/final)]
executable: /anaconda3/envs/newsklearn/bin/python
   machine: Darwin-18.5.0-x86_64-i386-64bit

BLAS:
    macros: SCIPY_MKL_H=None, HAVE_CBLAS=None
  lib_dirs: /anaconda3/envs/newsklearn/lib
cblas_libs: mkl_rt, pthread

Python deps:
       pip: 19.1.1
setuptools: 41.0.1
   sklearn: 0.21.2
     numpy: 1.16.4
     scipy: 1.2.1
    Cython: None
    pandas: 0.24.2
```

<!-- Thanks for contributing! -->



## 参考黄金补丁（正确的修复方案）
diff --git a/sklearn/inspection/tests/test_partial_dependence.py b/sklearn/inspection/tests/test_partial_dependence.py
--- a/sklearn/inspection/tests/test_partial_dependence.py
+++ b/sklearn/inspection/tests/test_partial_dependence.py
@@ -21,6 +21,7 @@
 from sklearn.linear_model import LinearRegression
 from sklearn.linear_model import LogisticRegression
 from sklearn.linear_model import MultiTaskLasso
+from sklearn.tree import DecisionTreeRegressor
 from sklearn.datasets import load_boston, load_iris
 from sklearn.datasets import make_classification, make_regression
 from sklearn.cluster import KMeans
@@ -58,6 +59,7 @@
     (GradientBoostingClassifier, 'brute', multiclass_classification_data),
     (GradientBoostingRegressor, 'recursion', regression_data),
     (GradientBoostingRegressor, 'brute', regression_data),
+    (DecisionTreeRegressor, 'brute', regression_data),
     (LinearRegression, 'brute', regression_data),
     (LinearRegression, 'brute', multioutput_regression_data),
     (LogisticRegression, 'brute', binary_classification_data),
@@ -261,7 +263,6 @@ def test_partial_dependence_easy_target(est, power):
     assert r2 > .99
 
 
-@pytest.mark.filterwarnings('ignore:The default value of ')  # 0.22
 @pytest.mark.parametrize('Estimator',
                          (sklearn.tree.DecisionTreeClassifier,
                           sklearn.tree.ExtraTreeClassifier,
@@ -288,6 +289,8 @@ def test_multiclass_multioutput(Estimator):
 
 class NoPredictProbaNoDecisionFunction(BaseEstimator, ClassifierMixin):
     def fit(self, X, y):
+        # simulate that we have some classes
+        self.classes_ = [0, 1]
         return self