# 修复代码生成提示词（实例ID：psf__requests-774）
## 代码仓库
psf/requests

## 原始问题描述
Catch UnicodeError coming from encodings/idna.py
Here's a Python 2.6 Requests 0.13.1 traceback.  Looks like the call to `netloc.encode('idna').decode('utf-8')` needs a try/except.

```
File "/srv/import-service/lib/python2.6/site-packages/requests/api.py", line 76, in head
    return request('head', url, **kwargs)
  File "/srv/import-service/lib/python2.6/site-packages/requests/safe_mode.py", line 37, in wrapped
    return function(method, url, **kwargs)
  File "/srv/import-service/lib/python2.6/site-packages/requests/api.py", line 42, in request
    return s.request(method=method, url=url, **kwargs)
  File "/srv/import-service/lib/python2.6/site-packages/requests/sessions.py", line 230, in request
    r.send(prefetch=prefetch)
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 618, in send
    self._build_response(r)
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 305, in _build_response
    request.send()
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 474, in send
    url = self.full_url
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 388, in full_url
    netloc = netloc.encode('idna').decode('utf-8')
  File "/srv/import-service/lib/python2.6/encodings/idna.py", line 164, in encode
    result.append(ToASCII(label))
  File "/srv/import-service/lib/python2.6/encodings/idna.py", line 73, in ToASCII
    raise UnicodeError("label empty or too long")
UnicodeError: label empty or too long
```



## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_requests.py b/tests/test_requests.py
--- a/tests/test_requests.py
+++ b/tests/test_requests.py
@@ -19,6 +19,7 @@
 from requests import HTTPError
 from requests import get, post, head, put
 from requests.auth import HTTPBasicAuth, HTTPDigestAuth
+from requests.exceptions import InvalidURL
 
 if 'HTTPBIN_URL' not in os.environ:
     os.environ['HTTPBIN_URL'] = 'http://httpbin.org/'
@@ -1062,6 +1063,10 @@ def test_bytes_files(self):
         """Test that `bytes` can be used as the values of `files`."""
         post(httpbin('post'), files={'test': b'test'})
 
+    def test_invalid_urls_throw_requests_exception(self):
+        """Test that URLs with invalid labels throw
+        Requests.exceptions.InvalidURL instead of UnicodeError."""
+        self.assertRaises(InvalidURL, get, 'http://.google.com/')
 
 if __name__ == '__main__':
     unittest.main()