# 修复代码生成提示词（实例ID：matplotlib__matplotlib-25340）
## 代码仓库
matplotlib/matplotlib

## 原始问题描述
[Bug]: set_val of rangeslider sets incorrect value
### Bug summary

The set_val() method of a range slider doesn't set the value correctly with values close to the minimal and maximal values of the range slider. With values in the middle, everything works fine.

### Code for reproduction

```python
import matplotlib.pyplot as pyplot
import matplotlib.widgets as widgets

ax = pyplot.axes([0.15, 0.01, 0.7, 0.1])
ax2 = pyplot.axes([0.15, 0.21, 0.7, 0.1])
ax3 = pyplot.axes([0.15, 0.41, 0.7, 0.1])
ax4 = pyplot.axes([0.15, 0.61, 0.7, 0.1])

# correct behaviour with set_val using values in the middle between val min and val max
correct2 = widgets.RangeSlider(ax, "correct2", valmin=1.0, valmax=10.0)
correct2.set_val((4, 6))
print(correct2.val)

# correct with val init 
correct = widgets.RangeSlider(ax2, "correct", valinit=(1.0, 2.0), valmin=1.0, valmax=10.0)
print(correct.val)

# wrong with set_val having values close to the value max
wrong2 = widgets.RangeSlider(ax3, "wrong2", valmin=1.0, valmax=10.0)
wrong2.set_val((9, 10))
print(wrong2.val)

# wrong with set_val having values close to the value min
wrong = widgets.RangeSlider(ax4, "wrong", valmin=1.0, valmax=10.0)
wrong.set_val((1, 2))
print(wrong.val)

pyplot.show()
```


### Actual outcome

![grafik](https://user-images.githubusercontent.com/58626039/221685372-951f2b27-064b-46e6-953a-a0aaceacf72d.png)
The values for the rangesliders "wrong" and "wrong2" are not set correctly 
Expected values are: (1, 2) and (9, 10)
Actual values are (1, 3.25) and (7.75, 10)

### Expected outcome

The result of using set_val should be the same, as when using the valinit parameter of the constructor.

### Additional information

The problem also occurred on Manjaro with:
- Python version: 3.10.9
- Matplotlib version: 3.6.2
- Matplotlib backend: QtAgg
- Installation of matplotlib via Linux package manager

### Operating system

Windows 10

### Matplotlib Version

3.6.2

### Matplotlib Backend

TkAgg

### Python version

3.11.0

### Jupyter version

_No response_

### Installation

pip


## 参考黄金补丁（正确的修复方案）
diff --git a/lib/matplotlib/tests/test_widgets.py b/lib/matplotlib/tests/test_widgets.py
--- a/lib/matplotlib/tests/test_widgets.py
+++ b/lib/matplotlib/tests/test_widgets.py
@@ -1297,12 +1297,12 @@ def handle_positions(slider):
         else:
             return [h.get_xdata()[0] for h in slider._handles]
 
-    slider.set_val((0.2, 0.6))
-    assert_allclose(slider.val, (0.2, 0.6))
-    assert_allclose(handle_positions(slider), (0.2, 0.6))
+    slider.set_val((0.4, 0.6))
+    assert_allclose(slider.val, (0.4, 0.6))
+    assert_allclose(handle_positions(slider), (0.4, 0.6))
 
     box = slider.poly.get_extents().transformed(ax.transAxes.inverted())
-    assert_allclose(box.get_points().flatten()[idx], [0.2, .25, 0.6, .75])
+    assert_allclose(box.get_points().flatten()[idx], [0.4, .25, 0.6, .75])
 
     slider.set_val((0.2, 0.1))
     assert_allclose(slider.val, (0.1, 0.2))