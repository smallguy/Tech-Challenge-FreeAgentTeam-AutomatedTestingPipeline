# 修复代码生成提示词（实例ID：django__django-14334）
## 代码仓库
django/django

## 原始问题描述
LocaleMiddleware not recognising properly zh-Hant-HK from the accept-language header
Description
	
If both zh-hans and zh-hant are in settings.LANGUAGES (and in this order) the LocaleMiddleware is choosing the first one instead of the second as would be expected. The actual faulty code seems to be in django.utils.translation.trans_real.get_supported_language_variant.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/i18n/tests.py b/tests/i18n/tests.py
--- a/tests/i18n/tests.py
+++ b/tests/i18n/tests.py
@@ -1424,6 +1424,26 @@ def test_special_fallback_language(self):
         r.META = {'HTTP_ACCEPT_LANGUAGE': 'zh-my,en'}
         self.assertEqual(get_language_from_request(r), 'zh-hans')
 
+    def test_subsequent_code_fallback_language(self):
+        """
+        Subsequent language codes should be used when the language code is not
+        supported.
+        """
+        tests = [
+            ('zh-Hans-CN', 'zh-hans'),
+            ('zh-hans-mo', 'zh-hans'),
+            ('zh-hans-HK', 'zh-hans'),
+            ('zh-Hant-HK', 'zh-hant'),
+            ('zh-hant-tw', 'zh-hant'),
+            ('zh-hant-SG', 'zh-hant'),
+        ]
+        r = self.rf.get('/')
+        r.COOKIES = {}
+        for value, expected in tests:
+            with self.subTest(value=value):
+                r.META = {'HTTP_ACCEPT_LANGUAGE': f'{value},en'}
+                self.assertEqual(get_language_from_request(r), expected)
+
     def test_parse_language_cookie(self):
         """
         Now test that we parse language preferences stored in a cookie correctly.