# 修复代码生成提示词（实例ID：mwaskom__seaborn-2848）
## 代码仓库
mwaskom/seaborn

## 原始问题描述
pairplot fails with hue_order not containing all hue values in seaborn 0.11.1
In seaborn < 0.11, one could plot only a subset of the values in the hue column, by passing a hue_order list containing only the desired values. Points with hue values not in the list were simply not plotted.
```python
iris = sns.load_dataset("iris")`
# The hue column contains three different species; here we want to plot two
sns.pairplot(iris, hue="species", hue_order=["setosa", "versicolor"])
```

This no longer works in 0.11.1. Passing a hue_order list that does not contain some of the values in the hue column raises a long, ugly error traceback. The first exception arises in seaborn/_core.py:
```
TypeError: ufunc 'isnan' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
```
seaborn version: 0.11.1
matplotlib version: 3.3.2
matplotlib backends: MacOSX, Agg or jupyter notebook inline.

## 参考黄金补丁（正确的修复方案）
diff --git a/tests/test_relational.py b/tests/test_relational.py
--- a/tests/test_relational.py
+++ b/tests/test_relational.py
@@ -9,6 +9,7 @@
 
 from seaborn.external.version import Version
 from seaborn.palettes import color_palette
+from seaborn._oldcore import categorical_order
 
 from seaborn.relational import (
     _RelationalPlotter,
@@ -1623,6 +1624,16 @@ def test_supplied_color_array(self, long_df):
         _draw_figure(ax.figure)
         assert_array_equal(ax.collections[0].get_facecolors(), colors)
 
+    def test_hue_order(self, long_df):
+
+        order = categorical_order(long_df["a"])
+        unused = order.pop()
+
+        ax = scatterplot(data=long_df, x="x", y="y", hue="a", hue_order=order)
+        points = ax.collections[0]
+        assert (points.get_facecolors()[long_df["a"] == unused] == 0).all()
+        assert [t.get_text() for t in ax.legend_.texts] == order
+
     def test_linewidths(self, long_df):
 
         f, ax = plt.subplots()