# 修复代码生成提示词（实例ID：django__django-15031）
## 代码仓库
django/django

## 原始问题描述
Django admin allows filtering using the field lookups such as "in", but it is impossible to include a value that contains a comma
Description
	
The admin site allows you to filter the queryset in the changelist in a plenty of different ways. Notably, it allows you to filter the records by multiple values (if the field's value is one of the specified value options, then such record is considered matching).
For example, you can test it with a query string like this:
/admin/auth/user/?username__in=johnny,viola,gordon
Unfortunately, there is a big limitation at the moment: you can't include a value option that contains a comma (or a few).
The function that splits the string is prepare_lookup_value, found in ​contrib.admin.util.


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/admin_filters/tests.py b/tests/admin_filters/tests.py
--- a/tests/admin_filters/tests.py
+++ b/tests/admin_filters/tests.py
@@ -4,7 +4,8 @@
 
 from django.contrib.admin import (
     AllValuesFieldListFilter, BooleanFieldListFilter, EmptyFieldListFilter,
-    ModelAdmin, RelatedOnlyFieldListFilter, SimpleListFilter, site,
+    FieldListFilter, ModelAdmin, RelatedOnlyFieldListFilter, SimpleListFilter,
+    site,
 )
 from django.contrib.admin.options import IncorrectLookupParameters
 from django.contrib.auth.admin import UserAdmin
@@ -135,6 +136,17 @@ def lookups(self, request, model_admin):
             return (('the 80s', "the 1980's"), ('the 90s', "the 1990's"),)
 
 
+class EmployeeNameCustomDividerFilter(FieldListFilter):
+    list_separator = '|'
+
+    def __init__(self, field, request, params, model, model_admin, field_path):
+        self.lookup_kwarg = '%s__in' % field_path
+        super().__init__(field, request, params, model, model_admin, field_path)
+
+    def expected_parameters(self):
+        return [self.lookup_kwarg]
+
+
 class CustomUserAdmin(UserAdmin):
     list_filter = ('books_authored', 'books_contributed')
 
@@ -231,6 +243,12 @@ class EmployeeAdmin(ModelAdmin):
     list_filter = ['department']
 
 
+class EmployeeCustomDividerFilterAdmin(EmployeeAdmin):
+    list_filter = [
+        ('name', EmployeeNameCustomDividerFilter),
+    ]
+
+
 class DepartmentFilterEmployeeAdmin(EmployeeAdmin):
     list_filter = [DepartmentListFilterLookupWithNonStringValue]
 
@@ -1547,3 +1565,29 @@ def test_emptylistfieldfilter_invalid_lookup_parameters(self):
         request.user = self.alfred
         with self.assertRaises(IncorrectLookupParameters):
             modeladmin.get_changelist_instance(request)
+
+    def test_lookup_using_custom_divider(self):
+        """
+        Filter __in lookups with a custom divider.
+        """
+        jane = Employee.objects.create(name='Jane,Green', department=self.design)
+        modeladmin = EmployeeCustomDividerFilterAdmin(Employee, site)
+        employees = [jane, self.jack]
+
+        request = self.request_factory.get(
+            '/', {'name__in': "|".join(e.name for e in employees)}
+        )
+        # test for lookup with custom divider
+        request.user = self.alfred
+        changelist = modeladmin.get_changelist_instance(request)
+        # Make sure the correct queryset is returned
+        queryset = changelist.get_queryset(request)
+        self.assertEqual(list(queryset), employees)
+
+        # test for lookup with comma in the lookup string
+        request = self.request_factory.get('/', {'name': jane.name})
+        request.user = self.alfred
+        changelist = modeladmin.get_changelist_instance(request)
+        # Make sure the correct queryset is returned
+        queryset = changelist.get_queryset(request)
+        self.assertEqual(list(queryset), [jane])