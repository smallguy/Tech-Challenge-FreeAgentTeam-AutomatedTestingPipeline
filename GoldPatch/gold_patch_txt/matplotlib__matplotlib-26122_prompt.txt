# 修复代码生成提示词（实例ID：matplotlib__matplotlib-26122）
## 代码仓库
matplotlib/matplotlib

## 原始问题描述
imshow() should not modify axes aspect if transform != ax.transData.
Currently, imshow() automatically updates the axes aspect via the `aspect` kwarg; its default, None, means `rcParams["image.aspect"]`, which is "equal" by default (i.e., square image pixels).

If the `transform` kwarg is also passed, and set to something else[1] than `ax.transData` (the default), then setting the aspect is clearly not useful (the image is not going to be drawn in data coordinates so it should not affect the relative size of x- and y-data).  In that case, the default of `aspect=None` should just mean "don't modify the aspect".

[1] Really, this should be "something that does not contains transData as a branch", as in #13642.

The current behavior is the reason why #14057 and #14117 need to explicitly set the aspect to "auto" in or after the last imshow() call (otherwise, some head-scratching occurs).

On the other hand, making this change would once again lead to some seriously non-obvious interaction between parameters (the meaning of `aspect=None` depends on the value of `transform`), which I'm not sure is great either :/

**Matplotlib version**
<!--Please specify your platform and versions of the relevant libraries you are using:-->
  * Operating system: linux
  * Matplotlib version: master/any
  * Matplotlib backend (`print(matplotlib.get_backend())`): qt5agg
  * Python version: 37




## 参考黄金补丁（正确的修复方案）
diff --git a/lib/matplotlib/tests/test_image.py b/lib/matplotlib/tests/test_image.py
--- a/lib/matplotlib/tests/test_image.py
+++ b/lib/matplotlib/tests/test_image.py
@@ -1491,3 +1491,14 @@ def test_axesimage_get_shape():
     im.set_data(z)
     assert im.get_shape() == (4, 3)
     assert im.get_size() == im.get_shape()
+
+
+def test_non_transdata_image_does_not_touch_aspect():
+    ax = plt.figure().add_subplot()
+    im = np.arange(4).reshape((2, 2))
+    ax.imshow(im, transform=ax.transAxes)
+    assert ax.get_aspect() == "auto"
+    ax.imshow(im, transform=Affine2D().scale(2) + ax.transData)
+    assert ax.get_aspect() == 1
+    ax.imshow(im, transform=ax.transAxes, aspect=2)
+    assert ax.get_aspect() == 2