# 修复代码生成提示词（实例ID：sympy__sympy-16637）
## 代码仓库
sympy/sympy

## 原始问题描述
Intersection between Plane and Segment3D returns points outside of the segment
It seems to me that, as far as ``Plane.intersection`` is concerned, ``Segment3D`` is treated as if it wasn't delimited on both ends (i.e., as if it was a ``Line3D``), and so additional intersections that aren't actually within the segment are returned:
``` python
from sympy import Plane, Segment3D

plane = Plane([0,0,0], normal_vector=[1,1,1])

# this clearly has no intersection with the plane due to being cut off at z=1:
segment = Segment3D([0,0,1], [0,0,2])

intersections = plane.intersection(segment)

print(intersections) # yields: [Point3D(0, 0, 0)]

# basic sanity check: intersections should be part of the intersected objects
for intersection in intersections:
  assert intersection in plane # works fine
  assert intersection in segment # fails
```

The expected result is of course that ``Plane.intersections`` returns an empty list in this case.

An easy workaround for the time being is to just filter these out manually:
```python
def plane_segment3d_intersection(plane, segment):
  return [ x for x in plane.intersection(segment) if x in segment ]
```

But it would be nice if this could be fixed in sympy itself.

-----
Version info:
- Python 3.5.3
- Sympy 1.2-522-g0b350a21a (0b350a21a)
Updated intersection method in class Plane
Updated the isinstance(o, (LinearEntity, LinearEntity3D)) part of intersection method in Plane class so that the returned points lie in both the intersection objects.
Fixes #15069
<!-- BEGIN RELEASE NOTES -->
* geometry
  * updated the intersection method of plane class so that
    intersection points lie in both the intersection objects if 
    the other entity is LinearEntity.
<!-- END RELEASE NOTES -->



## 参考黄金补丁（正确的修复方案）
diff --git a/sympy/geometry/tests/test_plane.py b/sympy/geometry/tests/test_plane.py
--- a/sympy/geometry/tests/test_plane.py
+++ b/sympy/geometry/tests/test_plane.py
@@ -90,8 +90,18 @@ def test_plane():
     assert pl6.distance(pl6.p1) == 0
     assert pl7.distance(pl6) == 0
     assert pl7.distance(l1) == 0
-    assert pl6.distance(Segment3D(Point3D(2, 3, 1), Point3D(1, 3, 4))) == 0
-    pl6.distance(Plane(Point3D(5, 5, 5), normal_vector=(8, 8, 8))) == sqrt(3)
+    assert pl6.distance(Segment3D(Point3D(2, 3, 1), Point3D(1, 3, 4))) == \
+        pl6.distance(Point3D(1, 3, 4)) == 4*sqrt(3)/3
+    assert pl6.distance(Segment3D(Point3D(1, 3, 4), Point3D(0, 3, 7))) == \
+        pl6.distance(Point3D(0, 3, 7)) == 2*sqrt(3)/3
+    assert pl6.distance(Segment3D(Point3D(0, 3, 7), Point3D(-1, 3, 10))) == 0
+    assert pl6.distance(Segment3D(Point3D(-1, 3, 10), Point3D(-2, 3, 13))) == 0
+    assert pl6.distance(Segment3D(Point3D(-2, 3, 13), Point3D(-3, 3, 16))) == \
+        pl6.distance(Point3D(-2, 3, 13)) == 2*sqrt(3)/3
+    assert pl6.distance(Plane(Point3D(5, 5, 5), normal_vector=(8, 8, 8))) == sqrt(3)
+    assert pl6.distance(Ray3D(Point3D(1, 3, 4), direction_ratio=[1, 0, -3])) == 4*sqrt(3)/3
+    assert pl6.distance(Ray3D(Point3D(2, 3, 1), direction_ratio=[-1, 0, 3])) == 0
+
 
     assert pl6.angle_between(pl3) == pi/2
     assert pl6.angle_between(pl6) == 0
@@ -155,8 +165,7 @@ def test_plane():
         ) == [Line3D(Point3D(-24, -12, 0), Point3D(-25, -13, -1))]
     assert pl6.intersection(Ray3D(Point3D(2, 3, 1), Point3D(1, 3, 4))) == [
         Point3D(-1, 3, 10)]
-    assert pl6.intersection(Segment3D(Point3D(2, 3, 1), Point3D(1, 3, 4))) == [
-        Point3D(-1, 3, 10)]
+    assert pl6.intersection(Segment3D(Point3D(2, 3, 1), Point3D(1, 3, 4))) == []
     assert pl7.intersection(Line(Point(2, 3), Point(4, 2))) == [
         Point3D(S(13)/2, S(3)/4, 0)]
     r = Ray(Point(2, 3), Point(4, 2))