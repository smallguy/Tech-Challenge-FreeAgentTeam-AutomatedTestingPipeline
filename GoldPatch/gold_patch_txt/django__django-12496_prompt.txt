# 修复代码生成提示词（实例ID：django__django-12496）
## 代码仓库
django/django

## 原始问题描述
Child model updates parent model with empty fields making an extra query in multi-inheritance when parent model has custom PK
Description
	
While creating a new model object (using multi-inheritance model => Child(Parent)), Django does an extra update query setting parent model fields to empty values. This situation occurs *only* if we define a custom primary key in a parent model (eg. as an UUID field).
An example *without* custom primary key (correct behavior):
class Parent(models.Model):
	title = models.TextField()
class Child(Parent):
	body = models.TextField()
>> Child.objects.create()
1. INSERT INTO "app_parent" ("title") VALUES ('') RETURNING "app_parent"."id"
2. INSERT INTO "app_child" ("parent_ptr_id", "body") VALUES (1, '')
An example *with* custom primary key (incorrect behavior):
class Parent(models.Model):
	id = models.UUIDField(
		primary_key=True,
		default=uuid.uuid4,
		editable=False
	)
	title = models.TextField()
class Child(Parent):
	body = models.TextField()
>> Child.objects.create()
1. UPDATE "app_parent" SET "title" = '' WHERE "app_parent"."id" = 'd750cfdd-ae7b-48a6-a2e0-d49e70e28686'::uuid
2. INSERT INTO "app_parent" ("id", "title") VALUES ('d750cfdd-ae7b-48a6-a2e0-d49e70e28686'::uuid, '')
3. INSERT INTO "app_child" ("parent_ptr_id", "body") VALUES ('d750cfdd-ae7b-48a6-a2e0-d49e70e28686'::uuid, '')
Python 3.6, PostgreSQL 9.6


## 参考黄金补丁（正确的修复方案）
diff --git a/tests/basic/models.py b/tests/basic/models.py
--- a/tests/basic/models.py
+++ b/tests/basic/models.py
@@ -46,3 +46,7 @@ def __str__(self):
 
 class PrimaryKeyWithDefault(models.Model):
     uuid = models.UUIDField(primary_key=True, default=uuid.uuid4)
+
+
+class ChildPrimaryKeyWithDefault(PrimaryKeyWithDefault):
+    pass
diff --git a/tests/basic/tests.py b/tests/basic/tests.py
--- a/tests/basic/tests.py
+++ b/tests/basic/tests.py
@@ -12,8 +12,8 @@
 from django.utils.translation import gettext_lazy
 
 from .models import (
-    Article, ArticleSelectOnSave, FeaturedArticle, PrimaryKeyWithDefault,
-    SelfRef,
+    Article, ArticleSelectOnSave, ChildPrimaryKeyWithDefault, FeaturedArticle,
+    PrimaryKeyWithDefault, SelfRef,
 )
 
 
@@ -139,6 +139,12 @@ def test_save_primary_with_default(self):
         with self.assertNumQueries(1):
             PrimaryKeyWithDefault().save()
 
+    def test_save_parent_primary_with_default(self):
+        # An UPDATE attempt is skipped when an inherited primary key has
+        # default.
+        with self.assertNumQueries(2):
+            ChildPrimaryKeyWithDefault().save()
+
 
 class ModelTest(TestCase):
     def test_objects_attribute_is_only_available_on_the_class_itself(self):